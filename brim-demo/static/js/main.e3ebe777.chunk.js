(this.webpackJsonpbrim=this.webpackJsonpbrim||[]).push([[0],[,,,,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=null,i=function(){function e(e,t,r){void 0===r&&(r=null),this.streamFunc=e,this.onRequestUpdate=t,this.afterTerminate=r,this.hookRecordChain={data:null,cleanup:null,next:null},this.recordCursor=null,this.openRecord=null,this.updateCount=0}return e.prototype.update=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,i={executionContext:this,previousFrame:n};n=i,this.recordCursor=this.hookRecordChain;try{if(r=this.streamFunc.apply(null,arguments),this.recordCursor.next)throw new Error("Did not reach all hook records in update")}finally{var a=n;if(!a)throw new Error("Cannot pop update frame because current is null");if(a.executionContext!==this)throw new Error("Popped frame from update stack but context did not match");n=a.previousFrame}return this.updateCount++,r},e.prototype.terminate=function(){for(var e=this.hookRecordChain.next;e;e=e.next)e.cleanup&&e.cleanup();this.afterTerminate&&this.afterTerminate()},e.prototype._beginHook=function(){if(this.openRecord)throw new Error("This is already an open hook when beginning another");if(!this.recordCursor)throw new Error;if(0===this.updateCount){if(this.recordCursor.next)throw new Error("Expecting to create new hook record in chain, but already present");this.recordCursor.next={data:null,cleanup:null,next:null}}if(!this.recordCursor.next)throw new Error("Expecting to find hook record in chain, but not present");return this.openRecord=this.recordCursor.next,this.recordCursor.next},e.prototype._endHook=function(){if(!this.recordCursor)throw new Error;if(this.openRecord!==this.recordCursor.next)throw new Error("Hook close does not match open");this.openRecord=null,this.recordCursor=this.recordCursor.next},e.prototype._requestUpdate=function(){this.onRequestUpdate()},e.prototype._setStreamFunc=function(e){this.streamFunc=e},e}();t.ExecutionContext=i;var a=null;function o(e){a?a.callbacks.add(e):e()}function u(){if(!n)throw new Error("Cannot get currently updating execution context because update stack is empty. Was a hook called outside of an execution context update?");return n.executionContext}function c(e){var t=u(),r=t._beginHook();if(!r.data){var n=e instanceof Function?e():e;r.data={current:n}}return t._endHook(),r.data}function s(){var e=u(),t=e._beginHook();return t.data||(t.data={requestUpdate:function(){e._requestUpdate()}}),e._endHook(),t.data.requestUpdate}function d(e){var t,r=u(),n=r._beginHook();if(!n.data){var i=[],a={queue:i,lastStream:null,unsubscribe:null,onValue:function(e){i.push(e)}};n.data=a,n.cleanup=function(){a.unsubscribe&&a.unsubscribe()}}var o=n.data;if(e!==o.lastStream){if(o.queue.length)throw new Error("useEventReceiver stream changed, but value is in queue");if(o.lastStream){if(!o.unsubscribe)throw new Error("should not be possible");o.unsubscribe(),o.lastStream=null,o.unsubscribe=null}o.lastStream=e,e&&(o.unsubscribe=e.subscribe(o.onValue))}else if(o.queue.length){if(o.queue.length>1)throw new Error("useEventReceiver found more than one enqueued value");t={value:o.queue.pop()}}return r._endHook(),t}t.beginBatch=function(){if(a)throw new Error("cannot begin batch when one is already active");a={callbacks:new Set}},t.endBatch=function(){if(!a)throw new Error("cannot end batch when none is active");a.callbacks.forEach((function(e){e()})),a=null},t.enqueueBatchedUpdate=o,t.createNullaryVoidRootExecutionContext=function(e){var t=0,r=function(){var e=performance.now();n.update();var r=performance.now()-e;t++,console.log("root update","count",t,"time",r.toFixed(2)+"ms")},n=new i(e,(function(){o(r)}));return n},t.useVar=c,t.useRequestUpdate=s,t.useInitialize=function(e){var t=u(),r=t._beginHook();r.data||(r.cleanup=e()||null,r.data={}),t._endHook()},t.useEventEmitter=function(){var e=u(),t=e._beginHook();if(!t.data){var r=new Set,n={subscribe:function(e){return r.add(e),function(){r.delete(e)}}};t.data={stream:n,emit:function(e){r.forEach((function(t){t(e)}))}}}return e._endHook(),[t.data.stream,t.data.emit]},t.useEventReceiver=d,t.useDynamic=function(e,t){var r=u(),n=r._beginHook();if(!n.data){var a=t||function(){r._requestUpdate()},o={activeContexts:new Set,createContext:function(){var e=new i(o.streamFunc,a,(function(){o.activeContexts.delete(e)}));return o.activeContexts.add(e),e},streamFunc:function(){throw new Error("should be unreachable")}};n.data=o,n.cleanup=function(){o.activeContexts.forEach((function(e){return e.terminate()}))}}return n.data.streamFunc=e,n.data.activeContexts.forEach((function(t){t._setStreamFunc(e)})),r._endHook(),n.data.createContext},t.useReducer=function(e,t,r){var n=c(r),i=d(e);return i&&(n.current=t(n.current,i.value)),n.current},t.useReducers=function(e,t){var r=c(t),n=c(e.length);if(e.length!==n.current)throw new Error("The number of streams/reducers supplied to useMultiReducer cannot change");for(var i=0,a=0,o=e;a<o.length;a++){var u=o[a],s=u[0],l=u[1],f=d(s);if(f){if(i>0)throw new Error("useMultiReducer got multiple events, cannot merge");r.current=l(r.current,f.value),i++}}return r.current},t.useCallbackReducer=function(e,t){var r=s(),n=c(t),i=c((function(){return function(t){n.current=e(n.current,t),r()}}));return[n.current,i.current]},t.useCallbackReducers=function(e,t){var r=s(),n=c(t),i=e.map((function(e){return function(t){n.current=e(n.current,t),r()}}));return[n.current,i]},t.useMachine=function(e,t){var r,n=u(),a=n._beginHook(),o=function(t){a.data.activeContext&&a.data.activeContext.terminate();var r=t[0],o=t[1],u=new i(e[r],(function(){n._requestUpdate()}));a.data.activeState=r,a.data.activeContext=u,a.data.activeArgument=o};if(!a.data){var c={activeContext:null};a.data=c,o(t),a.cleanup=function(){if(!c.activeContext)throw new Error("should have been initialized");c.activeContext.terminate()}}for(;;){a.data.activeContext._setStreamFunc(e[a.data.activeState]);var s=a.data.activeContext.update(a.data.activeArgument),d=s[0],l=s[1];if(r=d,!l)break;o(l)}return n._endHook(),r}},,,,,,,,,function(e,t,r){"use strict";r.r(t),r.d(t,"h",(function(){return a})),r.d(t,"renderDOMIntoElement",(function(){return u})),r.d(t,"renderDOMIntoSelector",(function(){return c})),r.d(t,"renderDOMAppendedToBody",(function(){return s}));var n=r(4),i=r(45).init([r(33).default,r(34).default,r(35).default,r(36).default]),a=r(37).default;function o(e){return{sel:e.sel,data:e.data,children:e.children&&e.children.map(o),text:e.text,key:e.key,elm:e.elm}}function u(e,t){var r=Object(n.useVar)(),a=Object(n.useVar)();if(Object(n.useInitialize)((function(){return function(){r.current&&(r.current.innerHTML="")}})),t&&e){r.current=t;var u=o(e);if(a.current)i(a.current,u);else{var c=document.createElement("div");r.current.appendChild(c),i(c,u)}a.current=u}}function c(e,t){var r;try{r=document.querySelector(t)}catch(n){}u(e,r)}function s(e){var t=Object(n.useVar)();Object(n.useInitialize)((function(){var e=document.createElement("div");return document.body.appendChild(e),t.current=e,function(){document.body.removeChild(e)}})),u(e,t.current)}},,,,function(e,t,r){e.exports=r.p+"static/media/quotes.afec1851.svg"},function(e,t,r){e.exports=r.p+"static/media/boolean.3e99c949.svg"},,,function(e,t,r){e.exports=r(44)},,,,,function(e,t,r){},function(e,t,r){},,,,,function(e,t,r){"use strict";r.r(t),r.d(t,"showString",(function(){return h})),r.d(t,"animationFrameEvts",(function(){return w})),r.d(t,"latestValue",(function(){return g})),r.d(t,"animationTime",(function(){return y})),r.d(t,"countEvents",(function(){return b})),r.d(t,"mouseClickEvts",(function(){return x})),r.d(t,"mouseDown",(function(){return k})),r.d(t,"mousePosition",(function(){return S})),r.d(t,"random",(function(){return N})),r.d(t,"audioDriver",(function(){return T})),r.d(t,"sampleUpon",(function(){return O})),r.d(t,"everySecond",(function(){return D})),r.d(t,"loadAudioAsArray",(function(){return j})),r.d(t,"integral",(function(){return L})),r.d(t,"expFollow",(function(){return C})),r.d(t,"redCircle",(function(){return F})),r.d(t,"followAtSpeed2d",(function(){return I})),r.d(t,"eventAfter",(function(){return R})),r.d(t,"received",(function(){return P})),r.d(t,"streamMap",(function(){return A})),r.d(t,"changeCount",(function(){return _}));r(5);var n=r(2),i=r(4),a=i.useVar,o=i.useRequestUpdate,u=i.useInitialize,c=i.useEventEmitter,s=i.useEventReceiver,d=i.useDynamic,l=i.useReducer,f=i.useReducers,v=r(13),m=v.renderDOMAppendedToBody,p=v.h;function h(e){var t=p("div",{style:{border:"1px solid red",color:"black",fontSize:"24px",padding:"5px",marginTop:"20px"}},"showString: "+(void 0===e?"(undefined)":e.toString()));m(t)}function w(){var e=o(),t=a(),r=c(),i=Object(n.a)(r,2),s=i[0],d=i[1];return u((function(){return t.current=requestAnimationFrame((function r(n){d(.001*n),e(),t.current=requestAnimationFrame(r)})),function(){cancelAnimationFrame(t.current)}})),s}function g(e,t){return l(e,(function(e,t){return t}),t)}function y(){return g(w(),(function(){return.001*performance.now()}))}function b(e){return l(e,(function(e){return e+1}),0)}function E(e,t,r){var i=o(),a=c(),s=Object(n.a)(a,2),d=s[0],l=s[1];return u((function(){var e=function(e){l(e),i()};return document.addEventListener(t,e,r),function(){document.removeEventListener(t,e,r)}})),d}function x(){return E(document,"mousedown")}function k(){var e=E(document,"mousedown"),t=E(document,"mouseup");return f([[t,function(){return!1}],[e,function(){return!0}]],!1)}function S(){return g(function(e){var t=s(e),r=c(),i=Object(n.a)(r,2),a=i[0],o=i[1];return t&&o(t.value),a}(E(document,"mousemove")),{x:0,y:0})}function N(e){return l(e,(function(){return Math.random()}),(function(){return Math.random()}))}function T(e){var t=d(e),r=a(),i=a(0),o=a(),s=c(),l=Object(n.a)(s,2),f=l[0],v=l[1];u((function(){r.current=t();var e=new(window.AudioContext||window.webkitAudioContext),n=e.createScriptProcessor(1024,0,1);return n.onaudioprocess=function(e){for(var t=e.outputBuffer.getChannelData(0),n=0;n<t.length;n++){v();var a=r.current.update(i.current/o.current,f,o.current);!a||Number.isNaN(a)?a=0:a>1?a=1:a<-1&&(a=-1),t[n]=a,i.current++}},n.connect(e.destination),o.current=e.sampleRate,function(){n.disconnect(),e.close()}})),r.current.update(i.current/o.current,f,o.current)}function O(e,t,r){return l(t,(function(){return e}),r)}function D(){var e=o(),t=c(),r=Object(n.a)(t,2),i=r[0],a=r[1];return u((function(){var t=setInterval((function(){a(),e()}),1e3);return function(){clearInterval(t)}})),i}function j(e){var t=o(),r=a([0]);return u((function(){var n=new(window.AudioContext||window.webkitAudioContext),i=!1,a=new XMLHttpRequest;return a.open("GET",e,!0),a.responseType="arraybuffer",a.onload=function(){var e=a.response;n.decodeAudioData(e,(function(e){i||(r.current=e.getChannelData(0),t())}))},a.send(),function(){a.abort(),i=!0}})),r.current}function L(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=a(r),i=a(t),o=e(n.current,i.current);return n.current+=(t-i.current)*o,i.current=t,n.current}function C(e,t,r,n){return L((function(r){return t*(e-r)}),r,n)}function F(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,r=e||{x:0,y:0};t<0&&(t=0);var n=.5*t,i=p("div",{style:{position:"absolute",borderRadius:"50%",background:"red",pointerEvents:"none",userSelect:"none",left:r.x-n+"px",top:r.y-n+"px",width:t+"px",height:t+"px"}});m(i)}function I(e,t,r,n){var i=a(n),o=a(r),u=r-o.current,c=e.x-i.current.x,s=e.y-i.current.y,d=Math.sqrt(c*c+s*s);return i.current=t*u>=d?e:{x:i.current.x+u*t*c/d,y:i.current.y+u*t*s/d},o.current=r,i.current}function R(e,t){var r=c(),i=Object(n.a)(r,2),o=i[0],s=i[1],d=a(t);return d.current=t,u((function(){var t=setTimeout((function(){s(d.current)}),1e3*e);return function(){clearTimeout(t)}})),o}function P(e){return l(e,(function(e,t){return!0}),!1)}function A(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=d(e),n=a([]);t.length>n.current.length;)n.current.push(r());for(;t.length<n.current.length;){var i=n.current.pop();i.terminate()}var o=n.current.map((function(e,r){return e.update(t[r])}));return o}function _(e){var t=a(0),r=a(e);return Object.is(e,r.current)||t.current++,r.current=e,t.current}},,,,,,,,function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n),a=r(14),o=r.n(a),u=(r(26),r(27),r(1)),c=r(5),s=r(2),d=r(9),l=function(){return Math.random().toString(16).substring(2,10)},f=function(){return l()+l()};function v(){return"S-"+f()}function m(){return"F-"+f()}var p;function h(){return"A-"+f()}function w(e){return function(e){return e.kind===p.UndefinedLiteral||e.kind===p.NumberLiteral||e.kind===p.TextLiteral||e.kind===p.BooleanLiteral}(e)||e.kind===p.ArrayLiteral||e.kind===p.StreamReference||e.kind===p.Application}function g(e){return w(e)||b(e)||e.kind===p.YieldExpression}function y(e){return e.kind===p.TreeFunctionDefinition||e.kind===p.NativeFunctionDefinition}function b(e){return e.kind===p.FunctionReference||y(e)}!function(e){e.Name="name",e.UndefinedLiteral="und",e.NumberLiteral="num",e.TextLiteral="str",e.BooleanLiteral="bool",e.ArrayLiteral="arr",e.StreamReference="sref",e.Application="app",e.FunctionReference="fref",e.SignatureStreamParameter="sig-sparam",e.SignatureFunctionParameter="sig-fparam",e.SignatureYield="sig-yield",e.Signature="sig",e.YieldExpression="yield",e.StreamParameter="sparam",e.FunctionParameter="fparam",e.TreeFunctionBody="tbody",e.TreeFunctionDefinition="tdef",e.NativeFunctionDefinition="ndef"}(p||(p={}));var E=r(7),x=r(19),k=r(8),S=r(15),N=r(20);function T(e){switch(e.kind){case p.UndefinedLiteral:case p.NumberLiteral:case p.TextLiteral:case p.BooleanLiteral:case p.ArrayLiteral:return e.sid;case p.StreamReference:return e.ref;case p.Application:var t=!0,r=!1,n=void 0;try{for(var i,a=e.outs[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if(!o.name)return o.sid}}catch(u){r=!0,n=u}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return;default:throw new Error}}function O(e){switch(e.kind){case p.FunctionReference:return e.ref;case p.TreeFunctionDefinition:case p.NativeFunctionDefinition:return e.fid;default:throw new Error}}var D=r(16),j=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;Object(E.a)(this,e),this.local=void 0,this.outer=void 0,this.local=new Map,this.outer=t}return Object(D.a)(e,[{key:"has",value:function(e){return this.local.has(e)||!!this.outer&&this.outer.has(e)}},{key:"get",value:function(e){return this.local.has(e)?this.local.get(e):this.outer?this.outer.get(e):void 0}},{key:"getExisting",value:function(e){if(!this.has(e))throw new Error;return this.get(e)}},{key:"set",value:function(e,t){this.local.set(e,t)}},{key:"setNew",value:function(e,t){if(this.has(e))throw new Error;this.set(e,t)}},{key:"setExisting",value:function(e,t){if(!this.local.has(e))throw new Error;this.set(e,t)}},{key:"delete",value:function(e){if(this.outer&&this.outer.has(e))throw new Error;return this.local.delete(e)}},{key:"forEach",value:function(e){this.local.forEach(e),this.outer&&this.outer.forEach(e)}},{key:"entriesArray",value:function(){var e=Object(c.a)(this.local.entries());return this.outer&&(e=e.concat(this.outer.entriesArray())),e}}]),e}(),L=r(10),C=r.n(L),F=C.a.mark(I);function I(e){var t,r,n,i,a,o;return C.a.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:u.t0=e.kind,u.next=u.t0===p.Name?3:u.t0===p.UndefinedLiteral?3:u.t0===p.NumberLiteral?3:u.t0===p.TextLiteral?3:u.t0===p.BooleanLiteral?3:u.t0===p.StreamReference?3:u.t0===p.FunctionReference?3:u.t0===p.SignatureStreamParameter?4:u.t0===p.SignatureFunctionParameter?4:u.t0===p.SignatureYield?4:u.t0===p.ArrayLiteral?5:u.t0===p.Application?7:u.t0===p.Signature?39:u.t0===p.StreamParameter?43:u.t0===p.FunctionParameter?43:u.t0===p.YieldExpression?46:u.t0===p.TreeFunctionBody?49:u.t0===p.TreeFunctionDefinition?51:u.t0===p.NativeFunctionDefinition?58:61;break;case 3:case 4:return u.abrupt("break",62);case 5:return u.delegateYield(e.elems,"t1",6);case 6:return u.abrupt("break",62);case 7:return u.next=9,e.func;case 9:t=!0,r=!1,n=void 0,u.prev=12,i=e.outs[Symbol.iterator]();case 14:if(t=(a=i.next()).done){u.next=22;break}if(!(o=a.value).name){u.next=19;break}return u.next=19,o.name;case 19:t=!0,u.next=14;break;case 22:u.next=28;break;case 24:u.prev=24,u.t2=u.catch(12),r=!0,n=u.t2;case 28:u.prev=28,u.prev=29,t||null==i.return||i.return();case 31:if(u.prev=31,!r){u.next=34;break}throw n;case 34:return u.finish(31);case 35:return u.finish(28);case 36:return u.delegateYield(e.sargs,"t3",37);case 37:return u.delegateYield(e.fargs,"t4",38);case 38:return u.abrupt("break",62);case 39:return u.delegateYield(e.streamParams,"t5",40);case 40:return u.delegateYield(e.funcParams,"t6",41);case 41:return u.delegateYield(e.yields,"t7",42);case 42:return u.abrupt("break",62);case 43:return u.next=45,e.name;case 45:return u.abrupt("break",62);case 46:return u.next=48,e.expr;case 48:return u.abrupt("break",62);case 49:return u.delegateYield(e.exprs,"t8",50);case 50:return u.abrupt("break",62);case 51:return u.next=53,e.sig;case 53:return u.delegateYield(e.sparams,"t9",54);case 54:return u.delegateYield(e.fparams,"t10",55);case 55:return u.next=57,e.body;case 57:return u.abrupt("break",62);case 58:return u.next=60,e.sig;case 60:return u.abrupt("break",62);case 61:e;case 62:case"end":return u.stop()}}),F,null,[[12,24,28,36],[29,,31,35]])}function R(e,t,r){var n=!0,i=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var c=t(o.value,r);if(c)return c}}catch(s){i=!0,a=s}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}}function P(e,t,r){switch(e.kind){case p.Name:case p.UndefinedLiteral:case p.NumberLiteral:case p.TextLiteral:case p.BooleanLiteral:case p.StreamReference:case p.FunctionReference:return;case p.SignatureStreamParameter:case p.SignatureFunctionParameter:case p.SignatureYield:return;case p.ArrayLiteral:return R(e.elems,t,r);case p.Application:return t(e.func,r)||function(e,t,r){var n=!0,i=!1,a=void 0;try{for(var o,u=e[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var c=o.value;if(c.name){var s=t(c.name,r);if(s)return s}}}catch(d){i=!0,a=d}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}}(e.outs,t,r)||R(e.sargs,t,r)||R(e.fargs,t,r);case p.Signature:return R(e.streamParams,t,r)||R(e.funcParams,t,r)||R(e.yields,t,r);case p.StreamParameter:case p.FunctionParameter:return t(e.name,r);case p.YieldExpression:return t(e.name,r)||t(e.expr,r);case p.TreeFunctionBody:return R(e.exprs,t,r);case p.TreeFunctionDefinition:return t(e.sig,r)||R(e.sparams,t,r)||R(e.fparams,t,r)||t(e.body,r);case p.NativeFunctionDefinition:return t(e.sig,r);default:}}var A=function(e){function t(){return Object(E.a)(this,t),Object(x.a)(this,Object(k.a)(t).apply(this,arguments))}return Object(S.a)(t,e),t}(Object(N.a)(Error));function _(e,t){var r=new j,n=new j;t.forEach((function(e,t){n.set(t,e)}));var i=function e(t,r,n){var i=new j(r),a=new j(n),o=new Set,u=new Set;t.sparams.forEach((function(e){var t=e.sid;if(i.has(t))throw new Error("must be unique");i.set(t,null),o.add(t)})),P(t.body,(function e(t){if(w(t))switch(t.kind){case p.UndefinedLiteral:case p.NumberLiteral:case p.TextLiteral:case p.BooleanLiteral:case p.ArrayLiteral:if(i.has(t.sid))throw new Error("must be unique");i.set(t.sid,t),o.add(t.sid);break;case p.StreamReference:break;case p.Application:t.outs.forEach((function(e){if(i.has(e.sid))throw new Error("must be unique");i.set(e.sid,t),o.add(e.sid)}));break;default:throw new Error}else if(y(t)){if(a.has(t.fid))throw new Error("must be unique");a.set(t.fid,t),u.add(t.fid)}y(t)||P(t,e,void 0)}),void 0);var c=[],d=[],l=[],f=[],v=new Set,m=!0,h=!1,g=void 0;try{for(var b,E=u[Symbol.iterator]();!(m=(b=E.next()).done);m=!0){var x=b.value,k=a.get(x);if(!k)throw new Error;if(k.kind===p.TreeFunctionDefinition){var S=e(k,i,a),N=Object(s.a)(S,1)[0];l.push({fid:x,def:N})}}}catch($){h=!0,g=$}finally{try{m||null==E.return||E.return()}finally{if(h)throw g}}var D=new Set,L=new Set;function C(e){if(!L.has(e)){if(D.has(e))throw new A("graph cycle");switch(e.kind){case p.UndefinedLiteral:c.push({sid:e.sid,val:void 0});break;case p.NumberLiteral:case p.TextLiteral:case p.BooleanLiteral:c.push({sid:e.sid,val:e.val});break;case p.ArrayLiteral:var t=[];D.add(e);var r=!0,n=!1,u=void 0;try{for(var s,l=e.elems[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var f=s.value;C(f);var m=T(f);if(!m)throw new Error;t.push(m)}}catch($){n=!0,u=$}finally{try{r||null==l.return||l.return()}finally{if(n)throw u}}D.delete(e),d.push({sids:[e.sid],appId:e.aid,funcId:"Array_of",sargIds:t,fargIds:[]});break;case p.StreamReference:if(o.has(e.ref)){var h=i.get(e.ref);if(null===h);else{if(void 0===h)throw Error();D.add(e),C(h),D.delete(e)}}else{if(!i.has(e.ref))throw new A;v.add(e.ref)}break;case p.Application:if(!a.get(O(e.func)))throw new A;var w=[],g=[];D.add(e);var y=!0,b=!1,E=void 0;try{for(var x,k=e.sargs[Symbol.iterator]();!(y=(x=k.next()).done);y=!0){var S=x.value;C(S);var N=T(S);if(!N)throw new Error;w.push(N)}}catch($){b=!0,E=$}finally{try{y||null==k.return||k.return()}finally{if(b)throw E}}var j=!0,F=!1,I=void 0;try{for(var R,P=e.fargs[Symbol.iterator]();!(j=(R=P.next()).done);j=!0){var _=O(R.value);if(!a.get(_))throw new Error;g.push(_)}}catch($){F=!0,I=$}finally{try{j||null==P.return||P.return()}finally{if(F)throw I}}D.delete(e),d.push({sids:e.outs.map((function(e){return e.sid})),appId:e.aid,funcId:O(e.func),sargIds:w,fargIds:g});break;default:throw new Error}L.add(e)}}var F=!0,I=!1,R=void 0;try{for(var _,M=t.body.exprs[Symbol.iterator]();!(F=(_=M.next()).done);F=!0){var U=_.value;if(U.kind===p.YieldExpression){C(U.expr);var B=T(U.expr);if(!B)throw new Error;f[U.idx]=B}else{if(!w(U))throw new Error;C(U)}}}catch($){I=!0,R=$}finally{try{F||null==M.return||M.return()}finally{if(I)throw R}}return[{streamParamIds:t.sparams.map((function(e){return e.sid})),funcParamIds:t.fparams.map((function(e){return e.fid})),constStreams:c,apps:d,localDefs:l,yieldIds:f},v]}(e,r,new j(n)),a=Object(s.a)(i,2),o=a[0];if(a[1].size>0)throw new Error;return o}var M=r(4);var U=r(32),B=U.showString,$=U.animationTime,q=U.mouseDown,V=U.changeCount,Y=U.streamMap,z=U.audioDriver,G=U.random,H=U.mouseClickEvts,W=U.redCircle,K=U.mousePosition,J=U.latestValue,X=r(13),Q=X.h,Z=X.renderDOMIntoSelector;function ee(e,t){return{kind:p.Signature,streamParams:e.map((function(e){return{kind:p.SignatureStreamParameter}})),funcParams:[],yields:t?[{kind:p.SignatureYield}]:[],returnedIdx:t?0:void 0}}var te=[["bind","$o0 = $s0",{kind:p.Signature,streamParams:[{kind:p.SignatureStreamParameter},{kind:p.SignatureStreamParameter}],funcParams:[],yields:[{kind:p.SignatureYield}],returnedIdx:void 0},function(e){return e}],["ifte","if $s0 | then $s1 | else $s2",ee(["_cond","then","else"],!0),function(e,t,r){return e?t:r}],["equals","$s0 equals $s1",ee(["",""],!0),function(e,t){return Object.is(e,t)}],["changeCount","",ee(["_stream"],!0),V],["latestValue","",ee(["event stream","initial value"],!0),J],["add","$s0 + $s1",ee(["",""],!0),function(e,t){return e+t}],["sub","$s0 - $s1",ee(["",""],!0),function(e,t){return e-t}],["mult","$s0 * $s1",ee(["",""],!0),function(e,t){return e*t}],["div","$s0 / $s1",ee(["",""],!0),function(e,t){return e/t}],["cos","cosine of $s0 radians",ee([""],!0),Math.cos],["sqr","$s0 squared",ee([""],!0),function(e){return e*e}],["showString","show value $s0",ee([""],!1),B],["animationTime","animation time",ee([],!0),$],["mouseDown","mouse button is down",ee([],!0),q],["mousePosition","mouse position",ee([],!0),K],["mouseClickEvts","mouse clicks",ee([],!0),H],["redCircle","draw red circle at $s0 radius $s1",ee(["position","radius"],!1),W],["random","random from 0 to 1, | repick on $s0",ee(["repick"],!0),G],["vec2zero","zero 2d vector",ee([],!0),function(){return{x:0,y:0}}],["vec2add","add 2d vectors $s0 and $s1",ee(["",""],!0),function(e,t){return{x:e.x+t.x,y:e.y+t.y}}],["vec2sub","subtract 2d vectors $s0 and $s1",ee(["",""],!0),function(e,t){return{x:e.x-t.x,y:e.y-t.y}}],["vec2len","length of 2d vector $s0",ee([""],!0),function(e){return Math.sqrt(e.x*e.x+e.y*e.y)}],["vec2sqgrid","square grid of 2d vectors, $s0 per side, $s1 long",ee(["",""],!0),function(e,t){for(var r=t/e,n=[],i=0;i<e;i++)for(var a=0;a<e;a++)n.push({x:a*r,y:i*r});return n}],["text2num","text $s0 as a number",ee([""],!0),function(e){return Number(e)}],["snabbdom.renderDOMIntoSelector","render HTML $s0 | into selector $s1",ee(["",""],!1),Z],["snabbdom.span","<span> $s0 </span>",ee([""],!0),function(e){return Q("span",{},e)}],["snabbdom.div","<div> $s0 </div>",ee([""],!0),function(e){return Q("div",{},e)}],["snabbdom.input","<input | text\u2192 $o1 | prefill= $s0 | />",{kind:p.Signature,streamParams:[{kind:p.SignatureStreamParameter}],funcParams:[],yields:[{kind:p.SignatureYield},{kind:p.SignatureYield}],returnedIdx:0},function(e){var t="string"===typeof e?e:"",r=Object(M.useCallbackReducer)((function(e,t){return t.target.value}),t),n=Object(s.a)(r,2),i=n[0],a=n[1];return[Q("input",{on:{input:a},attrs:{value:i}}),i]}],["streamMap","map over $s0 with $f0",{kind:p.Signature,streamParams:[{kind:p.SignatureStreamParameter}],funcParams:[{kind:p.SignatureFunctionParameter,sig:{kind:p.Signature,streamParams:[{kind:p.SignatureStreamParameter}],funcParams:[],yields:[{kind:p.SignatureYield}],returnedIdx:0},templateNames:{streamParams:["elem"],funcParams:[],yields:["new elem"]}}],yields:[{kind:p.SignatureYield}],returnedIdx:0},function(e,t){return Y(t,e)}],["audioDriver","play audio, computing each sample as $f0",{kind:p.Signature,streamParams:[],funcParams:[{kind:p.SignatureFunctionParameter,sig:{kind:p.Signature,streamParams:[{kind:p.SignatureStreamParameter},{kind:p.SignatureStreamParameter},{kind:p.SignatureStreamParameter}],funcParams:[],yields:[{kind:p.SignatureYield}],returnedIdx:0},templateNames:{streamParams:["audio time","next frame","sample rate"],funcParams:[],yields:["sample"]}}],yields:[],returnedIdx:void 0},z]];function re(e){var t=new j,r=!0,n=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value;t.set(u.fid,u)}}catch(c){n=!0,i=c}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return{streamEnv:new j,functionEnv:t}}function ne(e,t){var r=new j(e.streamEnv),n=new j(e.functionEnv);t.sparams.forEach((function(e){var t=e.sid,n=e.name;if(r.has(t))throw new Error;r.set(t,{kind:"param",sid:t,name:n,param:e})}));return P(t.body,(function e(t){if(w(t)&&t.kind===p.Application&&t.outs.forEach((function(e){if(r.has(e.sid))throw new Error("stream ids must be unique");e.name&&r.set(e.sid,{kind:"expr",sid:e.sid,name:e.name,expr:t})})),y(t)){if(n.has(t.fid))throw new Error("function ids must be unique");n.set(t.fid,t)}else P(t,e,void 0)}),void 0),{streamEnv:r,functionEnv:n}}function ie(e,t){var r;if(function t(n,i){var a;a=n.kind===p.TreeFunctionDefinition?ne(i,n):i,n===e.selectedNode&&(r=a),P(n,t,a)}(e.mainDefinition,re(t)),!r)throw new Error;return r}function ae(e,t,r){var n=r.get(e);return n?ae(n,function(e,t,r){var n,i,a=function(e){if(e===t){if(r.kind!==p.Signature)throw new Error;return r}return e},o=function(e){return e.map((function(e){if(e===t){if(!w(r))throw new Error;return r}return e}))};switch(e.kind){case p.Name:case p.UndefinedLiteral:case p.NumberLiteral:case p.TextLiteral:case p.BooleanLiteral:case p.StreamReference:case p.FunctionReference:throw new Error("no children to replace");case p.SignatureStreamParameter:case p.SignatureFunctionParameter:case p.SignatureYield:throw new Error("no children to replace");case p.ArrayLiteral:return Object(u.a)({},e,{elems:o(e.elems)});case p.Application:return Object(u.a)({},e,{func:function(e){if(e===t){if(!b(r))throw new Error;return r}return e}(e.func),outs:(i=e.outs,i.map((function(e){if(e.name===t){if(r.kind!==p.Name)throw new Error;return Object(u.a)({},e,{name:r})}return e}))),sargs:o(e.sargs),fargs:(n=e.fargs,n.map((function(e){if(e===t){if(!b(r))throw new Error;return r}return e})))});case p.Signature:return Object(u.a)({},e);case p.StreamParameter:case p.FunctionParameter:return Object(u.a)({},e,{name:function(e){if(e===t){if(r.kind!==p.Name)throw new Error;return r}return e}(e.name)});case p.YieldExpression:return Object(u.a)({},e,{expr:function(e){if(e===t){if(!w(r))throw new Error;return r}return e}(e.expr)});case p.TreeFunctionBody:return Object(u.a)({},e,{exprs:function(e){return e.map((function(e){if(e===t){if(!g(r))throw new Error;return r}return e}))}(e.exprs)});case p.TreeFunctionDefinition:return Object(u.a)({},e,{sig:a(e.sig),body:function(e){if(e===t){if(r.kind!==p.TreeFunctionBody)throw new Error;return r}return e}(e.body)});case p.NativeFunctionDefinition:return Object(u.a)({},e,{sig:a(e.sig)});default:throw new Error}}(n,e,t),r):t}function oe(e,t,r){switch(e.type){case"DELETE_SUBTREE":return function(e,t){var r=function(e,t){var r=t.indexOf(e);if(r<0)throw new Error;var n=t.slice(0,r).concat(t.slice(r+1));return[n,0===n.length?void 0:r===t.length-1?n[r-1]:n[r]]},n=t.get(e);if(n&&w(e)){if(n.kind===p.Application||n.kind===p.YieldExpression){var i={kind:p.UndefinedLiteral,sid:v()},a=ae(e,i,t);if(a.kind!==p.TreeFunctionDefinition)throw new Error;return{mainDefinition:a,selectedNode:i}}if(n.kind===p.ArrayLiteral){var o=r(e,n.elems),c=Object(s.a)(o,2),d=c[0],l=c[1],f=Object(u.a)({},n,{elems:d}),m=ae(n,f,t);if(m.kind!==p.TreeFunctionDefinition)throw new Error;return{mainDefinition:m,selectedNode:l||f}}if(n.kind===p.TreeFunctionBody){var h=r(e,n.exprs),g=Object(s.a)(h,2),y=g[0],b=g[1],E=Object(u.a)({},n,{exprs:y}),x=ae(n,E,t);if(x.kind!==p.TreeFunctionDefinition)throw new Error;return{mainDefinition:x,selectedNode:b||E}}throw new Error}}(t.selectedNode,r)}}function ue(e){var t=new Map;return function e(r){var n=!0,i=!1,a=void 0;try{for(var o,u=I(r)[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var c=o.value;t.set(c,r)}}catch(s){i=!0,a=s}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}P(r,e,void 0)}(e),t}function ce(e){return w(t=e.stableSelTree.selectedNode)||t.kind===p.Name?Object(u.a)({},e,{editing:{sessionId:f(),initSelTree:e.stableSelTree,curSelTree:e.stableSelTree,compileError:void 0,isInsert:!1,infixMode:!1}}):(console.log("Can't edit this node"),e);var t}function se(e,t,r,n){var i=r?t:t+1;return[].concat(Object(c.a)(e.slice(0,i)),[n],Object(c.a)(e.slice(i)))}function de(e,t){for(var r=ue(e.stableSelTree.mainDefinition),n=e.stableSelTree.selectedNode;;){var i=r.get(n);if(!i)return e;if(i.kind===p.ArrayLiteral){var a=i.elems.indexOf(n),o={kind:p.UndefinedLiteral,sid:v()},c=ae(i,Object(u.a)({},i,{elems:se(i.elems,a,t,o)}),r);if(c.kind!==p.TreeFunctionDefinition)throw new Error;var s={mainDefinition:c,selectedNode:o};return Object(u.a)({},e,{editing:{sessionId:f(),initSelTree:s,curSelTree:s,compileError:void 0,isInsert:!0,infixMode:!1}})}if(i.kind===p.TreeFunctionBody){var d=i.exprs.indexOf(n),l={kind:p.UndefinedLiteral,sid:v()},m=ae(i,Object(u.a)({},i,{exprs:se(i.exprs,d,t,l)}),r);if(m.kind!==p.TreeFunctionDefinition)throw new Error;var h={mainDefinition:m,selectedNode:l};return Object(u.a)({},e,{editing:{sessionId:f(),initSelTree:h,curSelTree:h,compileError:void 0,isInsert:!0,infixMode:!1}})}n=i}}function le(e){return Object(u.a)({},e,{undoStack:e.undoStack.concat([e.stableSelTree])})}function fe(e,t){var r=re(t),n=new Map,i=function e(t,r){var i=t;t.kind===p.StreamReference&&(r.streamEnv.get(t.ref)||(i={kind:p.UndefinedLiteral,sid:v()}));var a=function(e,t,r){var n=function(e){var n=!1,i=e.map((function(e){var i=t(e,r);if(!w(i))throw new Error;return i!==e&&(n=!0),i}));return n?i:e},i=function(e){var n=t(e,r);if(n.kind!==p.Signature)throw new Error;return n};switch(e.kind){case p.Name:case p.UndefinedLiteral:case p.NumberLiteral:case p.TextLiteral:case p.BooleanLiteral:case p.StreamReference:case p.FunctionReference:return e;case p.SignatureStreamParameter:case p.SignatureFunctionParameter:case p.SignatureYield:return e;case p.ArrayLiteral:var a=n(e.elems);return a===e.elems?e:Object(u.a)({},e,{elems:a});case p.Application:var o=function(e){var n=t(e,r);if(!b(n))throw new Error;return n}(e.func),c=function(e){var n=!1,i=e.map((function(e){if(e.name){var i=t(e.name,r);if(i.kind!==p.Name)throw new Error;return i!==e.name&&(n=!0),Object(u.a)({},e,{name:i})}return e}));return n?i:e}(e.outs),s=n(e.sargs),d=function(e){var n=!1,i=e.map((function(e){var i=t(e,r);if(!b(i))throw new Error;return i!==e&&(n=!0),i}));return n?i:e}(e.fargs);return o===e.func&&c===e.outs&&s===e.sargs&&d===e.fargs?e:Object(u.a)({},e,{func:o,outs:c,sargs:s,fargs:d});case p.Signature:return e;case p.YieldExpression:var l=function(e){var n=t(e,r);if(!w(n))throw new Error;return n}(e.expr);return l===e.expr?e:Object(u.a)({},e,{expr:l});case p.StreamParameter:case p.FunctionParameter:var f=function(e){var n=t(e,r);if(n.kind!==p.Name)throw new Error;return n}(e.name);return f===e.name?e:Object(u.a)({},e,{name:f});case p.TreeFunctionBody:var v=function(e){var n=!1,i=e.map((function(e){var i=t(e,r);if(!g(i))throw new Error;return i!==e&&(n=!0),i}));return n?i:e}(e.exprs);return v===e.exprs?e:Object(u.a)({},e,{exprs:v});case p.TreeFunctionDefinition:var m=i(e.sig),h=function(e){var n=!1,i=e.map((function(e){var i=t(e,r);if(i.kind!==p.StreamParameter)throw new Error;return i!==e&&(n=!0),i}));return n?i:e}(e.sparams),y=function(e){var n=!1,i=e.map((function(e){var i=t(e,r);if(i.kind!==p.FunctionParameter)throw new Error;return i!==e&&(n=!0),i}));return n?i:e}(e.fparams),E=function(e){var n=t(e,r);if(n.kind!==p.TreeFunctionBody)throw new Error;return n}(e.body);return m===e.sig&&h===e.sparams&&y===e.fparams&&E===e.body?e:Object(u.a)({},e,{sig:m,sparams:h,fparams:y,body:E});case p.NativeFunctionDefinition:var x=i(e.sig);return x===e.sig?e:Object(u.a)({},e,{sig:x});default:throw new Error}}(i,e,t.kind===p.TreeFunctionDefinition?ne(r,t):r);return a!==t&&n.set(t,a),a}(e.mainDefinition,r);if(i.kind!==p.TreeFunctionDefinition)throw new Error;return{mainDefinition:i,selectedNode:n.get(e.selectedNode)||e.selectedNode}}function ve(e,t){var r=new j,n=!0,i=!1,a=void 0;try{for(var o,u=t[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var c=o.value;r.set(c.fid,c)}}catch(s){i=!0,a=s}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return _(e.mainDefinition,r)}function me(e,t){if(e.execution){var r=e.execution.updateCompiledDefinition;return Object(M.beginBatch)(),r(t),Object(M.endBatch)(),e}var n=function e(t,r,n){var i=new Set,a=t;return[function(){var t=Object(M.useRequestUpdate)(),o=Object(M.useVar)((function(){var i=new j(r),o=new j(n),u=new Map,c=new Map,d=!0,l=!1,f=void 0;try{for(var v,m=a.constStreams[Symbol.iterator]();!(d=(v=m.next()).done);d=!0){var p=v.value,h=p.sid,w=p.val;i.set(h,w)}}catch($){l=!0,f=$}finally{try{d||null==m.return||m.return()}finally{if(l)throw f}}var g=!0,y=!1,b=void 0;try{for(var E,x=a.apps[Symbol.iterator]();!(g=(E=x.next()).done);g=!0){var k=E.value,S=k.appId,N=k.funcId,T=o.get(N);if(!T)throw Error();var O=new M.ExecutionContext(T,t);u.set(S,O)}}catch($){y=!0,b=$}finally{try{g||null==x.return||x.return()}finally{if(y)throw b}}var D=!0,L=!1,C=void 0;try{for(var F,I=a.localDefs[Symbol.iterator]();!(D=(F=I.next()).done);D=!0){var R=F.value,P=R.fid,A=e(R.def,i,o),_=Object(s.a)(A,2),U=_[0],B=_[1];o.set(P,U),c.set(P,B)}}catch($){L=!0,C=$}finally{try{D||null==I.return||I.return()}finally{if(L)throw C}}return{streamEnv:i,funcEnv:o,applicationContexts:u,updateLocalDef:c,requestUpdate:t}}));Object(M.useInitialize)((function(){return i.add(o.current),function(){o.current.applicationContexts.forEach((function(e){e.terminate()})),i.delete(o.current)}}));var u=o.current,d=u.streamEnv,l=u.funcEnv,f=u.applicationContexts,v=a.streamParamIds.length+a.funcParamIds.length;if(arguments.length!==v)throw new Error("wrong number of arguments to live function, got "+arguments.length+" expected "+v);var m=arguments;a.streamParamIds.forEach((function(e,t){d.set(e,m[t])}));var p=!0,h=!1,w=void 0;try{for(var g,y=function(){var e=g.value,t=e.sids,r=e.appId,n=e.funcId,i=e.sargIds,a=e.fargIds,o=l.getExisting(n),u=i.map((function(e){return d.getExisting(e)})),s=a.map((function(e){return l.getExisting(e)})),v=f.get(r);if(!v)throw new Error;v._setStreamFunc(o);var m=void 0,p=void 0;try{m=v.update.apply(v,Object(c.a)(u).concat(Object(c.a)(s))),p=!1}catch(h){console.log("application error",h),p=!0}1===t.length?d.set(t[0],p?void 0:m):t.length>1&&t.forEach((function(e,t){d.set(e,p?void 0:m[t])}))},b=a.apps[Symbol.iterator]();!(p=(g=b.next()).done);p=!0)y()}catch(E){h=!0,w=E}finally{try{p||null==b.return||b.return()}finally{if(h)throw w}}return 1===a.yieldIds.length?d.get(a.yieldIds[0]):a.yieldIds.length>1?a.yieldIds.map((function(e){return d.get(e)})):void 0},function(t){if(JSON.stringify(t)!==JSON.stringify(a)){var r=new Set,n=new Set,o=!0,u=!1,c=void 0;try{for(var d,l=a.streamParamIds[Symbol.iterator]();!(o=(d=l.next()).done);o=!0){var f=d.value;r.add(f)}}catch(Be){u=!0,c=Be}finally{try{o||null==l.return||l.return()}finally{if(u)throw c}}var v=!0,m=!1,p=void 0;try{for(var h,w=t.streamParamIds[Symbol.iterator]();!(v=(h=w.next()).done);v=!0){var g=h.value;n.add(g)}}catch(Be){m=!0,p=Be}finally{try{v||null==w.return||w.return()}finally{if(m)throw p}}var y=!0,b=!1,E=void 0;try{for(var x,k=a.constStreams[Symbol.iterator]();!(y=(x=k.next()).done);y=!0){var S=x.value.sid;r.add(S)}}catch(Be){b=!0,E=Be}finally{try{y||null==k.return||k.return()}finally{if(b)throw E}}var N=!0,T=!1,O=void 0;try{for(var D,j=function(){var e=D.value,t=e.sid,r=e.val;i.forEach((function(e){e.streamEnv.set(t,r)})),n.add(t)},L=t.constStreams[Symbol.iterator]();!(N=(D=L.next()).done);N=!0)j()}catch(Be){T=!0,O=Be}finally{try{N||null==L.return||L.return()}finally{if(T)throw O}}var C=new Map,F=new Map,I=!0,R=!1,P=void 0;try{for(var A,_=a.apps[Symbol.iterator]();!(I=(A=_.next()).done);I=!0){var U=A.value;C.set(U.appId,U),U.sids.forEach((function(e){r.add(e)}))}}catch(Be){R=!0,P=Be}finally{try{I||null==_.return||_.return()}finally{if(R)throw P}}var B=!0,$=!1,q=void 0;try{for(var V,Y=t.apps[Symbol.iterator]();!(B=(V=Y.next()).done);B=!0){var z=V.value;F.set(z.appId,z),z.sids.forEach((function(e){n.add(e)}))}}catch(Be){$=!0,q=Be}finally{try{B||null==Y.return||Y.return()}finally{if($)throw q}}var G=!0,H=!1,W=void 0;try{for(var K,J=function(){var e=K.value.appId;F.has(e)||i.forEach((function(t){var r=t.applicationContexts.get(e);if(!r)throw new Error;r.terminate(),t.applicationContexts.delete(e)}))},X=a.apps[Symbol.iterator]();!(G=(K=X.next()).done);G=!0)J()}catch(Be){H=!0,W=Be}finally{try{G||null==X.return||X.return()}finally{if(H)throw W}}var Q=!0,Z=!1,ee=void 0;try{for(var te,re=function(){var e=te.value,t=e.appId,r=e.funcId;C.has(t)||i.forEach((function(e){var n=e.funcEnv.get(r);if(!n)throw Error();var i=new M.ExecutionContext(n,e.requestUpdate);e.applicationContexts.set(t,i)}))},ne=t.apps[Symbol.iterator]();!(Q=(te=ne.next()).done);Q=!0)re()}catch(Be){Z=!0,ee=Be}finally{try{Q||null==ne.return||ne.return()}finally{if(Z)throw ee}}var ie=!0,ae=!1,oe=void 0;try{for(var ue,ce=function(){var e=ue.value;n.has(e)||i.forEach((function(t){t.streamEnv.delete(e)}))},se=r[Symbol.iterator]();!(ie=(ue=se.next()).done);ie=!0)ce()}catch(Be){ae=!0,oe=Be}finally{try{ie||null==se.return||se.return()}finally{if(ae)throw oe}}var de=new Map,le=new Map,fe=!0,ve=!1,me=void 0;try{for(var pe,he=a.localDefs[Symbol.iterator]();!(fe=(pe=he.next()).done);fe=!0){var we=pe.value,ge=we.fid,ye=we.def;de.set(ge,ye)}}catch(Be){ve=!0,me=Be}finally{try{fe||null==he.return||he.return()}finally{if(ve)throw me}}var be=!0,Ee=!1,xe=void 0;try{for(var ke,Se=t.localDefs[Symbol.iterator]();!(be=(ke=Se.next()).done);be=!0){var Ne=ke.value,Te=Ne.fid,Oe=Ne.def;le.set(Te,Oe)}}catch(Be){Ee=!0,xe=Be}finally{try{be||null==Se.return||Se.return()}finally{if(Ee)throw xe}}var De=!0,je=!1,Le=void 0;try{for(var Ce,Fe=function(){var e=Ce.value.fid;le.has(e)||i.forEach((function(t){t.funcEnv.delete(e),t.updateLocalDef.delete(e)}))},Ie=a.localDefs[Symbol.iterator]();!(De=(Ce=Ie.next()).done);De=!0)Fe()}catch(Be){je=!0,Le=Be}finally{try{De||null==Ie.return||Ie.return()}finally{if(je)throw Le}}var Re=!0,Pe=!1,Ae=void 0;try{for(var _e,Me=function(){var t=_e.value,r=t.fid,n=t.def;de.has(r)?i.forEach((function(e){var t=e.updateLocalDef.get(r);if(!t)throw new Error;t(n)})):i.forEach((function(t){var i=e(n,t.streamEnv,t.funcEnv),a=Object(s.a)(i,2),o=a[0],u=a[1];t.funcEnv.set(r,o),t.updateLocalDef.set(r,u)}))},Ue=t.localDefs[Symbol.iterator]();!(Re=(_e=Ue.next()).done);Re=!0)Me()}catch(Be){Pe=!0,Ae=Be}finally{try{Re||null==Ue.return||Ue.return()}finally{if(Pe)throw Ae}}a=t,i.forEach((function(e){e.requestUpdate()}))}}]}(t,new j,ye),i=Object(s.a)(n,2),a=i[0],o=i[1],d=Object(M.createNullaryVoidRootExecutionContext)(a);return d.update(),Object(u.a)({},e,{execution:{context:d,compiledDefinition:t,updateCompiledDefinition:o}})}function pe(e,t){var r,n=fe(t,e.nativeFunctions);try{r=ve(n,e.nativeFunctions)}catch(i){if(!(i instanceof A))throw i;r=void 0}return r?me(Object(u.a)({},e,{stableSelTree:n,editing:null}),r):Object(u.a)({},e,{editing:null})}function he(e){return e.kind===p.UndefinedLiteral||e.kind===p.Name&&!e.text}function we(e){var t=!0,r=!1,n=void 0;try{for(var i,a=I(e)[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if(he(o))return o;var u=we(o);if(u)return u}}catch(c){r=!0,n=c}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}function ge(e,t){if(console.log("action",t),"LOAD_PROGRAM"===t.type){if(!t.newProgram)throw new Error;if(!e.execution)throw new Error;return e.execution.context.terminate(),be(t.newProgram.mainDefinition,t.newProgram.info)}if("SET_PROGRAM_NAME"===t.type)return Object(u.a)({},e,{programInfo:Object(u.a)({},e.programInfo,{name:t.newName})});if("BEGIN_EDIT"===t.type){if(!e.editing)return ce(e)}else if("INSERT_BEFORE"===t.type){if(!e.editing)return de(e,!0)}else if("INSERT_AFTER"===t.type){if(!e.editing)return de(e,!1)}else{if("TOGGLE_EDIT"===t.type){if(e.editing){var r=e.editing.isInsert;return function(e,t){var r=function(t){var r={mainDefinition:e.stableSelTree.mainDefinition,selectedNode:t};return Object(u.a)({},e,{editing:{sessionId:f(),initSelTree:r,curSelTree:r,compileError:void 0,isInsert:!1,infixMode:!1}})};if(e.editing)throw new Error;var n=ue(e.stableSelTree.mainDefinition),i=we(e.stableSelTree.selectedNode);if(i)return r(i);for(var a=e.stableSelTree.selectedNode;;){var o=n.get(a);if(!o)return e;if(o.kind===p.ArrayLiteral||o.kind===p.TreeFunctionBody)return t?de(e,!1):e;var s=Object(c.a)(I(o)),d=s.indexOf(a);if(d<0)throw new Error;for(var l=d+1;l<s.length;l++){var v=s[l];if(v.kind===p.UndefinedLiteral)return r(v);var m=we(v);if(m)return r(m)}a=o}}(pe(Object(u.a)({},le(e)),e.editing.curSelTree),r)}return ce(e)}if("INFIX_EDIT"===t.type)return e.editing?Object(u.a)({},e,{editing:{sessionId:f(),initSelTree:e.editing.curSelTree,curSelTree:e.editing.curSelTree,compileError:void 0,isInsert:!1,infixMode:!0}}):Object(u.a)({},e,{editing:{sessionId:f(),initSelTree:e.stableSelTree,curSelTree:e.stableSelTree,compileError:void 0,isInsert:!1,infixMode:!0}});if("ABORT_EDIT"===t.type){if(e.editing)return Object(u.a)({},e,{editing:null})}else{if("UPDATE_EDITING_NODE"===t.type){if(!e.editing)throw new Error;var n=ue(e.editing.initSelTree.mainDefinition),i=ae(e.editing.initSelTree.selectedNode,t.newNode,n);if(i.kind!==p.TreeFunctionDefinition)throw new Error;var a,o=fe({mainDefinition:i,selectedNode:t.newNode},e.nativeFunctions);try{ve(o,e.nativeFunctions),a=void 0}catch(h){if(!(h instanceof A))throw h;a="cyclic reference"}return Object(u.a)({},e,{editing:Object(u.a)({},e.editing,{curSelTree:o,compileError:a})})}if("UNDO"===t.type){if(e.undoStack.length>0){var s=e.undoStack[e.undoStack.length-1];return pe(Object(u.a)({},e,{undoStack:e.undoStack.slice(0,e.undoStack.length-1)}),s)}return console.log("nothing to undo"),e}if("SET_SELECTED_NODE"===t.type){var d=t.newNode;return d!==e.stableSelTree.selectedNode?Object(u.a)({},e,{stableSelTree:Object(u.a)({},e.stableSelTree,{selectedNode:d}),editing:null}):e}}}var l=ue(e.stableSelTree.mainDefinition),v=oe(t,e.stableSelTree,l);if(v){var m=v;return m!==e.stableSelTree?pe(Object(u.a)({},le(e)),m):e}return"CUT"===t.type||t.type,console.log("action not handled"),e}var ye=new j;function be(e,t){var r=te.map((function(e){var t=Object(s.a)(e,3),r=t[0],n=t[1],i=t[2];return{kind:p.NativeFunctionDefinition,fid:r,sig:i,ui:"string"===typeof n?{kind:"tmplstr",tmplStr:n}:{kind:"none"}}})),n={mainDefinition:e,selectedNode:e};return me({programInfo:t,stableSelTree:n,editing:null,nativeFunctions:r,undoStack:[],clipboardStack:[],execution:null},ve(n,r))}ye.set("id",(function(e){return e})),ye.set("Array_of",Array.of),te.forEach((function(e){var t=Object(s.a)(e,4),r=t[0],n=t[3];ye.set(r,n)}));var Ee=v(),xe=be({kind:p.TreeFunctionDefinition,fid:m(),sig:{kind:p.Signature,streamParams:[],funcParams:[],yields:[],returnedIdx:void 0},ui:{kind:"none"},sparams:[],fparams:[],body:{kind:p.TreeFunctionBody,exprs:[{kind:p.Application,aid:h(),outs:[{sid:Ee,name:{kind:p.Name,text:"md"}}],func:{kind:p.FunctionReference,ref:"bind"},sargs:[{kind:p.Application,aid:h(),outs:[{sid:v(),name:null}],func:{kind:p.FunctionReference,ref:"mouseDown"},sargs:[],fargs:[]}],fargs:[]},{kind:p.Application,aid:h(),outs:[],func:{kind:p.FunctionReference,ref:"showString"},sargs:[{kind:p.Application,aid:h(),outs:[{sid:v(),name:null}],func:{kind:p.FunctionReference,ref:"ifte"},sargs:[{kind:p.StreamReference,ref:Ee},{kind:p.Application,aid:h(),outs:[{sid:v(),name:null}],func:{kind:p.FunctionReference,ref:"cos"},sargs:[{kind:p.NumberLiteral,sid:v(),val:10}],fargs:[]},{kind:p.NumberLiteral,sid:v(),val:20}],fargs:[]}],fargs:[]}]}},{id:f(),name:"my program"}),ke=(r(40),function(e){var t=e.programInfo,r=e.mainDefinition,a=e.onChangeName,o=e.onLoadProgram,c=window.localStorage,d=Object(n.useState)(),l=Object(s.a)(d,2),v=l[0],m=l[1],p=Object(n.useState)([]),h=Object(s.a)(p,2),w=h[0],g=h[1],y=Object(n.useCallback)((function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=void 0===e?v:e,r=[],n=0;n<c.length;n++){var i=c.key(n);if(null===i)throw new Error;if(i.startsWith("rivprog:")){var a=c.getItem(i);if(null===a)throw new Error;var o=JSON.parse(a);r.push(o)}}g(r);var u=r.map((function(e){return e.info.id}));u.includes(t)||(t=void 0),m(t)}),[v,c]);Object(n.useEffect)((function(){y()}),[y]);var b=Object(n.useRef)(null);return i.a.createElement("div",{className:"StoragePanel"},i.a.createElement("h2",null,"Storage"),i.a.createElement("div",null,i.a.createElement("span",null,"Current Program:")," ",i.a.createElement("label",null,"UID: ",i.a.createElement("span",null,t.id))," ",i.a.createElement("label",null,"Name: ",i.a.createElement("input",{value:t.name,onChange:function(e){a&&a(e.target.value)}}))," ",i.a.createElement("button",{onClick:function(){var e="rivprog:"+t.id,n={info:t,mainDefinition:r},i=JSON.stringify(n);c.setItem(e,i),y(n.info.id)}},"Save")," ",i.a.createElement("button",{onClick:function(){o(Object(u.a)({},t,{id:f()}),r)}},"Clone")," ",i.a.createElement("button",{disabled:!0},"Import")," ",i.a.createElement("button",{disabled:!0},"Export")," "),i.a.createElement("div",null,i.a.createElement("span",null,"Saved Programs:")," ",i.a.createElement("select",{ref:b,value:v,onChange:function(e){m(e.target.value)}},w.map((function(e){return i.a.createElement("option",{key:e.info.id,value:e.info.id},e.info.name," <",e.info.id,">")})))," ",i.a.createElement("button",{onClick:function(){if(b.current&&b.current.value){var e=b.current.value,t=w.filter((function(t){return t.info.id===e}));if(1!==t.length)throw new Error;o(t[0].info,t[0].mainDefinition)}},disabled:0===w.length},"Load")," ",i.a.createElement("button",{onClick:function(){if(b.current&&b.current.value){var e="rivprog:"+b.current.value;c.removeItem(e),y()}},disabled:0===w.length},"Delete")," "))});r(41),r(42);function Se(e){var t=e.split(/(\$[a-z0-9]+|\|)/).map((function(e){return e.trim()})).filter((function(e){return e})),r=[],n=!0,i=!1,a=void 0;try{for(var o,u=t[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var c=o.value;c.startsWith("$")?r.push({kind:"wildcard",key:c.substr(1)}):c.startsWith("|")?r.push({kind:"linebreak"}):r.push({kind:"text",text:c})}}catch(s){i=!0,a=s}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return r}var Ne=r(17),Te=r.n(Ne),Oe=r(18),De=r.n(Oe);function je(e,t,r){var i=Object(n.useState)(!1),a=Object(s.a)(i,2),o=a[0],u=a[1],c=[],d=r.markedNodes.selected===e,l=r.markedNodes.referentName===e;return d&&c.push("TreeView-selected"),l&&c.push("TreeView-referent"),o&&c.push("TreeView-hovered"),Object(n.useLayoutEffect)((function(){r.focusSelected&&d&&t.current&&t.current.focus()})),{classes:c,handlers:{onClick:function(t){"INPUT"!==t.target.tagName&&(t.stopPropagation(),r.setSelectedNode(e))},onMouseOver:function(e){u(!0),e.stopPropagation()},onMouseOut:function(e){u(!1)},tabIndex:0}}}var Le=function(e){var t=e.treeNode,r=e.content,a=e.icon,o=e.bgColor,u=e.ctx,c=Object(n.useRef)(null),s=je(t,c,u),d=s.classes,l=s.handlers;return i.a.createElement("div",Object.assign({ref:c,className:d.concat(["TreeView-node","TreeView-simple-node"]).join(" ")},l,{style:{background:o}}),a&&i.a.createElement("img",{className:"TreeView-simple-node-icon",src:a[0],alt:a[1]}),r)},Ce=function(e){var t=e.treeNode,r=e.content,n=e.icon,a=e.bgColor,o=e.ctx;return{singleLineWidth:r.length,reactNode:i.a.createElement(Le,{treeNode:t,content:r,icon:n,bgColor:a,ctx:o})}},Fe=new WeakMap,Ie=0;var Re=function(e){var t=e.node,r=e.layout,a=e.groupingLines,o=e.ctx,u=Object(n.useRef)(null),c=je(t,u,o),s=c.classes,d=c.handlers,l=[];return i.a.createElement("div",Object.assign({ref:u,className:s.concat(["TreeView-row-view TreeView-node"]).join(" ")},d,{onKeyDown:function(e){if(!(e.getModifierState("Alt")||e.getModifierState("Control")||e.getModifierState("Meta")||e.getModifierState("Shift")))if("ArrowRight"===e.key&&u.current===e.target)l.length>0&&(e.stopPropagation(),o.setSelectedNode(l[0][0].treeNode));else if("ArrowLeft"===e.key||"ArrowRight"===e.key||"ArrowUp"===e.key||"ArrowDown"===e.key){var r=!1;l.forEach((function(n,i){n.forEach((function(a,u){if(a.ref.current&&a.ref.current.contains(e.target)){if(r)throw new Error;if(r=!0,"ArrowLeft"===e.key)if(e.stopPropagation(),0===u)o.setSelectedNode(t);else{var c=u-1;o.setSelectedNode(l[i][c].treeNode)}else if("ArrowRight"===e.key){if(u<n.length-1){e.stopPropagation();var s=u+1;o.setSelectedNode(l[i][s].treeNode)}}else if("ArrowUp"===e.key&&0===i)e.stopPropagation(),o.setSelectedNode(t);else if("ArrowDown"===e.key&&i===l.length-1);else if("ArrowUp"===e.key||"ArrowDown"===e.key){var d=i+("ArrowDown"===e.key?1:-1);e.stopPropagation(),o.setSelectedNode(l[d][0].treeNode)}}}))}))}}}),r.map((function(e,t){var n=[],o=[];e.items.forEach((function(e,t){if("string"===typeof e){var r=t;o.push(i.a.createElement("div",{className:"TreeView-row-view-plain-text",key:r},e))}else{var a=i.a.createRef();e.treeNode&&n.push({ref:a,treeNode:e.treeNode});var u=e.treeNode?function(e){var t=Fe.get(e);if(t)return t;var r=Ie;return Ie++,Fe.set(e,r),r}(e.treeNode):t;o.push(i.a.createElement("div",{ref:a,key:u},e.sizedReactNode.reactNode))}})),n.length>0&&l.push(n);var u=["TreeView-row-view-row"];return e.indent&&(a&&t<r.length-1?u.push("TreeView-row-view-row-indented-with-line"):u.push("TreeView-row-view-row-indented-without-line")),i.a.createElement("div",{key:t,className:u.join(" ")},o)})))},Pe=function(e){var t=e.node,r=e.layout,n=e.groupingLines,a=e.ctx,o=void 0;if(1===r.length){if(r[0].indent)throw new Error;o=0;var u=!0,c=!1,s=void 0;try{for(var d,l=r[0].items[Symbol.iterator]();!(u=(d=l.next()).done);u=!0){var f=d.value;"string"===typeof f?void 0!==o&&(o+=f.length):void 0===f.sizedReactNode.singleLineWidth?o=void 0:void 0!==o&&(o+=f.sizedReactNode.singleLineWidth)}}catch(v){c=!0,s=v}finally{try{u||null==l.return||l.return()}finally{if(c)throw s}}}return{singleLineWidth:o,reactNode:i.a.createElement(Re,{node:t,layout:r,groupingLines:n,ctx:a})}},Ae=function(e){var t=e.node,r=e.template,n=e.nodeMap,a=e.groupingLines,o=e.ctx,u=function(e){var t=[],i=[],a=0,o=0,u=function(){i.length>0&&t.push({indent:!1,items:i}),i=[],a=0},c=!0,s=!1,d=void 0;try{for(var l,f=Se(r)[Symbol.iterator]();!(c=(l=f.next()).done);c=!0){var v=l.value;if("wildcard"===v.kind){var m=n.get(v.key);if(!m)throw new Error;void 0!==m.sizedReactNode.singleLineWidth&&a+m.sizedReactNode.singleLineWidth<=30?(i.push(m),a+=m.sizedReactNode.singleLineWidth,void 0!==o&&(o+=m.sizedReactNode.singleLineWidth)):(u(),t.push({indent:!0,items:[m]}),o=void 0)}else if("linebreak"===v.kind)e||(u(),o=void 0);else{if("text"!==v.kind){throw new Error}var p=0===i.length&&t.length>0;i.push((p?"\u2026":"")+v.text),a+=v.text.length,void 0!==o&&(o+=v.text.length)}}}catch(h){s=!0,d=h}finally{try{c||null==f.return||f.return()}finally{if(s)throw d}}return u(),[t,o]},c=u(!0),d=Object(s.a)(c,2),l=d[0],f=d[1];if(void 0!==f&&f<=30)return{singleLineWidth:f,reactNode:i.a.createElement(Re,{node:t,layout:l,groupingLines:a,ctx:o})};var v=u(!1),m=Object(s.a)(v,1)[0];return{singleLineWidth:void 0,reactNode:i.a.createElement(Re,{node:t,layout:m,groupingLines:a,ctx:o})}},_e=function(e){var t=e.node,r=e.ctx;return Ce({treeNode:t,content:t.text||"\xa0\xa0\xa0\xa0",bgColor:"#d1e6ff",ctx:r})},Me=function(e){var t=e.node,r=e.ctx;switch(t.kind){case p.UndefinedLiteral:return Ce({treeNode:t,content:"\xa0\xa0\xa0\xa0",bgColor:"#faa",ctx:r});case p.NumberLiteral:return Ce({treeNode:t,content:t.val.toString(),bgColor:"#cce8cc",ctx:r});case p.TextLiteral:return Ce({treeNode:t,content:t.val,icon:[Te.a,"text"],bgColor:"#fff3b9",ctx:r});case p.BooleanLiteral:return Ce({treeNode:t,content:t.val.toString(),icon:[De.a,"boolean"],bgColor:"#f0d4ff",ctx:r});case p.ArrayLiteral:return function(e){var t=e.node,r=e.ctx,n=[];n.push({indent:!1,items:["["]});var i=!0,a=!1,o=void 0;try{for(var u,c=t.elems[Symbol.iterator]();!(i=(u=c.next()).done);i=!0){var s=u.value;n.push({indent:!0,items:[{treeNode:s,sizedReactNode:Be({node:s,ctx:r})}]})}}catch(d){a=!0,o=d}finally{try{i||null==c.return||c.return()}finally{if(a)throw o}}return n.push({indent:!1,items:["]"]}),Pe({node:t,layout:n,groupingLines:!0,ctx:r})}({node:t,ctx:r});case p.StreamReference:return function(e){var t=e.node,r=e.ctx,n=r.staticEnv.streamEnv.get(t.ref);if(!n)throw new Error;return Ce({treeNode:t,content:n.name.text||"\xa0\xa0\xa0\xa0",bgColor:"#a1cdff",ctx:r})}({node:t,ctx:r});case p.Application:return function(e){var t=e.node,r=e.ctx;if(t.func.kind!==p.FunctionReference)throw new Error("unimplemented");var n=r.staticEnv.functionEnv.get(t.func.ref);if(!n)throw new Error;var i=new Map;switch(t.sargs.forEach((function(e,t){i.set("s"+t,{treeNode:e,sizedReactNode:Me({node:e,ctx:r})})})),t.fargs.forEach((function(e,t){i.set("f"+t,{treeNode:e,sizedReactNode:qe({node:e,ctx:r})})})),t.outs.forEach((function(e,t){e.name&&i.set("o"+t,{treeNode:e.name,sizedReactNode:_e({node:e.name,ctx:r})})})),n.ui.kind){case"none":throw new Error;case"tmplstr":return Ae({node:t,template:n.ui.tmplStr||"empty template string for "+n.fid,nodeMap:i,groupingLines:!0,ctx:r});default:n.ui;throw new Error}}({node:t,ctx:r});default:throw new Error}},Ue=function(e){var t=e.node,r=e.ctx,n=Me({node:t,ctx:r}).reactNode;return i.a.createElement(i.a.Fragment,null,n)},Be=function(e){var t=e.node,r=e.ctx;if(w(t))return Me({node:t,ctx:r});if(b(t))throw new Error("unimplemented");if(t.kind===p.YieldExpression)return Ae({node:t,template:"$name \u2190 $expr",nodeMap:new Map([["name",{treeNode:t.name,sizedReactNode:_e({node:t.name,ctx:r})}],["expr",{treeNode:t.expr,sizedReactNode:Me({node:t.expr,ctx:r})}]]),groupingLines:!0,ctx:r});throw new Error("unreachable")},$e=function(e){var t=e.node,r=e.ctx,n=[],a=Object(u.a)({},r,{staticEnv:ne(r.staticEnv,t)});(t.sparams.length>0||t.fparams.length>0)&&(n.push({indent:!1,items:["given"]}),t.sparams.forEach((function(e){n.push({indent:!0,items:[{treeNode:e.name,sizedReactNode:_e({node:e.name,ctx:a})}]})})),t.fparams.forEach((function(e){n.push({indent:!0,items:[{treeNode:e.name,sizedReactNode:_e({node:e.name,ctx:a})}]})})));var o=!0,c=!1,s=void 0;try{for(var d,l=t.body.exprs[Symbol.iterator]();!(o=(d=l.next()).done);o=!0){var f=d.value;n.push({indent:!1,items:[{treeNode:f,sizedReactNode:Be({node:f,ctx:a})}]})}}catch(h){c=!0,s=h}finally{try{o||null==l.return||l.return()}finally{if(c)throw s}}var v=Pe({node:t,layout:n,groupingLines:!1,ctx:a}),m=v.singleLineWidth,p=v.reactNode;return{singleLineWidth:m,reactNode:i.a.createElement("div",{className:"TreeView-tree-function-definition-inner"},p)}},qe=function(e){var t=e.node,r=e.ctx;if(t.kind===p.FunctionReference)throw new Error("unimplemented");if(y(t))return function(e){var t=e.node,r=e.ctx;if(t.kind===p.TreeFunctionDefinition)return $e({node:t,ctx:r});if(t.kind===p.NativeFunctionDefinition)throw new Error("unimplemented");throw new Error("unreachable")}({node:t,ctx:r});throw new Error("unreachable")},Ve=function(e){var t=e.node,r=e.ctx,n=$e({node:t,ctx:r}).reactNode;return i.a.createElement(i.a.Fragment,null,n)},Ye=(r(43),r(11)),ze=r.n(Ye);function Ge(e){switch(e.kind){case"none":return"<no ui>";case"tmplstr":return function(e){var t=[],r=!0,n=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value;"text"===u.kind&&t.push(u.text)}}catch(c){n=!0,i=c}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}return t.join(" ")}(Se(e.tmplStr));default:throw new Error}}var He=/^[-+]?(?:\d*\.?\d+|\d+\.?\d*)(?:[eE][-+]?\d+)?$/,We=function(e){var t=e.choice,r=e.treeViewCtx;return i.a.createElement(Ue,{node:t.node,ctx:r})},Ke=function(e){var t=e.initSelTree,r=(e.nativeFunctions,e.dispatch),a=e.compileError,o=e.infixMode,c=e.treeViewCtx,d=Object(n.useMemo)((function(){return ue(t.mainDefinition)}),[t.mainDefinition]).get(t.selectedNode);if(!d)throw new Error;var l=d.kind===p.TreeFunctionBody,f=Object(n.useRef)(null);Object(n.useEffect)((function(){f.current&&f.current.select()}),[]);var g=Object(n.useRef)(null);if(Object(n.useEffect)((function(){g.current&&g.current.scrollIntoView({block:"nearest",inline:"nearest"})})),!w(t.selectedNode))throw new Error;var y=t.selectedNode,b=Object(n.useState)((function(){if(o)return"";switch(y.kind){case p.UndefinedLiteral:return"";case p.NumberLiteral:return y.val.toString();case p.TextLiteral:return y.val;case p.BooleanLiteral:return y.val.toString();case p.ArrayLiteral:case p.StreamReference:case p.Application:return"";default:throw new Error}})),E=Object(s.a)(b,2),x=E[0],k=E[1],S=function(e){var t=[];""===e&&t.push({node:{kind:p.UndefinedLiteral,sid:v()}}),He.test(e)&&t.push({node:{kind:p.NumberLiteral,sid:v(),val:Number(e)}});var r=c.staticEnv.streamEnv,n=[];r.forEach((function(e){"expr"===e.kind&&e.expr===y||n.push({name:e.name.text||" ",sid:e.sid})}));var i=new ze.a(n,{keys:["name"]}).search(e),a=!0,u=!1,s=void 0;try{for(var d,f=i[Symbol.iterator]();!(a=(d=f.next()).done);a=!0){var w=d.value;t.push({node:{kind:p.StreamReference,ref:w.sid}})}}catch(C){u=!0,s=C}finally{try{a||null==f.return||f.return()}finally{if(u)throw s}}var g=c.staticEnv.functionEnv,b=[];g.forEach((function(e){if(e.ui){var t=Ge(e.ui);l?b.push({name:t,def:e}):void 0!==e.sig.returnedIdx&&b.push({name:t,def:e})}}));var E=new ze.a(b,{keys:["name"]}).search(e),x=!0,k=!1,S=void 0;try{for(var N,T=function(){var e=N.value.def,r=e.sig.yields.map((function(t,r){var n=r===e.sig.returnedIdx;return{sid:v(),name:n?null:{kind:p.Name,text:""}}})),n=e.sig.streamParams.map((function(e,t){return o&&0===t?y:{kind:p.UndefinedLiteral,sid:v()}})),i=e.sig.funcParams.map((function(e){return{kind:p.TreeFunctionDefinition,fid:m(),sig:e.sig,ui:{kind:"none"},sparams:e.templateNames.streamParams.map((function(e){return{kind:p.StreamParameter,sid:v(),name:{kind:p.Name,text:e}}})),fparams:e.templateNames.funcParams.map((function(e){return{kind:p.FunctionParameter,fid:m(),name:{kind:p.Name,text:e}}})),body:{kind:p.TreeFunctionBody,exprs:e.templateNames.yields.map((function(e,t){return{kind:p.YieldExpression,idx:t,name:{kind:p.Name,text:e},expr:{kind:p.UndefinedLiteral,sid:v()}}}))}}})),a={kind:p.Application,aid:h(),outs:r,func:{kind:p.FunctionReference,ref:e.fid},sargs:n,fargs:i};t.push({node:a})},O=E[Symbol.iterator]();!(x=(N=O.next()).done);x=!0)T()}catch(C){k=!0,S=C}finally{try{x||null==O.return||O.return()}finally{if(k)throw S}}for(var D=0,j=[!0,!1];D<j.length;D++){var L=j[D];e.length>0&&L.toString().startsWith(e)&&t.push({node:{kind:p.BooleanLiteral,sid:v(),val:L}})}return t.push({node:{kind:p.TextLiteral,sid:v(),val:e}}),l&&""!==e.trim()&&t.push({node:{kind:p.Application,aid:h(),outs:[{sid:v(),name:{kind:p.Name,text:e.trim()}}],func:{kind:p.FunctionReference,ref:"bind"},sargs:[{kind:p.UndefinedLiteral,sid:v()}],fargs:[]}}),0===t.length&&t.push({node:{kind:p.UndefinedLiteral,sid:v()}}),t},N=function(e){var t=e.choices[e.index];r({type:"UPDATE_EDITING_NODE",newNode:t.node})},T=function(e){var t={choices:S(e),index:0};return N(t),t},O=function(e){C((function(t){var r=Object(u.a)({},t,{index:(t.index+e+t.choices.length)%t.choices.length});return N(r),r}))},D=Object(n.useState)((function(){return T(x)})),j=Object(s.a)(D,2),L=j[0],C=j[1];return i.a.createElement("div",{className:"Chooser"},i.a.createElement("input",{className:"Chooser-input",value:x,onChange:function(e){var t=e.target.value;if("["===t){var n={kind:p.UndefinedLiteral,sid:v()},i={kind:p.ArrayLiteral,aid:h(),sid:v(),elems:[n]};r({type:"UPDATE_EDITING_NODE",newNode:i}),r({type:"TOGGLE_EDIT"}),r({type:"SET_SELECTED_NODE",newNode:n}),r({type:"TOGGLE_EDIT"})}else k(t),C(T(t))},onKeyDown:function(e){switch(e.key){case"ArrowUp":e.preventDefault(),e.stopPropagation(),O(-1);break;case"ArrowDown":e.preventDefault(),e.stopPropagation(),O(1);break;case"=":if(e.preventDefault(),e.stopPropagation(),!f.current)throw new Error;if(l){var t=f.current.value,n={kind:p.Application,aid:h(),outs:[{sid:v(),name:{kind:p.Name,text:t}}],func:{kind:p.FunctionReference,ref:"bind"},sargs:[{kind:p.UndefinedLiteral,sid:v()}],fargs:[]};r({type:"UPDATE_EDITING_NODE",newNode:n}),r({type:"TOGGLE_EDIT"})}}},ref:f,autoFocus:!0}),i.a.createElement("ul",{className:"Chooser-dropdown"},L.choices.map((function(e,t){var r=[];return t===L.index&&(a?r.push("Chooser-dropdown-selected-error"):r.push("Chooser-dropdown-selected")),i.a.createElement("li",{key:t,className:r.join(" "),ref:t===L.index?g:void 0},i.a.createElement(We,{choice:e,treeViewCtx:c}),a&&t===L.index?i.a.createElement("div",{className:"Chooser-dropdown-compile-error"},a):null)}))))},Je=function(e){var t=e.initSelTree,r=e.dispatch,a=t.selectedNode;if(a.kind!==p.Name)throw new Error;var o=Object(n.useRef)(null);Object(n.useEffect)((function(){o.current&&o.current.select()}),[]);var c=Object(n.useState)((function(){return a.text})),d=Object(s.a)(c,2),l=d[0],f=d[1];return i.a.createElement("div",{className:"Chooser"},i.a.createElement("input",{className:"Chooser-input",value:l,onChange:function(e){var t=e.target.value;f(t);var n=Object(u.a)({},a,{text:t});r({type:"UPDATE_EDITING_NODE",newNode:n})},ref:o,autoFocus:!0}))},Xe=function(e){var t=e.initSelTree,r=e.nativeFunctions,n=e.dispatch,a=e.compileError,o=e.infixMode,u=e.treeViewCtx;if(t.selectedNode.kind===p.Name)return i.a.createElement(Je,{initSelTree:t,dispatch:n});if(w(t.selectedNode))return i.a.createElement(Ke,{initSelTree:t,nativeFunctions:r,dispatch:n,compileError:a,infixMode:o,treeViewCtx:u});throw new Error},Qe={TOGGLE_EDIT:"enter",ABORT_EDIT:"escape",INFIX_EDIT:"shift+enter",INSERT_BEFORE:"shift+up",INSERT_AFTER:"shift+down",DELETE_SUBTREE:"backspace",EDIT_NEXT_UNDEFINED:"tab",UNDO:"command+z",CUT:"command+x",PASTE:"command+v"},Ze=new Set(["=",","]),et=["Enter","Shift","Escape","Tab","=",","],tt=function(e){var t=e.autoFocus,r=Object(n.useReducer)(ge,xe),a=Object(s.a)(r,2),o=a[0],l=a[1],f=Object(n.useRef)(null),v=Object(n.useRef)(!0);Object(n.useEffect)((function(){v.current=!1}),[]);for(var m={},h=function(){var e=g[w];m[e]=function(t){t&&t.preventDefault(),l({type:e})}},w=0,g=Object.keys(Qe);w<g.length;w++)h();var y=o.editing?o.editing.initSelTree:o.stableSelTree,b=function(e,t){var r=ie(e,t),n=e.selectedNode;if(n.kind===p.StreamReference){var i=r.streamEnv.get(n.ref);if(!i)throw new Error;switch(i.kind){case"expr":case"param":return i.name;default:}}}(y,o.nativeFunctions),E={markedNodes:{selected:y.selectedNode,referentName:b},staticEnv:re(o.nativeFunctions),setSelectedNode:function(e){l({type:"SET_SELECTED_NODE",newNode:e})},focusSelected:!o.editing&&(t||!v.current)},x=Object(n.useRef)();return Object(n.useLayoutEffect)((function(){var e=o.editing?o.editing.sessionId:void 0;if(x.current!==e){var t=document.querySelector(".Editor-chooser-positioner"),r=document.querySelector(".TreeView-selected");if(t&&r){var n=r.getBoundingClientRect();t.style.left=n.left+"px",t.style.top=n.bottom+2+"px"}x.current=e}})),i.a.createElement("div",{className:"Editor"},i.a.createElement("div",{className:"Editor-storage-panel-container Editor-panel"},i.a.createElement(ke,{programInfo:o.programInfo,mainDefinition:o.stableSelTree.mainDefinition,onChangeName:function(e){l({type:"SET_PROGRAM_NAME",newName:e})},onLoadProgram:function(e,t){l({type:"LOAD_PROGRAM",newProgram:{info:e,mainDefinition:t}})}})),i.a.createElement(d.HotKeys,{keyMap:Qe,handlers:m},i.a.createElement(d.ObserveKeys,{only:et},i.a.createElement("div",{className:"Editor-workspace",onKeyDown:function(e){"input"===e.target.tagName.toLowerCase()||1!==Object(c.a)(e.key).length||e.altKey||e.ctrlKey||e.metaKey||Ze.has(e.key)||l({type:"BEGIN_EDIT"})},tabIndex:0,ref:f},i.a.createElement(Ve,{node:y.mainDefinition,ctx:E}),o.editing&&function(){var e=Object(u.a)({},E,{setSelectedNode:function(){},staticEnv:ie(o.editing.initSelTree,o.nativeFunctions),focusSelected:!1});return i.a.createElement("div",{className:"Editor-chooser-positioner",style:{position:"absolute"}},i.a.createElement(Xe,{key:o.editing.sessionId,initSelTree:o.editing.initSelTree,nativeFunctions:o.nativeFunctions,dispatch:l,compileError:o.editing.compileError,infixMode:o.editing.infixMode,treeViewCtx:e}))}()))))},rt=function(){return i.a.createElement("div",{className:"App"},i.a.createElement(tt,{autoFocus:!0}),i.a.createElement("div",{id:"output"}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(rt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}],[[21,1,2]]]);
//# sourceMappingURL=main.e3ebe777.chunk.js.map