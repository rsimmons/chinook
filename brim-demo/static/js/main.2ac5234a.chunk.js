(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=null,a=function(){function e(e,t,n){void 0===n&&(n=null),this.streamFunc=e,this.onRequestUpdate=t,this.afterTerminate=n,this.hookRecordChain={data:null,cleanup:null,next:null},this.recordCursor=null,this.openRecord=null,this.updateCount=0}return e.prototype.update=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n;r={executionContext:this,previousFrame:r},this.recordCursor=this.hookRecordChain;try{if(n=this.streamFunc.apply(null,arguments),this.recordCursor.next)throw new Error("Did not reach all hook records in update")}finally{var a=r;if(!a)throw new Error("Cannot pop update frame because current is null");if(a.executionContext!==this)throw new Error("Popped frame from update stack but context did not match");r=a.previousFrame}return this.updateCount++,n},e.prototype.terminate=function(){for(var e=this.hookRecordChain.next;e;e=e.next)e.cleanup&&e.cleanup();this.afterTerminate&&this.afterTerminate()},e.prototype._beginHook=function(){if(this.openRecord)throw new Error("This is already an open hook when beginning another");if(!this.recordCursor)throw new Error;if(0===this.updateCount){if(this.recordCursor.next)throw new Error("Expecting to create new hook record in chain, but already present");this.recordCursor.next={data:null,cleanup:null,next:null}}if(!this.recordCursor.next)throw new Error("Expecting to find hook record in chain, but not present");return this.openRecord=this.recordCursor.next,this.recordCursor.next},e.prototype._endHook=function(){if(!this.recordCursor)throw new Error;if(this.openRecord!==this.recordCursor.next)throw new Error("Hook close does not match open");this.openRecord=null,this.recordCursor=this.recordCursor.next},e.prototype._requestUpdate=function(){this.onRequestUpdate()},e.prototype._setStreamFunc=function(e){this.streamFunc=e},e}();t.ExecutionContext=a;var i=null;function o(e){i?i.callbacks.add(e):e()}function u(){if(!r)throw new Error("Cannot get currently updating execution context because update stack is empty. Was a hook called outside of an execution context update?");return r.executionContext}function c(e){var t=u(),n=t._beginHook();if(!n.data){var r=e instanceof Function?e():e;n.data={current:r}}return t._endHook(),n.data}function l(){var e=u(),t=e._beginHook();return t.data||(t.data={requestUpdate:function(){e._requestUpdate()}}),e._endHook(),t.data.requestUpdate}function s(e){var t,n=u(),r=n._beginHook();if(!r.data){var a=[],i={queue:a,lastStream:null,unsubscribe:null,onValue:function(e){a.push(e)}};r.data=i,r.cleanup=function(){i.unsubscribe&&i.unsubscribe()}}var o=r.data;if(e!==o.lastStream){if(o.queue.length)throw new Error("useEventReceiver stream changed, but value is in queue");if(o.lastStream){if(!o.unsubscribe)throw new Error("should not be possible");o.unsubscribe(),o.lastStream=null,o.unsubscribe=null}o.lastStream=e,e&&(o.unsubscribe=e.subscribe(o.onValue))}else if(o.queue.length){if(o.queue.length>1)throw new Error("useEventReceiver found more than one enqueued value");t={value:o.queue.pop()}}return n._endHook(),t}t.beginBatch=function(){if(i)throw new Error("cannot begin batch when one is already active");i={callbacks:new Set}},t.endBatch=function(){if(!i)throw new Error("cannot end batch when none is active");i.callbacks.forEach(function(e){e()}),i=null},t.enqueueBatchedUpdate=o,t.createNullaryVoidRootExecutionContext=function(e){var t=new a(e,function(){o(function(){t.update()})});return t},t.useVar=c,t.useRequestUpdate=l,t.useInitialize=function(e){var t=u(),n=t._beginHook();n.data||(n.cleanup=e()||null,n.data={}),t._endHook()},t.useEventEmitter=function(){var e=u(),t=e._beginHook();if(!t.data){var n=new Set,r={subscribe:function(e){return n.add(e),function(){n.delete(e)}}};t.data={stream:r,emit:function(e){n.forEach(function(t){t(e)})}}}return e._endHook(),[t.data.stream,t.data.emit]},t.useEventReceiver=s,t.useDynamic=function(e,t){var n=u(),r=n._beginHook();if(!r.data){var i=t||function(){n._requestUpdate()},o={activeContexts:new Set,createContext:function(){var e=new a(o.streamFunc,i,function(){o.activeContexts.delete(e)});return o.activeContexts.add(e),e},streamFunc:function(){throw new Error("should be unreachable")}};r.data=o,r.cleanup=function(){o.activeContexts.forEach(function(e){return e.terminate()})}}return r.data.streamFunc=e,r.data.activeContexts.forEach(function(t){t._setStreamFunc(e)}),n._endHook(),r.data.createContext},t.useReducer=function(e,t,n){var r=c(n),a=s(e);return a&&(r.current=t(r.current,a.value)),r.current},t.useReducers=function(e,t){var n=c(t),r=c(e.length);if(e.length!==r.current)throw new Error("The number of streams/reducers supplied to useMultiReducer cannot change");for(var a=0,i=0,o=e;i<o.length;i++){var u=o[i],l=u[0],f=u[1],d=s(l);if(d){if(a>0)throw new Error("useMultiReducer got multiple events, cannot merge");n.current=f(n.current,d.value),a++}}return n.current},t.useCallbackReducer=function(e,t){var n=l(),r=c(t),a=c(function(){return function(t){r.current=e(r.current,t),n()}});return[r.current,a.current]},t.useCallbackReducers=function(e,t){var n=l(),r=c(t),a=e.map(function(e){return function(t){r.current=e(r.current,t),n()}});return[r.current,a]},t.useMachine=function(e,t){var n,r=u(),i=r._beginHook(),o=function(t){i.data.activeContext&&i.data.activeContext.terminate();var n=t[0],o=t[1],u=new a(e[n],function(){r._requestUpdate()});i.data.activeState=n,i.data.activeContext=u,i.data.activeArgument=o};if(!i.data){var c={activeContext:null};i.data=c,o(t),i.cleanup=function(){if(!c.activeContext)throw new Error("should have been initialized");c.activeContext.terminate()}}for(;;){i.data.activeContext._setStreamFunc(e[i.data.activeState]);var l=i.data.activeContext.update(i.data.activeArgument),s=l[0],f=l[1];if(n=s,!f)break;o(f)}return r._endHook(),n}},,,,,,,,,,,,function(e,t,n){e.exports=n(40)},,,,,,function(e,t,n){},function(e,t,n){},,,,function(e,t,n){"use strict";n.r(t),n.d(t,"showString",function(){return h}),n.d(t,"animationFrameEvts",function(){return y}),n.d(t,"animationTime",function(){return g}),n.d(t,"countEvents",function(){return b}),n.d(t,"mouseClickEvts",function(){return x}),n.d(t,"mouseDown",function(){return O}),n.d(t,"mousePosition",function(){return I}),n.d(t,"random",function(){return S}),n.d(t,"audioDriver",function(){return j}),n.d(t,"sampleUpon",function(){return N}),n.d(t,"everySecond",function(){return T}),n.d(t,"loadAudioAsArray",function(){return k}),n.d(t,"integral",function(){return A}),n.d(t,"expFollow",function(){return C}),n.d(t,"redCircle",function(){return _}),n.d(t,"followAtSpeed2d",function(){return D}),n.d(t,"eventAfter",function(){return R}),n.d(t,"received",function(){return U}),n.d(t,"streamMap",function(){return P}),n.d(t,"changeCount",function(){return L});n(5);var r=n(1),a=n(4),i=a.useVar,o=a.useRequestUpdate,u=a.useInitialize,c=a.useEventEmitter,l=a.useEventReceiver,s=a.useDynamic,f=a.useReducer,d=a.useReducers,m=n(28),p=m.renderDOMAppendedToBody,v=m.h;function h(e){var t=v("div",{style:{border:"1px solid red",color:"black",fontSize:"24px",padding:"5px",marginTop:"20px"}},"showString: "+(void 0===e?"(undefined)":e.toString()));p(t)}function y(){var e=o(),t=i(),n=c(),a=Object(r.a)(n,2),l=a[0],s=a[1];return u(function(){return t.current=requestAnimationFrame(function n(r){s(.001*r),e(),t.current=requestAnimationFrame(n)}),function(){cancelAnimationFrame(t.current)}}),l}function E(e,t){return f(e,function(e,t){return t},t)}function g(){return E(y(),function(){return.001*performance.now()})}function b(e){return f(e,function(e){return e+1},0)}function w(e,t,n){var a=o(),i=c(),l=Object(r.a)(i,2),s=l[0],f=l[1];return u(function(){var e=function(e){f(e),a()};return document.addEventListener(t,e,n),function(){document.removeEventListener(t,e,n)}}),s}function x(){return w(document,"mousedown")}function O(){var e=w(document,"mousedown"),t=w(document,"mouseup");return d([[t,function(){return!1}],[e,function(){return!0}]],!1)}function I(){return E(function(e){var t=l(e),n=c(),a=Object(r.a)(n,2),i=a[0],o=a[1];return t&&o(t.value),i}(w(document,"mousemove")),{x:0,y:0})}function S(e){return f(e,function(){return Math.random()},function(){return Math.random()})}function j(e){var t=s(e),n=i(),a=i(0),o=i(),l=c(),f=Object(r.a)(l,2),d=f[0],m=f[1];u(function(){n.current=t();var e=new(window.AudioContext||window.webkitAudioContext),r=e.createScriptProcessor(1024,0,1);return r.onaudioprocess=function(e){for(var t=e.outputBuffer.getChannelData(0),r=0;r<t.length;r++){m();var i=n.current.update(a.current/o.current,d,o.current);!i||Number.isNaN(i)?i=0:i>1?i=1:i<-1&&(i=-1),t[r]=i,a.current++}},r.connect(e.destination),o.current=e.sampleRate,function(){r.disconnect(),e.close()}}),n.current.update(a.current/o.current,d,o.current)}function N(e,t,n){return f(t,function(){return e},n)}function T(){var e=o(),t=c(),n=Object(r.a)(t,2),a=n[0],i=n[1];return u(function(){var t=setInterval(function(){i(),e()},1e3);return function(){clearInterval(t)}}),a}function k(e){var t=o(),n=i([0]);return u(function(){var r=new(window.AudioContext||window.webkitAudioContext),a=!1,i=new XMLHttpRequest;return i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){var e=i.response;r.decodeAudioData(e,function(e){a||(n.current=e.getChannelData(0),t())})},i.send(),function(){i.abort(),a=!0}}),n.current}function A(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=i(n),a=i(t),o=e(r.current,a.current);return r.current+=(t-a.current)*o,a.current=t,r.current}function C(e,t,n,r){return A(function(n){return t*(e-n)},n,r)}function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,n=e||{x:0,y:0};t<0&&(t=0);var r=.5*t,a=v("div",{style:{position:"absolute",borderRadius:"50%",background:"red",pointerEvents:"none",userSelect:"none",left:n.x-r+"px",top:n.y-r+"px",width:t+"px",height:t+"px"}});p(a)}function D(e,t,n,r){var a=i(r),o=i(n),u=n-o.current,c=e.x-a.current.x,l=e.y-a.current.y,s=Math.sqrt(c*c+l*l);return a.current=t*u>=s?e:{x:a.current.x+u*t*c/s,y:a.current.y+u*t*l/s},o.current=n,a.current}function R(e,t){var n=c(),a=Object(r.a)(n,2),o=a[0],l=a[1],s=i(t);return s.current=t,u(function(){var t=setTimeout(function(){l(s.current)},1e3*e);return function(){clearTimeout(t)}}),o}function U(e){return f(e,function(e,t){return!0},!1)}function P(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=s(e),r=i([]);t.length>r.current.length;)r.current.push(n());for(;t.length<r.current.length;){r.current.pop().terminate()}return r.current.map(function(e,n){return e.update(t[n])})}function L(e){var t,n,r=i(0),a=i(e);return t=e,n=a.current,Number.isNaN(t)&&Number.isNaN(n)||t===n||r.current++,a.current=e,r.current}},function(e,t,n){"use strict";n.r(t),n.d(t,"h",function(){return i}),n.d(t,"renderDOMIntoElement",function(){return u}),n.d(t,"renderDOMIntoSelector",function(){return c}),n.d(t,"renderDOMAppendedToBody",function(){return l});var r=n(4),a=n(41).init([n(29).default,n(30).default,n(31).default,n(32).default]),i=n(33).default;function o(e){return{sel:e.sel,data:e.data,children:e.children&&e.children.map(o),text:e.text,key:e.key,elm:e.elm}}function u(e,t){var n=Object(r.useVar)(t),i=Object(r.useVar)(),u=o(e);if(Object(r.useInitialize)(function(){return function(){n.current.innerHTML=""}}),i.current)a(i.current,u);else{var c=document.createElement("div");n.current.appendChild(c),a(c,u)}i.current=u}function c(e,t){u(e,Object(r.useVar)(function(){return document.querySelector(t)}).current)}function l(e){var t=Object(r.useVar)();Object(r.useInitialize)(function(){var e=document.createElement("div");return document.body.appendChild(e),t.current=e,function(){document.body.removeChild(e)}}),u(e,t.current)}},,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(11),o=n.n(i),u=(n(22),n(23),n(5)),c=n(1),l=n(9),s=n(3);function f(e){return"Program"===e.type}function d(e){return"Identifier"===e.type}function m(e){return"ArrayLiteral"===e.type}function p(e){return"Application"===e.type}function v(e){return function(e){return"UndefinedExpression"===e.type}(e)||function(e){return"IntegerLiteral"===e.type}(e)||m(e)||function(e){return"StreamReference"===e.type}(e)||p(e)||function(e){return"Parameter"===e.type}(e)}function h(e){return"UserFunction"===e.type}function y(e){return f(e)||d(e)||v(e)||function(e){return function(e){return"NativeFunction"===e.type}(e)||h(e)}(e)}var E=function(){return Math.random().toString(16).substring(2,10)},g=function(){return E()+E()},b=n(7),w=n(14),x=n(8),O=n(12),I=n(15),S=function(e){function t(){return Object(b.a)(this,t),Object(w.a)(this,Object(x.a)(t).apply(this,arguments))}return Object(O.a)(t,e),t}(Object(I.a)(Error));function j(e,t,n,r,a){if(!r.has(e.streamId)){if(n.has(e.streamId))throw new S("graph cycle");switch(e.type){case"Parameter":break;case"UndefinedExpression":a.literalStreamValues.push([e.streamId,void 0]);break;case"IntegerLiteral":a.literalStreamValues.push([e.streamId,e.value]);break;case"ArrayLiteral":n.add(e.streamId);var i=!0,o=!1,u=void 0;try{for(var c,l=e.items[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){j(c.value,t,n,r,a)}}catch(O){o=!0,u=O}finally{try{i||null==l.return||l.return()}finally{if(o)throw u}}n.delete(e.streamId),a.applications.push([e.streamId,"Array_of",e.items.map(function(e){return e.streamId}),[]]);break;case"StreamReference":var s=t.derivedLookups.streamIdToNode.get(e.targetStreamId);if(!s)throw Error();n.add(e.streamId),j(s,t,n,r,a),n.delete(e.streamId),a.applications.push([e.streamId,"id",[e.targetStreamId],[]]);break;case"Application":var f=t.derivedLookups.functionIdToNode.get(e.functionId);if(!f)throw Error();n.add(e.streamId);var d=!0,m=!1,p=void 0;try{for(var v,h=e.arguments[Symbol.iterator]();!(d=(v=h.next()).done);d=!0){j(v.value,t,n,r,a)}}catch(O){m=!0,p=O}finally{try{d||null==h.return||h.return()}finally{if(m)throw p}}n.delete(e.streamId);var y=!0,E=!1,g=void 0;try{for(var b,w=e.functionArguments[Symbol.iterator]();!(y=(b=w.next()).done);y=!0){var x=b.value;a.containedDefinitions.push([x.functionId,N(x,t)])}}catch(O){E=!0,g=O}finally{try{y||null==w.return||w.return()}finally{if(E)throw g}}a.applications.push([e.streamId,f.functionId,e.arguments.map(function(e){return e.streamId}),e.functionArguments.map(function(e){return e.functionId})]);break;default:throw new Error}r.add(e.streamId)}}function N(e,t){var n=new Set,r=new Set,a={parameterStreams:e.parameters.map(function(e){return e.streamId}),literalStreamValues:[],applications:[],containedDefinitions:[],yieldStream:null},i=!0,o=!1,u=void 0;try{for(var c,l=e.expressions[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var s=c.value;j(s,t,n,r,a),a.yieldStream=s.streamId}}catch(f){o=!0,u=f}finally{try{i||null==l.return||l.return()}finally{if(o)throw u}}return a}var T=n(4),k=n(13);var A=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;Object(b.a)(this,e),this.obj=void 0,this.obj=Object.create(t?t.obj:null)}return Object(k.a)(e,[{key:"get",value:function(e){return this.obj[e]}},{key:"set",value:function(e,t){this.obj[e]=t}},{key:"delete",value:function(e){delete this.obj[e]}}]),e}();var C=n(27),_=C.showString,D=C.animationTime,R=C.mouseDown,U=C.changeCount,P=C.streamMap,L=C.audioDriver,M=C.random,F=C.mouseClickEvts,V={Program:{fields:{mainDefinition:{type:"node"}}},Identifier:{fields:{name:{type:"value"}}},UndefinedExpression:{fields:{streamId:{type:"uid"},identifier:{type:"node"}}},IntegerLiteral:{fields:{streamId:{type:"uid"},identifier:{type:"node"},value:{type:"value"}}},ArrayLiteral:{fields:{streamId:{type:"uid"},identifier:{type:"node"},items:{type:"nodes"}}},StreamReference:{fields:{streamId:{type:"uid"},identifier:{type:"node"},targetStreamId:{type:"uid"}}},Application:{fields:{streamId:{type:"uid"},identifier:{type:"node"},functionId:{type:"uid"},arguments:{type:"nodes"},functionArguments:{type:"nodes"}}},Parameter:{fields:{streamId:{type:"uid"},identifier:{type:"node"}}},NativeFunction:{fields:{functionId:{type:"uid"},identifier:{type:"node"},signature:{type:"value"},jsFunction:{type:"value"}}},UserFunction:{fields:{functionId:{type:"uid"},identifier:{type:"node"},signature:{type:"value"},parameters:{type:"nodes"},functionParameterFunctionIds:{type:"value"},expressions:{type:"nodes"}}}},q={Expression:["UndefinedExpression","IntegerLiteral","ArrayLiteral","StreamReference","Application","Parameter"],Any:["Program","Identifier","UndefinedExpression","IntegerLiteral","ArrayLiteral","StreamReference","Application","NativeFunction","UserFunction"]};function H(e,t){var n=e,r=!0,a=!1,i=void 0;try{for(var o,u=t[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){n=n[o.value]}}catch(c){a=!0,i=c}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}return n}function G(e,t,n){var r=t,a=0,i=!0,o=!1,u=void 0;try{for(var c,l=n[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var s=c.value;if(e===r)return[n.slice(0,a),n.slice(a)];r=r[s],a++}}catch(f){o=!0,u=f}finally{try{i||null==l.return||l.return()}finally{if(o)throw u}}if(e===r)return[n.slice(0,a),n.slice(a)];throw new Error("node was not in path")}function B(e,t,n){switch(e.identifier&&t.push([e.identifier.name,e]),e.type){case"Application":var r=!0,a=!1,i=void 0;try{for(var o,u=e.arguments[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){B(o.value,t,n)}}catch(g){a=!0,i=g}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}var c=!0,l=!1,s=void 0;try{for(var f,d=e.functionArguments[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var m=f.value;m.identifier&&n.push([m.identifier.name,m])}}catch(g){l=!0,s=g}finally{try{c||null==d.return||d.return()}finally{if(l)throw s}}break;case"ArrayLiteral":var p=!0,v=!1,h=void 0;try{for(var y,E=e.items[Symbol.iterator]();!(p=(y=E.next()).done);p=!0){B(y.value,t,n)}}catch(g){v=!0,h=g}finally{try{p||null==E.return||E.return()}finally{if(v)throw h}}break;case"StreamReference":case"IntegerLiteral":case"UndefinedExpression":break;default:throw new Error}}function W(e,t,n){var r=!0,a=!1,i=void 0;try{for(var o,u=e.parameters[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var c=o.value;c.identifier&&t.push([c.identifier.name,c])}}catch(p){a=!0,i=p}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}var l=!0,s=!1,f=void 0;try{for(var d,m=e.expressions[Symbol.iterator]();!(l=(d=m.next()).done);l=!0){B(d.value,t,n)}}catch(p){s=!0,f=p}finally{try{l||null==m.return||m.return()}finally{if(s)throw f}}}function K(e){var t=[],n=[],r=!0,a=!1,i=void 0;try{for(var o,u=e.nativeFunctions[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var c=o.value;c.identifier&&n.push([c.identifier.name,c])}}catch(l){a=!0,i=l}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}return function(e,t,n,r){var a=e,i=!0,o=!1,u=void 0;try{for(var c,s=t[Symbol.iterator]();!(i=(c=s.next()).done);i=!0){var f=c.value;"UserFunction"===a.type&&W(a,n,r),a=a[f]}}catch(l){o=!0,u=l}finally{try{i||null==s.return||s.return()}finally{if(o)throw u}}}(e.program,e.selectionPath,t,n),{namedStreams:t,namedFunctions:n}}var z=function(e,t){return JSON.stringify(e)===JSON.stringify(t)};function Z(e,t){var n=e.node,r=e.subpath,a=e.editingSelected;if(!a)throw new Error;if(!d(n)){if(0!==r.length){if(!v(n)||!z(r,["identifier"]))throw new Error;if(!n.identifier)throw new Error;var i,o=(i=t?n.identifier.name.trim():a.originalNode.name)?{type:"Identifier",name:i}:null;return[Object(s.a)({},n,{identifier:o}),[],null]}var u=t?a.tentativeNode:a.originalNode,l=r,f=null;if(t){var m=J(u);if(m){var p=Object(c.a)(m,2),h=p[0];l=p[1],f={originalNode:h,tentativeNode:h}}}return[u,l,f]}}function J(e){return function e(t,n,r,a){switch(r&&z(n,r)&&(a[0]=!0),t.type){case"Program":return e(t.mainDefinition,n.concat(["mainDefinition"]),r,a);case"UserFunction":var i=0,o=!0,u=!1,c=void 0;try{for(var l,s=t.expressions[Symbol.iterator]();!(o=(l=s.next()).done);o=!0){var f=e(l.value,n.concat(["expressions",i]),r,a);if(f)return f;i++}}catch(_){u=!0,c=_}finally{try{o||null==s.return||s.return()}finally{if(u)throw c}}break;case"Application":var d=0,m=!0,p=!1,v=void 0;try{for(var h,y=t.arguments[Symbol.iterator]();!(m=(h=y.next()).done);m=!0){var E=e(h.value,n.concat(["arguments",d]),r,a);if(E)return E;d++}}catch(_){p=!0,v=_}finally{try{m||null==y.return||y.return()}finally{if(p)throw v}}d=0;var g=!0,b=!1,w=void 0;try{for(var x,O=t.functionArguments[Symbol.iterator]();!(g=(x=O.next()).done);g=!0){var I=e(x.value,n.concat(["functionArguments",d]),r,a);if(I)return I;d++}}catch(_){b=!0,w=_}finally{try{g||null==O.return||O.return()}finally{if(b)throw w}}break;case"ArrayLiteral":var S=0,j=!0,N=!1,T=void 0;try{for(var k,A=t.items[Symbol.iterator]();!(j=(k=A.next()).done);j=!0){var C=e(k.value,n.concat(["items",S]),r,a);if(C)return C;S++}}catch(_){N=!0,T=_}finally{try{j||null==A.return||A.return()}finally{if(N)throw T}}break;case"Identifier":case"IntegerLiteral":case"StreamReference":break;case"UndefinedExpression":if(!r||a[0])return[t,n];break;default:throw new Error}}(e,[],arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,[!1])}var X=[["UserFunction",["MOVE_UP","MOVE_DOWN"],function(e){var t=e.node,n=e.subpath,r=e.action;if(!h(t))throw new Error;if(2===n.length&&"expressions"===n[0])return[t,["expressions",function(){var e=n[1];if("number"!==typeof e)throw new Error;var a=e+("MOVE_UP"===r.type?-1:1);return a=Math.max(a,0),a=Math.min(a,t.expressions.length-1)}()],null]}],["UserFunction",["DELETE"],function(e){var t=e.node,n=e.subpath;if(!h(t))throw new Error;if(2===n.length&&"expressions"===n[0]){var r=n[1];if("number"!==typeof r)throw new Error;return function(e,t){if("number"!==typeof t)throw new Error;var n=Object(s.a)({},e,{expressions:[].concat(Object(u.a)(e.expressions.slice(0,t)),Object(u.a)(e.expressions.slice(t+1)))});if(n.expressions.length){var r=t-1;return r=Math.max(r,0),[n,["expressions",r=Math.min(r,e.expressions.length-1)],null]}var a={type:"UndefinedExpression",streamId:g(),identifier:null};return n.expressions.push(a),[n,["expressions",0],{originalNode:a,tentativeNode:a}]}(t,r)}}],["UserFunction",["ZOOM_IN","MOVE_RIGHT"],function(e){var t=e.node,n=e.subpath;if(!h(t))throw new Error;if(0===n.length)return[t,["expressions",0],null]}],["Any",["TOGGLE_EDIT"],function(e){var t=e.node,n=e.subpath;if(e.editingSelected)return Z(e,!0);if(0!==n.length)throw new Error;switch(t.type){case"IntegerLiteral":case"UndefinedExpression":case"StreamReference":case"Application":return[t,n,{originalNode:t,tentativeNode:t}];case"ArrayLiteral":break;default:throw new Error}}],["Any",["ABORT_EDIT"],function(e){if(e.editingSelected)return Z(e,!1)}],["Any",["CONFIRM_EDIT"],function(e){if(e.editingSelected)return Z(e,!0)}],["Expression",["BEGIN_IDENTIFIER_EDIT"],function(e){var t=e.node,n=e.subpath;if(!v(t))throw new Error;if(z(n,[])){var r=t.identifier||{type:"Identifier",name:""};return[Object(s.a)({},t,{identifier:r}),["identifier"],{originalNode:r,tentativeNode:r}]}}],["Expression",["BEGIN_OVERWRITE_EDIT"],function(e){var t=e.node,n=e.subpath;if(console.log("BEGIN_OVERWRITE_EDIT"),!v(t))throw new Error;return[t,n,{originalNode:t,tentativeNode:{type:"UndefinedExpression",streamId:t.streamId,identifier:t.identifier}}]}],["Any",["UPDATE_EDITING_TENTATIVE_NODE"],function(e){var t=e.node,n=e.subpath,r=e.action,a=e.editingSelected;if(!r.newNode)throw new Error;if(!a)throw new Error;if(0===n.length){var i;if(d(t))i=r.newNode;else{if(!v(t))throw new Error;i=t}return[i,n,Object(s.a)({},a,{tentativeNode:r.newNode})]}}],["UserFunction",["EDIT_AFTER"],function(e){var t=e.node,n=e.subpath;if(!h(t))throw new Error;if(n.length>=2&&"expressions"===n[0]){var r=n[1];if("number"!==typeof r)throw new Error;var a={type:"UndefinedExpression",streamId:g(),identifier:null};return[Object(s.a)({},t,{expressions:[].concat(Object(u.a)(t.expressions.slice(0,r+1)),[a],Object(u.a)(t.expressions.slice(r+1)))}),["expressions",r+1],{originalNode:a,tentativeNode:a}]}}],["ArrayLiteral",["ZOOM_OUT","MOVE_LEFT"],function(e){var t=e.node,n=e.subpath;if(2===n.length){if("items"!==n[0]||"number"!==typeof n[1])throw Error();return[t,[],null]}}],["ArrayLiteral",["ZOOM_IN","MOVE_RIGHT"],function(e){var t=e.node,n=e.subpath;if(!m(t))throw new Error;if(0===n.length){if(0===t.items.length){var r={type:"UndefinedExpression",streamId:g(),identifier:null};return[Object(s.a)({},t,{items:[r]}),["items",0],{originalNode:r,tentativeNode:r}]}return[t,["items",0],null]}}],["ArrayLiteral",["MOVE_UP","MOVE_DOWN"],function(e){var t=e.node,n=e.subpath,r=e.action;if(!m(t))throw new Error;if(2===n.length&&"items"===n[0]){var a=n[1];if("number"!==typeof a)throw new Error;var i=a+("MOVE_UP"===r.type?-1:1);return i<0||i>=t.items.length?[t,[],null]:[t,["items",i],null]}}],["ArrayLiteral",["EDIT_AFTER"],function(e){var t=e.node,n=e.subpath;if(!m(t))throw new Error;if(2===n.length&&"items"===n[0]){var r=n[1];if("number"!==typeof r)throw new Error;var a={type:"UndefinedExpression",streamId:g(),identifier:null};return[Object(s.a)({},t,{items:[].concat(Object(u.a)(t.items.slice(0,r+1)),[a],Object(u.a)(t.items.slice(r+1)))}),["items",r+1],{originalNode:a,tentativeNode:a}]}}],["ArrayLiteral",["DELETE"],function(e){var t=e.node,n=e.subpath;if(!m(t))throw new Error;if(2===n.length){if(0===t.items.length)throw new Error;var r=n[1];if("number"!==typeof r)throw new Error;var a=Object(s.a)({},t,{items:[].concat(Object(u.a)(t.items.slice(0,r)),Object(u.a)(t.items.slice(r+1)))});if(a.items.length>0){var i=r-1;return i=Math.max(i,0),[a,["items",i=Math.min(i,t.items.length-1)],null]}return[a,[],null]}}],["Expression",["CREATE_ARRAY"],function(e){var t=e.node,n=e.subpath;if(!v(t))throw new Error;if(0===n.length){var r={type:"UndefinedExpression",streamId:g(),identifier:null};return[{type:"ArrayLiteral",streamId:t.streamId,identifier:t.identifier,items:[r]},["items",0],{originalNode:r,tentativeNode:r}]}}],["Application",["ZOOM_OUT","MOVE_LEFT"],function(e){var t=e.node,n=e.subpath;if(!p(t))throw new Error;if(2===n.length){if("arguments"===n[0]&&"number"===typeof n[1])return[t,[],null];if("functionArguments"===n[0]&&"number"===typeof n[1])return[t,[],null];throw new Error}if(n.length>=3&&"functionArguments"===n[0]&&"number"===typeof n[1])return[t,n.slice(0,2),null]}],["Application",["ZOOM_IN","MOVE_RIGHT"],function(e){var t=e.node,n=e.subpath;if(!p(t))throw new Error;if(0===n.length){if(t.arguments.length>0)return[t,["arguments",0],null];if(t.functionArguments.length>0)return[t,["functionArguments",0],null]}}],["Application",["MOVE_UP","MOVE_DOWN"],function(e){var t=e.node,n=e.subpath,r=e.action;if(!p(t))throw new Error;if(2===n.length&&"arguments"===n[0]){var a=n[1];if("number"!==typeof a)throw new Error;var i=a+("MOVE_UP"===r.type?-1:1);return i>=t.arguments.length&&t.functionArguments.length?[t,["functionArguments",0],null]:i<0||i>=t.arguments.length?[t,[],null]:[t,["arguments",i],null]}if(2===n.length&&"functionArguments"===n[0]){var o=n[1];if("number"!==typeof o)throw new Error;var u=o+("MOVE_UP"===r.type?-1:1);return u<0&&t.arguments.length?[t,["arguments",t.arguments.length-1],null]:u<0||u>=t.arguments.length?[t,[],null]:[t,["functionArguments",u],null]}}],["Application",["DELETE"],function(e){var t=e.node,n=e.subpath;e.action;if(!p(t))throw new Error;if(2===n.length&&"arguments"===n[0]){var r=n[1];if("number"!==typeof r)throw new Error;var a=t.arguments.slice();return a[r]={type:"UndefinedExpression",streamId:t.arguments[r].streamId,identifier:t.arguments[r].identifier},[Object(s.a)({},t,{arguments:a}),["arguments",r],null]}}]];function Y(e,t,n){if(!function(e,t,n){if(e===t)return!0;var r=t,a=!0,i=!1,o=void 0;try{for(var u,c=n[Symbol.iterator]();!(a=(u=c.next()).done);a=!0)if(e===(r=r[u.value]))return!0}catch(l){i=!0,o=l}finally{try{a||null==c.return||c.return()}finally{if(i)throw o}}return!1}(t,e.program,e.selectionPath))return null;var r=V[t.type];if(!r)throw new Error;for(var a={type:t.type},i=null,o=null,u=!1,l=t,s=0,f=Object.entries(r.fields);s<f.length;s++){var d=f[s],m=Object(c.a)(d,2),p=m[0];switch(m[1].type){case"node":var v=l[p],h=Y(e,v,n);if(h){if(u)throw new Error("already handled");var E=Object(c.a)(h,3),g=E[0],b=E[1],w=E[2];a[p]=g,i=b,o=w,u=!0}else a[p]=v;break;case"nodes":var x=[],O=l[p],I=!0,S=!1,j=void 0;try{for(var N,T=O[Symbol.iterator]();!(I=(N=T.next()).done);I=!0){var k=N.value,A=Y(e,k,n);if(A){if(u)throw new Error("already handled");var C=Object(c.a)(A,3),_=C[0],D=C[1],R=C[2];x.push(_),i=D,o=R,u=!0}else x.push(k)}}catch(te){S=!0,j=te}finally{try{I||null==T.return||T.return()}finally{if(S)throw j}}a[p]=x;break;case"value":case"uid":a[p]=l[p];break;default:throw new Error}}if(u){if(!y(a))throw new Error;if(!i)throw new Error;return[a,i,o]}for(var U=0,P=X;U<P.length;U++){var L=P[U],M=Object(c.a)(L,3),F=M[0],H=M[1],B=M[2];if((q[F]?q[F]:[F]).includes(t.type)&&H.includes(n.type)){var W=G(t,e.program,e.selectionPath),K=Object(c.a)(W,2),z=K[0],Z=B({node:t,subpath:K[1],editingSelected:e.editingSelected,action:n});if(Z){var J=Object(c.a)(Z,3),$=J[0],Q=J[1],ee=J[2];return[$,z.concat(Q),ee]}}}return null}function $(e){var t=new Map,n=new Map,r=new Map,a=!0,i=!1,o=void 0;try{for(var u,c=e.nativeFunctions[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var l=u.value;n.set(l.functionId,l)}}catch(f){i=!0,o=f}finally{try{a||null==c.return||c.return()}finally{if(i)throw o}}return function e(t,n,r){if(v(t)){if(n.has(t.streamId))throw new Error("stream ids must be unique");n.set(t.streamId,t)}switch(t.type){case"Program":e(t.mainDefinition,n,r);break;case"UserFunction":if(r.has(t.functionId))throw new Error("function ids must be unique");r.set(t.functionId,t);var a=!0,i=!1,o=void 0;try{for(var u,c=t.parameters[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var l=u.value;if(n.has(l.streamId))throw new Error("stream ids must be unique");n.set(l.streamId,l)}}catch(f){i=!0,o=f}finally{try{a||null==c.return||c.return()}finally{if(i)throw o}}t.expressions.forEach(function(t,a){e(t,n,r)});break;case"Application":t.arguments.forEach(function(t,a){e(t,n,r)}),t.functionArguments.forEach(function(t,a){e(t,n,r)});break;case"ArrayLiteral":t.items.forEach(function(t,a){e(t,n,r)});break;case"IntegerLiteral":case"UndefinedExpression":case"StreamReference":break;default:throw new Error}}(e.program,t,n),Object(s.a)({},e,{derivedLookups:{streamIdToNode:t,functionIdToNode:n,nodeToPath:r}})}function Q(e){var t=new Map;return function e(t,n,r){switch(r.set(t,n),v(t)&&t.identifier&&e(t.identifier,n.concat(["identifier"]),r),t.type){case"Program":e(t.mainDefinition,n.concat(["mainDefinition"]),r);break;case"UserFunction":t.expressions.forEach(function(t,a){e(t,n.concat(["expressions",a]),r)});break;case"Application":t.arguments.forEach(function(t,a){e(t,n.concat(["arguments",a]),r)}),t.functionArguments.forEach(function(t,a){e(t,n.concat(["functionArguments",a]),r)});break;case"ArrayLiteral":t.items.forEach(function(t,a){e(t,n.concat(["items",a]),r)});break;case"Identifier":case"IntegerLiteral":case"UndefinedExpression":case"StreamReference":break;default:throw new Error}}(e.program,[],t),Object(s.a)({},e,{derivedLookups:Object(s.a)({},e.derivedLookups,{nodeToPath:t})})}function ee(e,t){switch(e.type){case"Program":return Object(s.a)({},e,{mainDefinition:ee(e.mainDefinition,t)});case"UserFunction":return Object(s.a)({},e,{expressions:e.expressions.map(function(e){return ee(e,t)})});case"Application":return Object(s.a)({},e,{arguments:e.arguments.map(function(e){return ee(e,t)}),functionArguments:e.functionArguments.map(function(e){return ee(e,t)})});case"ArrayLiteral":return Object(s.a)({},e,{items:e.items.map(function(e){return ee(e,t)})});case"IntegerLiteral":case"UndefinedExpression":return e;case"StreamReference":return t.has(e.targetStreamId)?e:{type:"UndefinedExpression",streamId:g(),identifier:e.identifier};default:throw new Error}}function te(e,t){var n,r={parameterStreams:[],literalStreamValues:[],applications:[],containedDefinitions:[],yieldStream:null};try{r=N(t.program.mainDefinition,t)}catch(v){if(!(v instanceof S))throw v;console.log("COMPILATION ERROR",v.message)}if(e){var a=e.liveMain,i=a.context,o=a.updateCompiledDefinition;console.log("updating compiled definition to",r),Object(T.beginBatch)(),o(r),Object(T.endBatch)(),n={context:i,updateCompiledDefinition:o,compiledDefinition:r}}else{console.log("initializing compiled definition to",r);var l=function e(t,n,r){var a=new Set,i=t;return[function(){var t=Object(T.useRequestUpdate)(),o=Object(T.useVar)(function(){var a=new A(n),o=new A(r),u=!0,l=!1,s=void 0;try{for(var f,d=i.literalStreamValues[Symbol.iterator]();!(u=(f=d.next()).done);u=!0){var m=f.value,p=Object(c.a)(m,2),v=p[0],h=p[1];a.set(v,h)}}catch(G){l=!0,s=G}finally{try{u||null==d.return||d.return()}finally{if(l)throw s}}var y=new Map,E=!0,g=!1,b=void 0;try{for(var w,x=i.applications[Symbol.iterator]();!(E=(w=x.next()).done);E=!0){var O=w.value,I=Object(c.a)(O,2),S=I[0],j=I[1],N=o.get(j);if(!N)throw Error();y.set(S,new T.ExecutionContext(N,t))}}catch(G){g=!0,b=G}finally{try{E||null==x.return||x.return()}finally{if(g)throw b}}var k=new Map,C=!0,_=!1,D=void 0;try{for(var R,U=i.containedDefinitions[Symbol.iterator]();!(C=(R=U.next()).done);C=!0){var P=R.value,L=Object(c.a)(P,2),M=L[0],F=e(L[1],a,o),V=Object(c.a)(F,2),q=V[0],H=V[1];o.set(M,q),k.set(M,H)}}catch(G){_=!0,D=G}finally{try{C||null==U.return||U.return()}finally{if(_)throw D}}return{streamEnvironment:a,functionEnvironment:o,applicationContext:y,updateContainedDefinition:k,requestUpdate:t}});Object(T.useInitialize)(function(){return a.add(o.current),function(){o.current.applicationContext.forEach(function(e){e.terminate()}),a.delete(o.current)}});var l=o.current,s=l.streamEnvironment,f=l.functionEnvironment,d=l.applicationContext;if(arguments.length!==i.parameterStreams.length)throw new Error("wrong number of arguments to live function, got "+arguments.length+" expected "+i.parameterStreams.length);var m=0,p=!0,h=!1,y=void 0;try{for(var E,g=i.parameterStreams[Symbol.iterator]();!(p=(E=g.next()).done);p=!0){var b=E.value;s.set(b,arguments[m]),m++}}catch(P){h=!0,y=P}finally{try{p||null==g.return||g.return()}finally{if(h)throw y}}var w=!0,x=!1,O=void 0;try{for(var I,S=i.applications[Symbol.iterator]();!(w=(I=S.next()).done);w=!0){var j=I.value,N=Object(c.a)(j,4),k=N[0],C=N[2],_=N[3],D=[].concat(Object(u.a)(C.map(function(e){return s.get(e)})),Object(u.a)(_.map(function(e){return f.get(e)}))),R=d.get(k);if(!R)throw new Error;var U=void 0;try{U=R.update.apply(R,Object(u.a)(D))}catch(v){console.log("application error")}s.set(k,U)}}catch(P){x=!0,O=P}finally{try{w||null==S.return||S.return()}finally{if(x)throw O}}return i.yieldStream?s.get(i.yieldStream):void 0},function(t){if(JSON.stringify(t)!==JSON.stringify(i)){var n=new Map,r=new Map,o=!0,u=!1,l=void 0;try{for(var s,f=i.literalStreamValues[Symbol.iterator]();!(o=(s=f.next()).done);o=!0){var d=s.value,m=Object(c.a)(d,2),p=m[0],v=m[1];n.set(p,v)}}catch(Qe){u=!0,l=Qe}finally{try{o||null==f.return||f.return()}finally{if(u)throw l}}var h=!0,y=!1,E=void 0;try{for(var g,b=t.literalStreamValues[Symbol.iterator]();!(h=(g=b.next()).done);h=!0){var w=g.value,x=Object(c.a)(w,2),O=x[0],I=x[1];r.set(O,I)}}catch(Qe){y=!0,E=Qe}finally{try{h||null==b.return||b.return()}finally{if(y)throw E}}var S=!0,j=!1,N=void 0;try{for(var k,A=function(){var e=k.value,t=Object(c.a)(e,1)[0];r.has(t)||a.forEach(function(e){e.streamEnvironment.delete(t)})},C=i.literalStreamValues[Symbol.iterator]();!(S=(k=C.next()).done);S=!0)A()}catch(Qe){j=!0,N=Qe}finally{try{S||null==C.return||C.return()}finally{if(j)throw N}}var _=!0,D=!1,R=void 0;try{for(var U,P=function(){var e=U.value,t=(M=Object(c.a)(e,2))[0],r=M[1];n.has(t)&&n.get(t)===r||a.forEach(function(e){e.streamEnvironment.set(t,r)})},L=t.literalStreamValues[Symbol.iterator]();!(_=(U=L.next()).done);_=!0){var M;P()}}catch(Qe){D=!0,R=Qe}finally{try{_||null==L.return||L.return()}finally{if(D)throw R}}var F=new Map,V=new Map,q=!0,H=!1,G=void 0;try{for(var B,W=i.applications[Symbol.iterator]();!(q=(B=W.next()).done);q=!0){var K=B.value,z=Object(c.a)(K,3),Z=z[0],J=z[1],X=z[2];F.set(Z,[J,X])}}catch(Qe){H=!0,G=Qe}finally{try{q||null==W.return||W.return()}finally{if(H)throw G}}var Y=!0,$=!1,Q=void 0;try{for(var ee,te=t.applications[Symbol.iterator]();!(Y=(ee=te.next()).done);Y=!0){var ne=ee.value,re=Object(c.a)(ne,3),ae=re[0],ie=re[1],oe=re[2];V.set(ae,[ie,oe])}}catch(Qe){$=!0,Q=Qe}finally{try{Y||null==te.return||te.return()}finally{if($)throw Q}}var ue=!0,ce=!1,le=void 0;try{for(var se,fe=function(){var e=se.value,t=Object(c.a)(e,2)[0];V.has(t)||a.forEach(function(e){e.applicationContext.get(t).terminate()})},de=i.applications[Symbol.iterator]();!(ue=(se=de.next()).done);ue=!0)fe()}catch(Qe){ce=!0,le=Qe}finally{try{ue||null==de.return||de.return()}finally{if(ce)throw le}}var me=!0,pe=!1,ve=void 0;try{for(var he,ye=function(){var e=he.value,t=(ge=Object(c.a)(e,3))[0],n=ge[1],r=ge[2],i=!1,o=F.get(t);if(o){var u=Object(c.a)(o,2),l=u[0],s=u[1];n===l&&function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(r,s)||(a.forEach(function(e){e.applicationContext.get(t).terminate()}),i=!0)}else i=!0;i&&a.forEach(function(e){var r=e.functionEnvironment.get(n);if(!r)throw Error();e.applicationContext.set(t,new T.ExecutionContext(r,e.requestUpdate))})},Ee=t.applications[Symbol.iterator]();!(me=(he=Ee.next()).done);me=!0){var ge;ye()}}catch(Qe){pe=!0,ve=Qe}finally{try{me||null==Ee.return||Ee.return()}finally{if(pe)throw ve}}var be=new Map,we=new Map,xe=!0,Oe=!1,Ie=void 0;try{for(var Se,je=i.containedDefinitions[Symbol.iterator]();!(xe=(Se=je.next()).done);xe=!0){var Ne=Se.value,Te=Object(c.a)(Ne,2),ke=Te[0],Ae=Te[1];be.set(ke,Ae)}}catch(Qe){Oe=!0,Ie=Qe}finally{try{xe||null==je.return||je.return()}finally{if(Oe)throw Ie}}var Ce=!0,_e=!1,De=void 0;try{for(var Re,Ue=t.containedDefinitions[Symbol.iterator]();!(Ce=(Re=Ue.next()).done);Ce=!0){var Pe=Re.value,Le=Object(c.a)(Pe,2),Me=Le[0],Fe=Le[1];we.set(Me,Fe)}}catch(Qe){_e=!0,De=Qe}finally{try{Ce||null==Ue.return||Ue.return()}finally{if(_e)throw De}}var Ve=!0,qe=!1,He=void 0;try{for(var Ge,Be=function(){var e=Ge.value,t=Object(c.a)(e,1)[0];we.has(t)||a.forEach(function(e){e.functionEnvironment.delete(t),e.updateContainedDefinition.delete(t)})},We=i.containedDefinitions[Symbol.iterator]();!(Ve=(Ge=We.next()).done);Ve=!0)Be()}catch(Qe){qe=!0,He=Qe}finally{try{Ve||null==We.return||We.return()}finally{if(qe)throw He}}var Ke=!0,ze=!1,Ze=void 0;try{for(var Je,Xe=function(){var t=Je.value,n=($e=Object(c.a)(t,2))[0],r=$e[1];be.has(n)?a.forEach(function(e){e.updateContainedDefinition.get(n)(r)}):a.forEach(function(t){var a=e(r,t.streamEnvironment,t.functionEnvironment),i=Object(c.a)(a,2),o=i[0],u=i[1];t.functionEnvironment.set(n,o),t.updateContainedDefinition.set(n,u)})},Ye=t.containedDefinitions[Symbol.iterator]();!(Ke=(Je=Ye.next()).done);Ke=!0){var $e;Xe()}}catch(Qe){ze=!0,Ze=Qe}finally{try{Ke||null==Ye.return||Ye.return()}finally{if(ze)throw Ze}}i=t,a.forEach(function(e){e.requestUpdate()})}}]}(r,new A,ie),f=Object(c.a)(l,2),d=f[0],m=f[1],p=Object(T.createNullaryVoidRootExecutionContext)(d);p.update(),n={context:p,updateCompiledDefinition:m,compiledDefinition:r}}return Object(s.a)({},t,{liveMain:n})}function ne(e,t){var n,r=(n=$(t),Object(s.a)({},n,{program:ee(n.program,n.derivedLookups.streamIdToNode)}));return te(e,Q($(r)))}function re(e,t){console.log("action",t.type);var n=null;if("SET_PATH"===t.type){var r=t.newPath,a=H(e.program,r),i="Identifier"===a.type?{originalNode:a,tentativeNode:a}:null;n=[e.program,r,i]}else if("EDIT_NEXT_UNDEFINED"===t.type){var o=Y(e,e.program,{type:"CONFIRM_EDIT"}),u=o?[o[0],o[1]]:[e.program,e.selectionPath],l=Object(c.a)(u,2),s=l[0],d=l[1],m=J(s,d);if(m){var p=Object(c.a)(m,2),v=p[0];n=[s,p[1],{originalNode:v,tentativeNode:v}]}else n=[s,d,null]}else n=Y(e,e.program,t);if(n){console.log("handled");var h=n,y=Object(c.a)(h,3),E=y[0],g=y[1],b=y[2];if(!f(E))throw new Error;return ne(e,{program:E,selectionPath:g,editingSelected:b,nativeFunctions:e.nativeFunctions,derivedLookups:{streamIdToNode:null,functionIdToNode:null,nodeToPath:null},liveMain:null})}return console.log("not handled"),e}var ae=[["add",["_a","_b"],[],function(e,t){return e+t}],["multiply",["_a","_b"],[],function(e,t){return e*t}],["show value",["_v"],[],_],["animation time",[],[],D],["is mouse down",[],[],R],["change count",["_stream"],[],U],["map",["_array"],[["_func",{parameters:["value"],functionParameters:[]}]],function(e,t){return P(t,e)}],["if",["cond","then","else"],[],function(e,t,n){return e?t:n}],["audio driver",[],[["_func",{parameters:["audio time","next frame","sample rate"],functionParameters:[]}]],L],["cosine",["_v"],[],Math.cos],["random",["repick"],[],M],["mouse click",[],[],F]],ie=new A;ie.set("id",function(e){return e}),ie.set("Array_of",Array.of),ae.forEach(function(e){var t=Object(c.a)(e,4),n=t[0],r=t[3];ie.set(n,r)});var oe=g(),ue=ne(void 0,{program:{type:"Program",mainDefinition:{type:"UserFunction",functionId:g(),identifier:null,signature:{parameters:[],functionParameters:[]},parameters:[],functionParameterFunctionIds:[],expressions:[{type:"Application",streamId:oe,identifier:{type:"Identifier",name:"md"},functionId:"is mouse down",arguments:[],functionArguments:[]},{type:"Application",streamId:g(),identifier:null,functionId:"show value",arguments:[{type:"Application",streamId:g(),identifier:null,functionId:"if",arguments:[{type:"StreamReference",streamId:g(),identifier:null,targetStreamId:oe},{type:"IntegerLiteral",streamId:g(),identifier:null,value:10},{type:"IntegerLiteral",streamId:g(),identifier:null,value:20}],functionArguments:[]}],functionArguments:[]}]}},selectionPath:["mainDefinition","expressions",0],editingSelected:null,nativeFunctions:ae.map(function(e){var t=Object(c.a)(e,3),n=t[0];return{type:"NativeFunction",functionId:n,identifier:{type:"Identifier",name:n},signature:{parameters:t[1],functionParameters:t[2]}}}),derivedLookups:{streamIdToNode:null,functionIdToNode:null,nodeToPath:null},liveMain:null});n(36);function ce(e,t){for(var n=0,r=0,a=e.length,i=0,o=t.length,u=!1,c=!1,l=!0,s=null,f=null,d=null,m=0,p=[];i!==o;){var v=r!==a?e.charAt(r):null,h=t.charAt(i),y=null!==v?v.toLowerCase():null,E=h.toLowerCase(),g=h.toUpperCase(),b=v&&y===E,w=s&&f===E;if((b&&s||s&&v&&f===y)&&(n+=m,p.push(d),s=null,f=null,d=null,m=0),b||w){var x=0;if(0===r)n+=Math.max(-3*i,-9);u&&(x+=5),l&&(x+=10),c&&h===g&&E!==g&&(x+=10),b&&++r,x>=m&&(null!==s&&(n+=-1),f=(s=h).toLowerCase(),d=i,m=x),u=!0}else n+=-1,u=!1;c=h===E&&E!==g,l="_"===h||" "===h,++i}s&&(n+=m,p.push(d));for(var O="",I=0,S=0;S<p.length;++S){var j=p[S];O+=t.substr(I,j-I)+"<b>"+t.charAt(j)+"</b>",I=j+1}return[r===a,n,O+=t.substr(I,t.length-I)]}function le(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,u=t[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var l=o.value,s=Object(c.a)(l,2),f=s[0],d=s[1],m=ce(e,f),p=Object(c.a)(m,3),v=p[0],h=p[1],y=p[2];v&&n.push({score:h,formattedStr:y,name:f,data:d})}}catch(E){a=!0,i=E}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}return""!==e&&n.sort(function(e,t){return t.score-e.score}),n}var se=/^[-+]?(?:\d*\.?\d+|\d+\.?\d*)(?:[eE][-+]?\d+)?$/;function fe(e,t){var n=[];""===e&&n.push({type:"undefined"});var r=K(t),a=r.namedStreams,i=r.namedFunctions,o=le(e,a),u=!0,c=!1,l=void 0;try{for(var s,f=o[Symbol.iterator]();!(u=(s=f.next()).done);u=!0){var d=s.value;n.push({type:"streamref",node:d.data})}}catch(b){c=!0,l=b}finally{try{u||null==f.return||f.return()}finally{if(c)throw l}}var m=le(e,i),p=!0,v=!1,h=void 0;try{for(var y,E=m[Symbol.iterator]();!(p=(y=E.next()).done);p=!0){var g=y.value;n.push({type:"function",node:g.data})}}catch(b){v=!0,h=b}finally{try{p||null==E.return||E.return()}finally{if(v)throw h}}return se.test(e)&&n.push({type:"number",value:Number(e)}),0===n.length&&n.push({type:"undefined"}),n}function de(e){var t=e.choice;switch(t.type){case"undefined":return a.a.createElement("em",null,"undefined");case"number":return a.a.createElement("span",null,t.value);case"streamref":return a.a.createElement("span",null,a.a.createElement("em",null,"S")," ",t.node.identifier.name," ",a.a.createElement("small",null,"(id ",t.node.streamId,")"));case"function":return a.a.createElement("span",null,a.a.createElement("em",null,"F")," ",t.node.identifier.name,"(",[].concat([t.node.signature.parameters.map(function(e){return e.startsWith("_")?"\u25a1":e}),t.node.signature.functionParameters.map(function(e){var t=Object(c.a)(e,1)[0];return"F "+(t.startsWith("_")?"\u25a1":t)})]).join(", "),")");default:throw new Error}}function me(e){e.node;var t=e.mainState,n=e.dispatch,i=Object(r.useRef)();Object(r.useEffect)(function(){i.current&&i.current.scrollIntoView({block:"nearest",inline:"nearest"})});var o=Object(r.useState)(function(){var e=t.editingSelected.tentativeNode;switch(e.type){case"UndefinedExpression":return"";case"IntegerLiteral":return e.value.toString();case"StreamReference":case"Application":return"";default:throw new Error}}),u=Object(c.a)(o,2),l=u[0],f=u[1],d=function(e){var r,a=e.choices[e.index];switch(a.type){case"undefined":r={type:"UndefinedExpression"};break;case"number":r={type:"IntegerLiteral",value:a.value};break;case"streamref":r={type:"StreamReference",targetStreamId:a.node.streamId};break;case"function":r={type:"Application",functionId:a.node.functionId,arguments:a.node.signature.parameters.map(function(e){return{type:"UndefinedExpression",streamId:g(),identifier:null}}),functionArguments:a.node.signature.functionParameters.map(function(e){var t=Object(c.a)(e,2)[1];return{type:"UserFunction",functionId:g(),identifier:null,signature:t,parameters:t.parameters.map(function(e){return{type:"Parameter",streamId:g(),identifier:{type:"Identifier",name:e}}}),functionParameterFunctionIds:t.functionParameters.map(function(e){var t=Object(c.a)(e,2);t[0],t[1];return g()}),expressions:[{type:"UndefinedExpression",streamId:g(),identifier:null}]}})};break;default:throw new Error}r.streamId=t.editingSelected.tentativeNode.streamId,r.identifier=t.editingSelected.tentativeNode.identifier,n({type:"UPDATE_EDITING_TENTATIVE_NODE",newNode:r})},m=function(e){var n={choices:fe(e,t),index:0};return d(n),n},p=function(e){E(function(t){var n=Object(s.a)({},t,{index:(t.index+e+t.choices.length)%t.choices.length});return d(n),n})},v=Object(r.useState)(function(){return m(l)}),h=Object(c.a)(v,2),y=h[0],E=h[1];return a.a.createElement("div",null,a.a.createElement("input",{className:"Editor-text-edit-input",value:l,onChange:function(e){var t=e.target.value;"["===t?(n({type:"END_EXPRESSION_EDIT"}),n({type:"CREATE_ARRAY"})):(f(t),E(m(t)))},onKeyDown:function(e){switch(e.key){case"ArrowUp":e.preventDefault(),p(-1);break;case"ArrowDown":e.preventDefault(),p(1)}},autoFocus:!0}),a.a.createElement("ul",{className:"ExpressionChooser-dropdown"},y.choices.map(function(e,t){return a.a.createElement("li",{key:t,className:t===y.index?"ExpressionChooser-dropdown-selected":"",ref:t===y.index?i:void 0},a.a.createElement(de,{choice:e}))})))}n(37);function pe(e){var t=e.selected,n=e.onSelect,i=e.onEdit,o=e.children,u=e.extraClassName,l=Object(r.useState)(!1),s=Object(c.a)(l,2),f=s[0],d=s[1],m=u||"";m+=" SimpleTheme-selectable",t?m+=" SimpleTheme-selected":f&&(m+=" SimpleTheme-hovered");return a.a.createElement("div",{className:m,onClick:function(e){n&&"INPUT"!==e.target.tagName&&(e.stopPropagation(),n())},onDoubleClick:function(e){i&&"INPUT"!==e.target.tagName&&(e.stopPropagation(),i())},onMouseOver:function(e){d(!0),e.stopPropagation()},onMouseOut:function(e){d(!1)}},o)}var ve=function(e){var t=e.expressionGrouping,n=e.applicationArguments;return{Program:function(e){var t=e.expressions;return a.a.createElement("div",{className:"SimpleTheme-program"},t)},Application:function(e){var t=e.functionName,r=e.streamArgs,i=e.functionArgs,o="right"===n||"right-centered"===n?"SimpleTheme-application-flex":"",u="SimpleTheme-application-function-name"+("right-centered"===n?" SimpleTheme-application-function-name-centered":"");return a.a.createElement("div",{className:o},a.a.createElement("div",{className:u},t),a.a.createElement("div",{className:"SimpleTheme-application-arguments"},r.map(function(e){var t=e.key,n=e.name,r=e.expression;return a.a.createElement("div",{className:"SimpleTheme-application-argument",key:t},n?a.a.createElement("span",{className:"SimpleTheme-application-argument-name"},n,":"):null,a.a.createElement("span",{className:"SimpleTheme-application-argument-expression"},r))}),i.map(function(e){var t=e.key,n=(e.name,e.functionExpression);return a.a.createElement("div",{className:"SimpleTheme-application-argument",key:t},n)})))},UserFunction:function(e){var t=e.parameterNames,n=e.expressions,r=e.selected,i=e.onSelect;return a.a.createElement(pe,{selected:r,onSelect:i,extraClassName:"SimpleTheme-user-function"},a.a.createElement("div",null,"F ",t.join(", ")),a.a.createElement("div",{className:"SimpleTheme-user-function-expressions"},n))},DefinitionExpression:function(e){var t=e.expression;return a.a.createElement("div",{className:"SimpleTheme-definition-expression"},t)},Expression:function(e){var n=e.identifier,r=e.selected,i=e.onSelect,o=e.onEdit,u=e.inside,c="SimpleTheme-expression";switch(t){case"background":c+=" SimpleTheme-expression-background";break;case"shadow":c+=" SimpleTheme-expression-shadow"}return a.a.createElement(pe,{selected:r,onSelect:i,onEdit:o,extraClassName:c},function(){switch(t){case"line":return a.a.createElement("div",{className:"SimpleTheme-expression-line"});case"bracket":return a.a.createElement("div",{className:"SimpleTheme-expression-bracket"});default:return null}}(),a.a.createElement("div",null,n?a.a.createElement("div",{className:"SimpleTheme-expression-identifier"},n):null,a.a.createElement("div",{className:"SimpleTheme-expression-main"},u)))},Identifier:function(e){var t=e.selected,n=e.onSelect,r=e.inside;return a.a.createElement(pe,{selected:t,onSelect:n,extraClassName:"SimpleTheme-identifier"},r)},StreamReference:function(e){var t=e.name;return a.a.createElement("div",null,a.a.createElement("span",{className:"SimpleTheme-stream-reference"},t))},UndefinedExpression:function(){return a.a.createElement("div",{className:"SimpleTheme-undefined-expression"},"\xa0")},ArrayLiteral:function(e){var t=e.keyedItems;return a.a.createElement("div",null,a.a.createElement("div",null,"["),a.a.createElement("div",{className:"SimpleTheme-array-items"},t.map(function(e){var t=Object(c.a)(e,2),n=t[0],r=t[1];return a.a.createElement("div",{className:"SimpleTheme-array-item",key:n},r)})),a.a.createElement("div",null,"]"))}}},he=(n(38),{expressionGrouping:"line",applicationArguments:"below"}),ye=ve(he);function Ee(e){var t=e.keyLabels,n=e.selectedKey,r=e.onChange;return a.a.createElement("select",{value:n,onChange:function(e){r(e.target.value)}},t.map(function(e){var t=Object(c.a)(e,2),n=t[0],r=t[1];return a.a.createElement("option",{key:n,value:n},r)}))}function ge(e){var t=e.onChange,n=Object(r.useState)(he),i=Object(c.a)(n,2),o=i[0],u=i[1],l=function(e){u(e),t(ve(e))};return a.a.createElement("div",{className:"ThemePicker"},a.a.createElement("div",{className:"ThemePicker-option"},a.a.createElement("label",null,"Expression Grouping: ",a.a.createElement(Ee,{keyLabels:[["none","None"],["line","Line"],["bracket","Bracket"],["background","Background"],["shadow","Shadow"]],selectedKey:o.expressionGrouping,onChange:function(e){return l(Object(s.a)({},o,{expressionGrouping:e}))}}))),a.a.createElement("div",{className:"ThemePicker-option"},a.a.createElement("label",null,"Application Arguments: ",a.a.createElement(Ee,{keyLabels:[["below","Below"],["right","Right"],["right-centered","Right (centered)"]],selectedKey:o.applicationArguments,onChange:function(e){return l(Object(s.a)({},o,{applicationArguments:e}))}}))))}n(39);var be={MOVE_UP:"up",MOVE_DOWN:"down",MOVE_LEFT:"left",MOVE_RIGHT:"right",ZOOM_IN:"shift+right",ZOOM_OUT:"shift+left",TOGGLE_EDIT:"enter",ABORT_EDIT:"escape",EDIT_AFTER:["shift+enter",","],DELETE:"backspace",BEGIN_IDENTIFIER_EDIT:"=",EDIT_NEXT_UNDEFINED:"tab"},we=new Set(["=",","]),xe=["Enter","Shift","Escape","Tab","=",","],Oe=Object(r.createContext)(),Ie=Object(r.createContext)(),Se=Object(r.createContext)();function je(e){return e===Object(r.useContext)(Se)}function Ne(e){var t=Object(r.useContext)(Ie),n=Object(r.useContext)(Oe);return function(){var r=n.derivedLookups.nodeToPath.get(e);r&&t({type:"SET_PATH",newPath:r})}}var Te=Object(r.createContext)();function ke(e){var t=e.program,n=Object(r.useContext)(Te).Program;return a.a.createElement(n,{expressions:a.a.createElement(Ae,{expressions:t.mainDefinition.expressions})})}function Ae(e){var t=e.expressions,n=Object(r.useContext)(Te).DefinitionExpression;return a.a.createElement(a.a.Fragment,null,t.map(function(e){return a.a.createElement("div",{key:e.streamId},a.a.createElement(n,{expression:a.a.createElement(Ve,{expression:e})}))}))}function Ce(e){var t=e.initialName,n=e.onUpdateName,i=(e.onEndEdit,Object(r.useState)(t||"")),o=Object(c.a)(i,2),u=o[0],l=o[1];return a.a.createElement("input",{className:"Editor-text-edit-input",value:u,onChange:function(e){var t=e.target.value;l(t),n&&n(t)},autoFocus:!0})}function _e(e){var t=e.identifier,n=je(t),i=Ne(t),o=Object(r.useContext)(Oe).editingSelected,u=Object(r.useContext)(Ie),c=Object(r.useContext)(Te).Identifier;return a.a.createElement(c,{selected:n,onSelect:i,inside:n&&o?a.a.createElement(Ce,{initialName:t.name,onUpdateName:function(e){u({type:"UPDATE_EDITING_TENTATIVE_NODE",newNode:{type:"Identifier",name:e}})}}):t.name})}function De(e){var t=e.integerLiteral;return a.a.createElement("div",null,t.value)}function Re(e){var t=e.arrayLiteral,n=Object(r.useContext)(Te).ArrayLiteral;return a.a.createElement(n,{keyedItems:t.items.map(function(e){return[e.streamId,a.a.createElement(Ve,{expression:e})]})})}function Ue(e){e.undefinedExpression;var t=Object(r.useContext)(Te).UndefinedExpression;return a.a.createElement(t,null)}function Pe(e){var t=e.streamReference,n=Object(r.useContext)(Oe).derivedLookups.streamIdToNode.get(t.targetStreamId);if(!n)throw new Error;var i=Object(r.useContext)(Te).StreamReference;return a.a.createElement(i,{name:n.identifier&&n.identifier.name?n.identifier.name:"<stream "+t.targetStreamId+">"})}function Le(e){var t=e.userFunction,n=je(t),i=Ne(t),o=Object(r.useContext)(Te).UserFunction;return a.a.createElement(o,{parameterNames:t.parameters.map(function(e){return e.identifier.name}),expressions:a.a.createElement(Ae,{expressions:t.expressions}),selected:n,onSelect:i})}function Me(e){var t=e.application,n=Object(r.useContext)(Oe).derivedLookups.functionIdToNode.get(t.functionId);if(!n)throw new Error;if(n.signature.parameters.length!==t.arguments.length)throw new Error("params and args length mismatch");if(n.signature.functionParameters.length!==t.functionArguments.length)throw new Error("function params and args length mismatch");var i=n.identifier&&n.identifier.name?n.identifier.name:"<function "+t.functionId+">",o=n.signature.parameters.map(function(e,n){return{key:e,name:e.startsWith("_")?void 0:e,expression:a.a.createElement(Ve,{expression:t.arguments[n]})}}),u=n.signature.functionParameters.map(function(e,n){var r=Object(c.a)(e,2),i=r[0];r[1];return{key:i,name:"dunno",functionExpression:a.a.createElement(Le,{userFunction:t.functionArguments[n]})}}),l=Object(r.useContext)(Te).Application;return a.a.createElement(l,{functionName:i,streamArgs:o,functionArgs:u})}function Fe(e){var t=e.expression;switch(t.type){case"IntegerLiteral":return a.a.createElement(De,{integerLiteral:t});case"ArrayLiteral":return a.a.createElement(Re,{arrayLiteral:t});case"UndefinedExpression":return a.a.createElement(Ue,{undefinedExpression:t});case"StreamReference":return a.a.createElement(Pe,{streamReference:t});case"Application":return a.a.createElement(Me,{application:t});default:throw new Error}}function Ve(e){var t=e.expression,n=je(t),i=Ne(t),o=function(e){var t=Object(r.useContext)(Ie),n=Object(r.useContext)(Oe);return function(){var r=n.derivedLookups.nodeToPath.get(e);r&&(t({type:"SET_PATH",newPath:r}),t({type:"TOGGLE_EDIT"}))}}(t),u=Object(r.useContext)(Oe),c=u.editingSelected,l=Object(r.useContext)(Ie),s=Object(r.useContext)(Te).Expression;return a.a.createElement(s,{identifier:t.identifier?a.a.createElement(_e,{identifier:t.identifier}):null,selected:n,onSelect:i,onEdit:o,inside:n&&c?a.a.createElement(me,{node:t,mainState:u,dispatch:l}):a.a.createElement(Fe,{expression:t})})}function qe(e){var t=e.autoFocus,n=Object(r.useReducer)(re,ue),i=Object(c.a)(n,2),o=i[0],s=i[1],f=Object(r.useState)(ye),d=Object(c.a)(f,2),m=d[0],p=d[1],v=Object(r.useRef)(),h=Object(r.useState)(t),y=Object(c.a)(h,1)[0];Object(r.useEffect)(function(){y&&v.current.focus()},[y]);var E=Object(r.useRef)(!1);Object(r.useEffect)(function(){E.current&&!o.editingSelected&&v.current.focus(),E.current=o.editingSelected});for(var g={},b=function(){var e=x[w];g[e]=function(t){t.preventDefault(),s({type:e})}},w=0,x=Object.keys(be);w<x.length;w++)b();return a.a.createElement(l.HotKeys,{keyMap:be,handlers:g},a.a.createElement(l.ObserveKeys,{only:xe},a.a.createElement("div",{className:"Editor",onKeyDown:function(e){"input"===e.target.tagName.toLowerCase()||1!==Object(u.a)(e.key).length||e.altkey||e.ctrlKey||e.metaKey||we.has(e.key)||s({type:"BEGIN_OVERWRITE_EDIT"})},tabIndex:"0",ref:v},a.a.createElement("div",{className:"Editor-theme-controls"},a.a.createElement(ge,{onChange:function(e){p(e)}})),a.a.createElement(Ie.Provider,{value:s},a.a.createElement(Se.Provider,{value:H(o.program,o.selectionPath)},a.a.createElement(Oe.Provider,{value:o},a.a.createElement(Te.Provider,{value:m},a.a.createElement(ke,{program:o.program}))))))))}var He=function(){return a.a.createElement("div",{className:"App"},a.a.createElement(qe,{autoFocus:!0}),a.a.createElement("div",null,a.a.createElement("h2",null,"Notes"),a.a.createElement("ul",null,a.a.createElement("li",null,"If you don't see a green selection/cursor box, focus the editor."),a.a.createElement("li",null,"The mouse can be used to select parts of the tree, but otherwise editing is keyboard-driven."),a.a.createElement("li",null,"Up/down arrows move selection up and down within lists (expressions, arguments, arrays)."),a.a.createElement("li",null,"Right/left arrows move selection in and out of nested structures."),a.a.createElement("li",null,"Enter on an expression (or expression sub-tree) will begin editing it. Pressing enter again will stop editing."),a.a.createElement("li",null,"Instead of pressing enter, you can just start typing letters/numbers and it will begin the edit (overwriting what it there)."),a.a.createElement("li",null,"Escape aborts the current edit."),a.a.createElement("li",null,"Shift-enter (or comma) adds a new expression (or array item) below the current one."),a.a.createElement("li",null,"Pressing the = key on on an expression will move to editing its name/label."),a.a.createElement("li",null,"A red box indicates an undefined expression."),a.a.createElement("li",null,"Tab edits the next undefined expression."),a.a.createElement("li",null,"Delete will delete expressions, array items, etc."),a.a.createElement("li",null,"Typing [ when editing an expression will create an array literal."))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(He,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[16,1,2]]]);
//# sourceMappingURL=main.2ac5234a.chunk.js.map