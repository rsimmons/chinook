(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=null,a=function(){function e(e,t,n){void 0===n&&(n=null),this.streamFunc=e,this.onRequestUpdate=t,this.afterTerminate=n,this.hookRecordChain={data:null,cleanup:null,next:null},this.recordCursor=null,this.openRecord=null,this.updateCount=0}return e.prototype.update=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n;r={executionContext:this,previousFrame:r},this.recordCursor=this.hookRecordChain;try{if(n=this.streamFunc.apply(null,arguments),this.recordCursor.next)throw new Error("Did not reach all hook records in update")}finally{var a=r;if(!a)throw new Error("Cannot pop update frame because current is null");if(a.executionContext!==this)throw new Error("Popped frame from update stack but context did not match");r=a.previousFrame}return this.updateCount++,n},e.prototype.terminate=function(){for(var e=this.hookRecordChain.next;e;e=e.next)e.cleanup&&e.cleanup();this.afterTerminate&&this.afterTerminate()},e.prototype._beginHook=function(){if(this.openRecord)throw new Error("This is already an open hook when beginning another");if(!this.recordCursor)throw new Error;if(0===this.updateCount){if(this.recordCursor.next)throw new Error("Expecting to create new hook record in chain, but already present");this.recordCursor.next={data:null,cleanup:null,next:null}}if(!this.recordCursor.next)throw new Error("Expecting to find hook record in chain, but not present");return this.openRecord=this.recordCursor.next,this.recordCursor.next},e.prototype._endHook=function(){if(!this.recordCursor)throw new Error;if(this.openRecord!==this.recordCursor.next)throw new Error("Hook close does not match open");this.openRecord=null,this.recordCursor=this.recordCursor.next},e.prototype._requestUpdate=function(){this.onRequestUpdate()},e.prototype._setStreamFunc=function(e){this.streamFunc=e},e}();t.ExecutionContext=a;var i=null;function o(e){i?i.callbacks.add(e):e()}function u(){if(!r)throw new Error("Cannot get currently updating execution context because update stack is empty. Was a hook called outside of an execution context update?");return r.executionContext}function c(e){var t=u(),n=t._beginHook();if(!n.data){var r=e instanceof Function?e():e;n.data={current:r}}return t._endHook(),n.data}function s(){var e=u(),t=e._beginHook();return t.data||(t.data={requestUpdate:function(){e._requestUpdate()}}),e._endHook(),t.data.requestUpdate}function l(e){var t,n=u(),r=n._beginHook();if(!r.data){var a=[],i={queue:a,lastStream:null,unsubscribe:null,onValue:function(e){a.push(e)}};r.data=i,r.cleanup=function(){i.unsubscribe&&i.unsubscribe()}}var o=r.data;if(e!==o.lastStream){if(o.queue.length)throw new Error("useEventReceiver stream changed, but value is in queue");if(o.lastStream){if(!o.unsubscribe)throw new Error("should not be possible");o.unsubscribe(),o.lastStream=null,o.unsubscribe=null}o.lastStream=e,e&&(o.unsubscribe=e.subscribe(o.onValue))}else if(o.queue.length){if(o.queue.length>1)throw new Error("useEventReceiver found more than one enqueued value");t={value:o.queue.pop()}}return n._endHook(),t}t.beginBatch=function(){if(i)throw new Error("cannot begin batch when one is already active");i={callbacks:new Set}},t.endBatch=function(){if(!i)throw new Error("cannot end batch when none is active");i.callbacks.forEach(function(e){e()}),i=null},t.enqueueBatchedUpdate=o,t.createNullaryVoidRootExecutionContext=function(e){var t=new a(e,function(){o(function(){t.update()})});return t},t.useVar=c,t.useRequestUpdate=s,t.useInitialize=function(e){var t=u(),n=t._beginHook();n.data||(n.cleanup=e()||null,n.data={}),t._endHook()},t.useEventEmitter=function(){var e=u(),t=e._beginHook();if(!t.data){var n=new Set,r={subscribe:function(e){return n.add(e),function(){n.delete(e)}}};t.data={stream:r,emit:function(e){n.forEach(function(t){t(e)})}}}return e._endHook(),[t.data.stream,t.data.emit]},t.useEventReceiver=l,t.useDynamic=function(e,t){var n=u(),r=n._beginHook();if(!r.data){var i=t||function(){n._requestUpdate()},o={activeContexts:new Set,createContext:function(){var e=new a(o.streamFunc,i,function(){o.activeContexts.delete(e)});return o.activeContexts.add(e),e},streamFunc:function(){throw new Error("should be unreachable")}};r.data=o,r.cleanup=function(){o.activeContexts.forEach(function(e){return e.terminate()})}}return r.data.streamFunc=e,r.data.activeContexts.forEach(function(t){t._setStreamFunc(e)}),n._endHook(),r.data.createContext},t.useReducer=function(e,t,n){var r=c(n),a=l(e);return a&&(r.current=t(r.current,a.value)),r.current},t.useReducers=function(e,t){var n=c(t),r=c(e.length);if(e.length!==r.current)throw new Error("The number of streams/reducers supplied to useMultiReducer cannot change");for(var a=0,i=0,o=e;i<o.length;i++){var u=o[i],s=u[0],f=u[1],d=l(s);if(d){if(a>0)throw new Error("useMultiReducer got multiple events, cannot merge");n.current=f(n.current,d.value),a++}}return n.current},t.useCallbackReducer=function(e,t){var n=s(),r=c(t),a=c(function(){return function(t){r.current=e(r.current,t),n()}});return[r.current,a.current]},t.useCallbackReducers=function(e,t){var n=s(),r=c(t),a=e.map(function(e){return function(t){r.current=e(r.current,t),n()}});return[r.current,a]},t.useMachine=function(e,t){var n,r=u(),i=r._beginHook(),o=function(t){i.data.activeContext&&i.data.activeContext.terminate();var n=t[0],o=t[1],u=new a(e[n],function(){r._requestUpdate()});i.data.activeState=n,i.data.activeContext=u,i.data.activeArgument=o};if(!i.data){var c={activeContext:null};i.data=c,o(t),i.cleanup=function(){if(!c.activeContext)throw new Error("should have been initialized");c.activeContext.terminate()}}for(;;){i.data.activeContext._setStreamFunc(e[i.data.activeState]);var s=i.data.activeContext.update(i.data.activeArgument),l=s[0],f=s[1];if(n=l,!f)break;o(f)}return r._endHook(),n}},,,,,,,,,,,,function(e,t,n){e.exports=n(40)},,,,,,function(e,t,n){},function(e,t,n){},,,,function(e,t,n){"use strict";n.r(t),n.d(t,"showString",function(){return h}),n.d(t,"animationFrameEvts",function(){return y}),n.d(t,"animationTime",function(){return b}),n.d(t,"countEvents",function(){return g}),n.d(t,"mouseClickEvts",function(){return x}),n.d(t,"mouseDown",function(){return O}),n.d(t,"mousePosition",function(){return I}),n.d(t,"random",function(){return S}),n.d(t,"audioDriver",function(){return j}),n.d(t,"sampleUpon",function(){return k}),n.d(t,"everySecond",function(){return A}),n.d(t,"loadAudioAsArray",function(){return C}),n.d(t,"integral",function(){return N}),n.d(t,"expFollow",function(){return _}),n.d(t,"redCircle",function(){return T}),n.d(t,"followAtSpeed2d",function(){return D}),n.d(t,"eventAfter",function(){return R}),n.d(t,"received",function(){return U}),n.d(t,"streamMap",function(){return L}),n.d(t,"changeCount",function(){return F});n(5);var r=n(1),a=n(4),i=a.useVar,o=a.useRequestUpdate,u=a.useInitialize,c=a.useEventEmitter,s=a.useEventReceiver,l=a.useDynamic,f=a.useReducer,d=a.useReducers,m=n(28),p=m.renderDOMAppendedToBody,v=m.h;function h(e){var t=v("div",{style:{border:"1px solid red",color:"black",fontSize:"24px",padding:"5px",marginTop:"20px"}},"showString: "+(void 0===e?"(undefined)":e.toString()));p(t)}function y(){var e=o(),t=i(),n=c(),a=Object(r.a)(n,2),s=a[0],l=a[1];return u(function(){return t.current=requestAnimationFrame(function n(r){l(.001*r),e(),t.current=requestAnimationFrame(n)}),function(){cancelAnimationFrame(t.current)}}),s}function E(e,t){return f(e,function(e,t){return t},t)}function b(){return E(y(),function(){return.001*performance.now()})}function g(e){return f(e,function(e){return e+1},0)}function w(e,t,n){var a=o(),i=c(),s=Object(r.a)(i,2),l=s[0],f=s[1];return u(function(){var e=function(e){f(e),a()};return document.addEventListener(t,e,n),function(){document.removeEventListener(t,e,n)}}),l}function x(){return w(document,"mousedown")}function O(){var e=w(document,"mousedown"),t=w(document,"mouseup");return d([[t,function(){return!1}],[e,function(){return!0}]],!1)}function I(){return E(function(e){var t=s(e),n=c(),a=Object(r.a)(n,2),i=a[0],o=a[1];return t&&o(t.value),i}(w(document,"mousemove")),{x:0,y:0})}function S(e){return f(e,function(){return Math.random()},function(){return Math.random()})}function j(e){var t=l(e),n=i(),a=i(0),o=i(),s=c(),f=Object(r.a)(s,2),d=f[0],m=f[1];u(function(){n.current=t();var e=new(window.AudioContext||window.webkitAudioContext),r=e.createScriptProcessor(1024,0,1);return r.onaudioprocess=function(e){for(var t=e.outputBuffer.getChannelData(0),r=0;r<t.length;r++){m();var i=n.current.update(a.current/o.current,d,o.current);!i||Number.isNaN(i)?i=0:i>1?i=1:i<-1&&(i=-1),t[r]=i,a.current++}},r.connect(e.destination),o.current=e.sampleRate,function(){r.disconnect(),e.close()}}),n.current.update(a.current/o.current,d,o.current)}function k(e,t,n){return f(t,function(){return e},n)}function A(){var e=o(),t=c(),n=Object(r.a)(t,2),a=n[0],i=n[1];return u(function(){var t=setInterval(function(){i(),e()},1e3);return function(){clearInterval(t)}}),a}function C(e){var t=o(),n=i([0]);return u(function(){var r=new(window.AudioContext||window.webkitAudioContext),a=!1,i=new XMLHttpRequest;return i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){var e=i.response;r.decodeAudioData(e,function(e){a||(n.current=e.getChannelData(0),t())})},i.send(),function(){i.abort(),a=!0}}),n.current}function N(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=i(n),a=i(t),o=e(r.current,a.current);return r.current+=(t-a.current)*o,a.current=t,r.current}function _(e,t,n,r){return N(function(n){return t*(e-n)},n,r)}function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,n=e||{x:0,y:0};t<0&&(t=0);var r=.5*t,a=v("div",{style:{position:"absolute",borderRadius:"50%",background:"red",pointerEvents:"none",userSelect:"none",left:n.x-r+"px",top:n.y-r+"px",width:t+"px",height:t+"px"}});p(a)}function D(e,t,n,r){var a=i(r),o=i(n),u=n-o.current,c=e.x-a.current.x,s=e.y-a.current.y,l=Math.sqrt(c*c+s*s);return a.current=t*u>=l?e:{x:a.current.x+u*t*c/l,y:a.current.y+u*t*s/l},o.current=n,a.current}function R(e,t){var n=c(),a=Object(r.a)(n,2),o=a[0],s=a[1],l=i(t);return l.current=t,u(function(){var t=setTimeout(function(){s(l.current)},1e3*e);return function(){clearTimeout(t)}}),o}function U(e){return f(e,function(e,t){return!0},!1)}function L(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=l(e),r=i([]);t.length>r.current.length;)r.current.push(n());for(;t.length<r.current.length;){r.current.pop().terminate()}return r.current.map(function(e,n){return e.update(t[n])})}function F(e){var t,n,r=i(0),a=i(e);return t=e,n=a.current,Number.isNaN(t)&&Number.isNaN(n)||t===n||r.current++,a.current=e,r.current}},function(e,t,n){"use strict";n.r(t),n.d(t,"h",function(){return i}),n.d(t,"renderDOMIntoElement",function(){return u}),n.d(t,"renderDOMIntoSelector",function(){return c}),n.d(t,"renderDOMAppendedToBody",function(){return s});var r=n(4),a=n(41).init([n(29).default,n(30).default,n(31).default,n(32).default]),i=n(33).default;function o(e){return{sel:e.sel,data:e.data,children:e.children&&e.children.map(o),text:e.text,key:e.key,elm:e.elm}}function u(e,t){var n=Object(r.useVar)(t),i=Object(r.useVar)(),u=o(e);if(Object(r.useInitialize)(function(){return function(){n.current.innerHTML=""}}),i.current)a(i.current,u);else{var c=document.createElement("div");n.current.appendChild(c),a(c,u)}i.current=u}function c(e,t){u(e,Object(r.useVar)(function(){return document.querySelector(t)}).current)}function s(e){var t=Object(r.useVar)();Object(r.useInitialize)(function(){var e=document.createElement("div");return document.body.appendChild(e),t.current=e,function(){document.body.removeChild(e)}}),u(e,t.current)}},,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(11),o=n.n(i),u=(n(22),n(23),n(5)),c=n(1),s=n(9),l=n(3);function f(e){return"Program"===e.type}function d(e){return"ArrayLiteral"===e.type}function m(e){return"Application"===e.type}function p(e){return function(e){return"UndefinedExpression"===e.type}(e)||function(e){return"IntegerLiteral"===e.type}(e)||d(e)||function(e){return"StreamReference"===e.type}(e)||m(e)||function(e){return"Parameter"===e.type}(e)}function v(e){return"UserFunction"===e.type}function h(e){return f(e)||function(e){return"Identifier"===e.type}(e)||p(e)||function(e){return function(e){return"NativeFunction"===e.type}(e)||v(e)}(e)}var y=function(){return Math.random().toString(16).substring(2,10)},E=function(){return y()+y()},b=n(7),g=n(14),w=n(8),x=n(12),O=n(15),I=function(e){function t(){return Object(b.a)(this,t),Object(g.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(x.a)(t,e),t}(Object(O.a)(Error));function S(e,t,n,r,a){if(!r.has(e.streamId)){if(n.has(e.streamId))throw new I("graph cycle");switch(e.type){case"Parameter":break;case"UndefinedExpression":a.literalStreamValues.push([e.streamId,void 0]);break;case"IntegerLiteral":a.literalStreamValues.push([e.streamId,e.value]);break;case"ArrayLiteral":n.add(e.streamId);var i=!0,o=!1,u=void 0;try{for(var c,s=e.items[Symbol.iterator]();!(i=(c=s.next()).done);i=!0){S(c.value,t,n,r,a)}}catch(O){o=!0,u=O}finally{try{i||null==s.return||s.return()}finally{if(o)throw u}}n.delete(e.streamId),a.applications.push([e.streamId,"Array_of",e.items.map(function(e){return e.streamId}),[]]);break;case"StreamReference":var l=t.derivedLookups.streamIdToNode.get(e.targetStreamId);if(!l)throw Error();n.add(e.streamId),S(l,t,n,r,a),n.delete(e.streamId),a.applications.push([e.streamId,"id",[e.targetStreamId],[]]);break;case"Application":var f=t.derivedLookups.functionIdToNode.get(e.functionId);if(!f)throw Error();n.add(e.streamId);var d=!0,m=!1,p=void 0;try{for(var v,h=e.arguments[Symbol.iterator]();!(d=(v=h.next()).done);d=!0){S(v.value,t,n,r,a)}}catch(O){m=!0,p=O}finally{try{d||null==h.return||h.return()}finally{if(m)throw p}}n.delete(e.streamId);var y=!0,E=!1,b=void 0;try{for(var g,w=e.functionArguments[Symbol.iterator]();!(y=(g=w.next()).done);y=!0){var x=g.value;a.containedDefinitions.push([x.functionId,j(x,t)])}}catch(O){E=!0,b=O}finally{try{y||null==w.return||w.return()}finally{if(E)throw b}}a.applications.push([e.streamId,f.functionId,e.arguments.map(function(e){return e.streamId}),e.functionArguments.map(function(e){return e.functionId})]);break;default:throw new Error}r.add(e.streamId)}}function j(e,t){var n=new Set,r=new Set,a={parameterStreams:e.parameters.map(function(e){return e.streamId}),literalStreamValues:[],applications:[],containedDefinitions:[],yieldStream:null},i=!0,o=!1,u=void 0;try{for(var c,s=e.expressions[Symbol.iterator]();!(i=(c=s.next()).done);i=!0){var l=c.value;S(l,t,n,r,a),a.yieldStream=l.streamId}}catch(f){o=!0,u=f}finally{try{i||null==s.return||s.return()}finally{if(o)throw u}}return a}var k=n(4),A=n(13);var C=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;Object(b.a)(this,e),this.obj=void 0,this.obj=Object.create(t?t.obj:null)}return Object(A.a)(e,[{key:"get",value:function(e){return this.obj[e]}},{key:"set",value:function(e,t){this.obj[e]=t}},{key:"delete",value:function(e){delete this.obj[e]}}]),e}();var N=n(27),_=N.showString,T=N.animationTime,D=N.mouseDown,R=N.changeCount,U=N.streamMap,L=N.audioDriver,F=N.random,M=N.mouseClickEvts,P={Program:{fields:{mainDefinition:{type:"node"}}},Identifier:{fields:{name:{type:"value"}}},UndefinedExpression:{fields:{streamId:{type:"uid"},identifier:{type:"node"}}},IntegerLiteral:{fields:{streamId:{type:"uid"},identifier:{type:"node"},value:{type:"value"}}},ArrayLiteral:{fields:{streamId:{type:"uid"},identifier:{type:"node"},items:{type:"nodes"}}},StreamReference:{fields:{streamId:{type:"uid"},identifier:{type:"node"},targetStreamId:{type:"uid"}}},Application:{fields:{streamId:{type:"uid"},identifier:{type:"node"},functionId:{type:"uid"},arguments:{type:"nodes"},functionArguments:{type:"nodes"}}},Parameter:{fields:{streamId:{type:"uid"},identifier:{type:"node"}}},NativeFunction:{fields:{functionId:{type:"uid"},identifier:{type:"node"},signature:{type:"value"},jsFunction:{type:"value"}}},UserFunction:{fields:{functionId:{type:"uid"},identifier:{type:"node"},signature:{type:"value"},parameters:{type:"nodes"},functionParameterFunctionIds:{type:"value"},expressions:{type:"nodes"}}}},V={Expression:["UndefinedExpression","IntegerLiteral","ArrayLiteral","StreamReference","Application","Parameter"],Any:["Program","Identifier","UndefinedExpression","IntegerLiteral","ArrayLiteral","StreamReference","Application","NativeFunction","UserFunction"]};function q(e,t){var n=e,r=!0,a=!1,i=void 0;try{for(var o,u=t[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){n=n[o.value]}}catch(c){a=!0,i=c}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}return n}function H(e,t,n){var r=t,a=0,i=!0,o=!1,u=void 0;try{for(var c,s=n[Symbol.iterator]();!(i=(c=s.next()).done);i=!0){var l=c.value;if(e===r)return[n.slice(0,a),n.slice(a)];r=r[l],a++}}catch(f){o=!0,u=f}finally{try{i||null==s.return||s.return()}finally{if(o)throw u}}if(e===r)return[n.slice(0,a),n.slice(a)];throw new Error("node was not in path")}function G(e,t,n){switch(e.identifier&&t.push([e.identifier.name,e]),e.type){case"Application":var r=!0,a=!1,i=void 0;try{for(var o,u=e.arguments[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){G(o.value,t,n)}}catch(b){a=!0,i=b}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}var c=!0,s=!1,l=void 0;try{for(var f,d=e.functionArguments[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var m=f.value;m.identifier&&n.push([m.identifier.name,m])}}catch(b){s=!0,l=b}finally{try{c||null==d.return||d.return()}finally{if(s)throw l}}break;case"ArrayLiteral":var p=!0,v=!1,h=void 0;try{for(var y,E=e.items[Symbol.iterator]();!(p=(y=E.next()).done);p=!0){G(y.value,t,n)}}catch(b){v=!0,h=b}finally{try{p||null==E.return||E.return()}finally{if(v)throw h}}break;case"StreamReference":case"IntegerLiteral":case"UndefinedExpression":break;default:throw new Error}}function B(e,t,n){var r=!0,a=!1,i=void 0;try{for(var o,u=e.parameters[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var c=o.value;c.identifier&&t.push([c.identifier.name,c])}}catch(p){a=!0,i=p}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}var s=!0,l=!1,f=void 0;try{for(var d,m=e.expressions[Symbol.iterator]();!(s=(d=m.next()).done);s=!0){G(d.value,t,n)}}catch(p){l=!0,f=p}finally{try{s||null==m.return||m.return()}finally{if(l)throw f}}}function W(e){var t=[],n=[],r=!0,a=!1,i=void 0;try{for(var o,u=e.nativeFunctions[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var c=o.value;c.identifier&&n.push([c.identifier.name,c])}}catch(s){a=!0,i=s}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}return function(e,t,n,r){var a=e,i=!0,o=!1,u=void 0;try{for(var c,l=t[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var f=c.value;"UserFunction"===a.type&&B(a,n,r),a=a[f]}}catch(s){o=!0,u=s}finally{try{i||null==l.return||l.return()}finally{if(o)throw u}}}(e.program,e.selectionPath,t,n),{namedStreams:t,namedFunctions:n}}var K=function(e,t){return JSON.stringify(e)===JSON.stringify(t)};var z=[["UserFunction",["MOVE_UP","MOVE_DOWN"],function(e){var t=e.node,n=e.subpath,r=e.action;if(!v(t))throw new Error;if(2===n.length&&"expressions"===n[0])return[t,["expressions",function(){var e=n[1];if("number"!==typeof e)throw new Error;var a=e+("MOVE_UP"===r.type?-1:1);return a=Math.max(a,0),a=Math.min(a,t.expressions.length-1)}()],!1]}],["UserFunction",["DELETE"],function(e){var t=e.node,n=e.subpath;if(!v(t))throw new Error;if(2===n.length&&"expressions"===n[0]){var r=n[1];if("number"!==typeof r)throw new Error;return function(e,t){if("number"!==typeof t)throw new Error;var n=Object(l.a)({},e,{expressions:[].concat(Object(u.a)(e.expressions.slice(0,t)),Object(u.a)(e.expressions.slice(t+1)))});if(n.expressions.length){var r=t-1;return r=Math.max(r,0),[n,["expressions",r=Math.min(r,e.expressions.length-1)],!1]}return n.expressions.push({type:"UndefinedExpression",streamId:E(),identifier:null}),[n,["expressions",0],!0]}(t,r)}}],["UserFunction",["ZOOM_IN","MOVE_RIGHT"],function(e){var t=e.node,n=e.subpath;if(!v(t))throw new Error;if(0===n.length)return[t,["expressions",0],!1]}],["Expression",["TOGGLE_EDIT"],function(e){var t=e.node,n=e.subpath;if(e.editingSelected)return[t,n,!1];switch(t.type){case"IntegerLiteral":case"UndefinedExpression":case"StreamReference":case"Application":return[t,n,!0];case"ArrayLiteral":break;default:throw new Error}}],["Expression",["END_EXPRESSION_IDENTIFIER_EDIT"],function(e){var t=e.node,n=e.subpath;if(!p(t))throw new Error;if(!K(n,["identifier"]))throw new Error;if(!t.identifier)throw new Error;var r=t.identifier.name.trim();return[Object(l.a)({},t,{identifier:r?{type:"Identifier",name:r}:null}),[],!1]}],["Expression",["BEGIN_OVERWRITE_EDIT"],function(e){var t=e.node,n=e.subpath;if(!p(t))throw new Error;return[{type:"UndefinedExpression",streamId:t.streamId,identifier:t.identifier},n,!0]}],["Any",["UPDATE_NODE"],function(e){var t=e.subpath,n=e.action,r=e.editingSelected;if(!n.newNode)throw new Error;if(console.log("UPDATE_NODE newNode",n.newNode),0===t.length)return[n.newNode,t,r]}],["UserFunction",["EDIT_AFTER"],function(e){var t=e.node,n=e.subpath;if(!v(t))throw new Error;if(n.length>=2&&"expressions"===n[0]){var r=n[1];if("number"!==typeof r)throw new Error;return[Object(l.a)({},t,{expressions:[].concat(Object(u.a)(t.expressions.slice(0,r+1)),[{type:"UndefinedExpression",streamId:E(),identifier:null}],Object(u.a)(t.expressions.slice(r+1)))}),["expressions",r+1],!0]}}],["Expression",["BEGIN_EXPRESSION_IDENTIFIER_EDIT"],function(e){var t=e.node,n=e.subpath;if(!p(t))throw new Error;if(K(n,[]))return[Object(l.a)({},t,{identifier:t.identifier?t.identifier:{type:"Identifier",name:""}}),["identifier"],!0]}],["ArrayLiteral",["ZOOM_OUT","MOVE_LEFT"],function(e){var t=e.node,n=e.subpath;if(2===n.length){if("items"!==n[0]||"number"!==typeof n[1])throw Error();return[t,[],!1]}}],["ArrayLiteral",["ZOOM_IN","MOVE_RIGHT"],function(e){var t=e.node,n=e.subpath;if(!d(t))throw new Error;if(0===n.length)return 0===t.items.length?[Object(l.a)({},t,{items:[{type:"UndefinedExpression",streamId:E(),identifier:null}]}),["items",0],!0]:[t,["items",0],!1]}],["ArrayLiteral",["MOVE_UP","MOVE_DOWN"],function(e){var t=e.node,n=e.subpath,r=e.action;if(!d(t))throw new Error;if(2===n.length&&"items"===n[0]){var a=n[1];if("number"!==typeof a)throw new Error;var i=a+("MOVE_UP"===r.type?-1:1);return i<0||i>=t.items.length?[t,[],!1]:[t,["items",i],!1]}}],["ArrayLiteral",["EDIT_AFTER"],function(e){var t=e.node,n=e.subpath;if(!d(t))throw new Error;if(2===n.length&&"items"===n[0]){var r=n[1];if("number"!==typeof r)throw new Error;return[Object(l.a)({},t,{items:[].concat(Object(u.a)(t.items.slice(0,r+1)),[{type:"UndefinedExpression",streamId:E(),identifier:null}],Object(u.a)(t.items.slice(r+1)))}),["items",r+1],!0]}}],["ArrayLiteral",["DELETE"],function(e){var t=e.node,n=e.subpath;if(!d(t))throw new Error;if(2===n.length){if(0===t.items.length)throw new Error;var r=n[1];if("number"!==typeof r)throw new Error;var a=Object(l.a)({},t,{items:[].concat(Object(u.a)(t.items.slice(0,r)),Object(u.a)(t.items.slice(r+1)))});if(a.items.length>0){var i=r-1;return i=Math.max(i,0),[a,["items",i=Math.min(i,t.items.length-1)],!1]}return[a,[],!1]}}],["Expression",["CREATE_ARRAY"],function(e){var t=e.node,n=e.subpath;if(!p(t))throw new Error;if(0===n.length)return[{type:"ArrayLiteral",streamId:t.streamId,identifier:t.identifier,items:[{type:"UndefinedExpression",identifier:null,streamId:E()}]},["items",0],!0]}],["Application",["ZOOM_OUT","MOVE_LEFT"],function(e){var t=e.node,n=e.subpath;if(!m(t))throw new Error;if(2===n.length){if("arguments"===n[0]&&"number"===typeof n[1])return[t,[],!1];if("functionArguments"===n[0]&&"number"===typeof n[1])return[t,[],!1];throw new Error}if(n.length>=3&&"functionArguments"===n[0]&&"number"===typeof n[1])return[t,n.slice(0,2),!1]}],["Application",["ZOOM_IN","MOVE_RIGHT"],function(e){var t=e.node,n=e.subpath;if(!m(t))throw new Error;if(0===n.length){if(t.arguments.length>0)return[t,["arguments",0],!1];if(t.functionArguments.length>0)return[t,["functionArguments",0],!1]}}],["Application",["MOVE_UP","MOVE_DOWN"],function(e){var t=e.node,n=e.subpath,r=e.action;if(!m(t))throw new Error;if(2===n.length&&"arguments"===n[0]){var a=n[1];if("number"!==typeof a)throw new Error;var i=a+("MOVE_UP"===r.type?-1:1);return i>=t.arguments.length&&t.functionArguments.length?[t,["functionArguments",0],!1]:i<0||i>=t.arguments.length?[t,[],!1]:[t,["arguments",i],!1]}if(2===n.length&&"functionArguments"===n[0]){var o=n[1];if("number"!==typeof o)throw new Error;var u=o+("MOVE_UP"===r.type?-1:1);return u<0&&t.arguments.length?[t,["arguments",t.arguments.length-1],!1]:u<0||u>=t.arguments.length?[t,[],!1]:[t,["functionArguments",u],!1]}}],["Application",["DELETE"],function(e){var t=e.node,n=e.subpath;e.action;if(!m(t))throw new Error;if(2===n.length&&"arguments"===n[0]){var r=n[1];if("number"!==typeof r)throw new Error;var a=t.arguments.slice();return a[r]={type:"UndefinedExpression",streamId:t.arguments[r].streamId,identifier:t.arguments[r].identifier},[Object(l.a)({},t,{arguments:a}),["arguments",r],!1]}}]];function Z(e,t,n){if(!function(e,t,n){if(e===t)return!0;var r=t,a=!0,i=!1,o=void 0;try{for(var u,c=n[Symbol.iterator]();!(a=(u=c.next()).done);a=!0)if(e===(r=r[u.value]))return!0}catch(s){i=!0,o=s}finally{try{a||null==c.return||c.return()}finally{if(i)throw o}}return!1}(t,e.program,e.selectionPath))return null;var r=P[t.type];if(!r)throw new Error;for(var a={type:t.type},i=null,o=!1,u=!1,s=t,l=0,f=Object.entries(r.fields);l<f.length;l++){var d=f[l],m=Object(c.a)(d,2),p=m[0];switch(m[1].type){case"node":var v=s[p],y=Z(e,v,n);if(y){if(u)throw new Error("already handled");var E=Object(c.a)(y,3),b=E[0],g=E[1],w=E[2];a[p]=b,i=g,o=w,u=!0}else a[p]=v;break;case"nodes":var x=[],O=s[p],I=!0,S=!1,j=void 0;try{for(var k,A=O[Symbol.iterator]();!(I=(k=A.next()).done);I=!0){var C=k.value,N=Z(e,C,n);if(N){if(u)throw new Error("already handled");var _=Object(c.a)(N,3),T=_[0],D=_[1],R=_[2];x.push(T),i=D,o=R,u=!0}else x.push(C)}}catch(te){S=!0,j=te}finally{try{I||null==A.return||A.return()}finally{if(S)throw j}}a[p]=x;break;case"value":case"uid":a[p]=s[p];break;default:throw new Error}}if(u){if(!h(a))throw new Error;if(!i)throw new Error;return[a,i,o]}for(var U=0,L=z;U<L.length;U++){var F=L[U],M=Object(c.a)(F,3),q=M[0],G=M[1],B=M[2];if((V[q]?V[q]:[q]).includes(t.type)&&G.includes(n.type)){var W=H(t,e.program,e.selectionPath),K=Object(c.a)(W,2),J=K[0],X=B({node:t,subpath:K[1],editingSelected:e.editingSelected,action:n});if(X){var Y=Object(c.a)(X,3),$=Y[0],Q=Y[1],ee=Y[2];return[$,J.concat(Q),ee]}}}return null}function J(e){var t=new Map,n=new Map,r=!0,a=!1,i=void 0;try{for(var o,u=e.nativeFunctions[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var c=o.value;n.set(c.functionId,c)}}catch(s){a=!0,i=s}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}return function e(t,n,r){if(p(t)){if(n.has(t.streamId))throw new Error("stream ids must be unique");n.set(t.streamId,t)}switch(t.type){case"Program":e(t.mainDefinition,n,r);break;case"UserFunction":if(r.has(t.functionId))throw new Error("function ids must be unique");r.set(t.functionId,t);var a=!0,i=!1,o=void 0;try{for(var u,c=t.parameters[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var l=u.value;if(n.has(l.streamId))throw new Error("stream ids must be unique");n.set(l.streamId,l)}}catch(s){i=!0,o=s}finally{try{a||null==c.return||c.return()}finally{if(i)throw o}}var f=!0,d=!1,m=void 0;try{for(var v,h=t.expressions[Symbol.iterator]();!(f=(v=h.next()).done);f=!0)e(v.value,n,r)}catch(s){d=!0,m=s}finally{try{f||null==h.return||h.return()}finally{if(d)throw m}}break;case"Application":var y=!0,E=!1,b=void 0;try{for(var g,w=t.arguments[Symbol.iterator]();!(y=(g=w.next()).done);y=!0)e(g.value,n,r)}catch(s){E=!0,b=s}finally{try{y||null==w.return||w.return()}finally{if(E)throw b}}var x=!0,O=!1,I=void 0;try{for(var S,j=t.functionArguments[Symbol.iterator]();!(x=(S=j.next()).done);x=!0)e(S.value,n,r)}catch(s){O=!0,I=s}finally{try{x||null==j.return||j.return()}finally{if(O)throw I}}break;case"ArrayLiteral":var k=!0,A=!1,C=void 0;try{for(var N,_=t.items[Symbol.iterator]();!(k=(N=_.next()).done);k=!0)e(N.value,n,r)}catch(s){A=!0,C=s}finally{try{k||null==_.return||_.return()}finally{if(A)throw C}}break;case"IntegerLiteral":case"UndefinedExpression":case"StreamReference":break;default:throw new Error}}(e.program,t,n),Object(l.a)({},e,{derivedLookups:{streamIdToNode:t,functionIdToNode:n}})}function X(e,t){switch(e.type){case"Program":return Object(l.a)({},e,{mainDefinition:X(e.mainDefinition,t)});case"UserFunction":return Object(l.a)({},e,{expressions:e.expressions.map(function(e){return X(e,t)})});case"Application":return Object(l.a)({},e,{arguments:e.arguments.map(function(e){return X(e,t)}),functionArguments:e.functionArguments.map(function(e){return X(e,t)})});case"ArrayLiteral":return Object(l.a)({},e,{items:e.items.map(function(e){return X(e,t)})});case"IntegerLiteral":case"UndefinedExpression":return e;case"StreamReference":return t.has(e.targetStreamId)?e:{type:"UndefinedExpression",streamId:E(),identifier:e.identifier};default:throw new Error}}function Y(e,t){var n,r={parameterStreams:[],literalStreamValues:[],applications:[],containedDefinitions:[],yieldStream:null};try{r=j(t.program.mainDefinition,t)}catch(v){if(!(v instanceof I))throw v;console.log("COMPILATION ERROR",v.message)}if(e){var a=e.liveMain,i=a.context,o=a.updateCompiledDefinition;console.log("updating compiled definition to",r),Object(k.beginBatch)(),o(r),Object(k.endBatch)(),n={context:i,updateCompiledDefinition:o,compiledDefinition:r}}else{console.log("initializing compiled definition to",r);var s=function e(t,n,r){var a=new Set,i=t;return[function(){var t=Object(k.useRequestUpdate)(),o=Object(k.useVar)(function(){var a=new C(n),o=new C(r),u=!0,s=!1,l=void 0;try{for(var f,d=i.literalStreamValues[Symbol.iterator]();!(u=(f=d.next()).done);u=!0){var m=f.value,p=Object(c.a)(m,2),v=p[0],h=p[1];a.set(v,h)}}catch(G){s=!0,l=G}finally{try{u||null==d.return||d.return()}finally{if(s)throw l}}var y=new Map,E=!0,b=!1,g=void 0;try{for(var w,x=i.applications[Symbol.iterator]();!(E=(w=x.next()).done);E=!0){var O=w.value,I=Object(c.a)(O,2),S=I[0],j=I[1],A=o.get(j);if(!A)throw Error();y.set(S,new k.ExecutionContext(A,t))}}catch(G){b=!0,g=G}finally{try{E||null==x.return||x.return()}finally{if(b)throw g}}var N=new Map,_=!0,T=!1,D=void 0;try{for(var R,U=i.containedDefinitions[Symbol.iterator]();!(_=(R=U.next()).done);_=!0){var L=R.value,F=Object(c.a)(L,2),M=F[0],P=e(F[1],a,o),V=Object(c.a)(P,2),q=V[0],H=V[1];o.set(M,q),N.set(M,H)}}catch(G){T=!0,D=G}finally{try{_||null==U.return||U.return()}finally{if(T)throw D}}return{streamEnvironment:a,functionEnvironment:o,applicationContext:y,updateContainedDefinition:N,requestUpdate:t}});Object(k.useInitialize)(function(){return a.add(o.current),function(){o.current.applicationContext.forEach(function(e){e.terminate()}),a.delete(o.current)}});var s=o.current,l=s.streamEnvironment,f=s.functionEnvironment,d=s.applicationContext;if(arguments.length!==i.parameterStreams.length)throw new Error("wrong number of arguments to live function, got "+arguments.length+" expected "+i.parameterStreams.length);var m=0,p=!0,h=!1,y=void 0;try{for(var E,b=i.parameterStreams[Symbol.iterator]();!(p=(E=b.next()).done);p=!0){var g=E.value;l.set(g,arguments[m]),m++}}catch(L){h=!0,y=L}finally{try{p||null==b.return||b.return()}finally{if(h)throw y}}var w=!0,x=!1,O=void 0;try{for(var I,S=i.applications[Symbol.iterator]();!(w=(I=S.next()).done);w=!0){var j=I.value,A=Object(c.a)(j,4),N=A[0],_=A[2],T=A[3],D=[].concat(Object(u.a)(_.map(function(e){return l.get(e)})),Object(u.a)(T.map(function(e){return f.get(e)}))),R=d.get(N);if(!R)throw new Error;var U=void 0;try{U=R.update.apply(R,Object(u.a)(D))}catch(v){console.log("application error")}l.set(N,U)}}catch(L){x=!0,O=L}finally{try{w||null==S.return||S.return()}finally{if(x)throw O}}return i.yieldStream?l.get(i.yieldStream):void 0},function(t){if(JSON.stringify(t)!==JSON.stringify(i)){var n=new Map,r=new Map,o=!0,u=!1,s=void 0;try{for(var l,f=i.literalStreamValues[Symbol.iterator]();!(o=(l=f.next()).done);o=!0){var d=l.value,m=Object(c.a)(d,2),p=m[0],v=m[1];n.set(p,v)}}catch(Qe){u=!0,s=Qe}finally{try{o||null==f.return||f.return()}finally{if(u)throw s}}var h=!0,y=!1,E=void 0;try{for(var b,g=t.literalStreamValues[Symbol.iterator]();!(h=(b=g.next()).done);h=!0){var w=b.value,x=Object(c.a)(w,2),O=x[0],I=x[1];r.set(O,I)}}catch(Qe){y=!0,E=Qe}finally{try{h||null==g.return||g.return()}finally{if(y)throw E}}var S=!0,j=!1,A=void 0;try{for(var C,N=function(){var e=C.value,t=Object(c.a)(e,1)[0];r.has(t)||a.forEach(function(e){e.streamEnvironment.delete(t)})},_=i.literalStreamValues[Symbol.iterator]();!(S=(C=_.next()).done);S=!0)N()}catch(Qe){j=!0,A=Qe}finally{try{S||null==_.return||_.return()}finally{if(j)throw A}}var T=!0,D=!1,R=void 0;try{for(var U,L=function(){var e=U.value,t=(M=Object(c.a)(e,2))[0],r=M[1];n.has(t)&&n.get(t)===r||a.forEach(function(e){e.streamEnvironment.set(t,r)})},F=t.literalStreamValues[Symbol.iterator]();!(T=(U=F.next()).done);T=!0){var M;L()}}catch(Qe){D=!0,R=Qe}finally{try{T||null==F.return||F.return()}finally{if(D)throw R}}var P=new Map,V=new Map,q=!0,H=!1,G=void 0;try{for(var B,W=i.applications[Symbol.iterator]();!(q=(B=W.next()).done);q=!0){var K=B.value,z=Object(c.a)(K,3),Z=z[0],J=z[1],X=z[2];P.set(Z,[J,X])}}catch(Qe){H=!0,G=Qe}finally{try{q||null==W.return||W.return()}finally{if(H)throw G}}var Y=!0,$=!1,Q=void 0;try{for(var ee,te=t.applications[Symbol.iterator]();!(Y=(ee=te.next()).done);Y=!0){var ne=ee.value,re=Object(c.a)(ne,3),ae=re[0],ie=re[1],oe=re[2];V.set(ae,[ie,oe])}}catch(Qe){$=!0,Q=Qe}finally{try{Y||null==te.return||te.return()}finally{if($)throw Q}}var ue=!0,ce=!1,se=void 0;try{for(var le,fe=function(){var e=le.value,t=Object(c.a)(e,2)[0];V.has(t)||a.forEach(function(e){e.applicationContext.get(t).terminate()})},de=i.applications[Symbol.iterator]();!(ue=(le=de.next()).done);ue=!0)fe()}catch(Qe){ce=!0,se=Qe}finally{try{ue||null==de.return||de.return()}finally{if(ce)throw se}}var me=!0,pe=!1,ve=void 0;try{for(var he,ye=function(){var e=he.value,t=(be=Object(c.a)(e,3))[0],n=be[1],r=be[2],i=!1,o=P.get(t);if(o){var u=Object(c.a)(o,2),s=u[0],l=u[1];n===s&&function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(r,l)||(a.forEach(function(e){e.applicationContext.get(t).terminate()}),i=!0)}else i=!0;i&&a.forEach(function(e){var r=e.functionEnvironment.get(n);if(!r)throw Error();e.applicationContext.set(t,new k.ExecutionContext(r,e.requestUpdate))})},Ee=t.applications[Symbol.iterator]();!(me=(he=Ee.next()).done);me=!0){var be;ye()}}catch(Qe){pe=!0,ve=Qe}finally{try{me||null==Ee.return||Ee.return()}finally{if(pe)throw ve}}var ge=new Map,we=new Map,xe=!0,Oe=!1,Ie=void 0;try{for(var Se,je=i.containedDefinitions[Symbol.iterator]();!(xe=(Se=je.next()).done);xe=!0){var ke=Se.value,Ae=Object(c.a)(ke,2),Ce=Ae[0],Ne=Ae[1];ge.set(Ce,Ne)}}catch(Qe){Oe=!0,Ie=Qe}finally{try{xe||null==je.return||je.return()}finally{if(Oe)throw Ie}}var _e=!0,Te=!1,De=void 0;try{for(var Re,Ue=t.containedDefinitions[Symbol.iterator]();!(_e=(Re=Ue.next()).done);_e=!0){var Le=Re.value,Fe=Object(c.a)(Le,2),Me=Fe[0],Pe=Fe[1];we.set(Me,Pe)}}catch(Qe){Te=!0,De=Qe}finally{try{_e||null==Ue.return||Ue.return()}finally{if(Te)throw De}}var Ve=!0,qe=!1,He=void 0;try{for(var Ge,Be=function(){var e=Ge.value,t=Object(c.a)(e,1)[0];we.has(t)||a.forEach(function(e){e.functionEnvironment.delete(t),e.updateContainedDefinition.delete(t)})},We=i.containedDefinitions[Symbol.iterator]();!(Ve=(Ge=We.next()).done);Ve=!0)Be()}catch(Qe){qe=!0,He=Qe}finally{try{Ve||null==We.return||We.return()}finally{if(qe)throw He}}var Ke=!0,ze=!1,Ze=void 0;try{for(var Je,Xe=function(){var t=Je.value,n=($e=Object(c.a)(t,2))[0],r=$e[1];ge.has(n)?a.forEach(function(e){e.updateContainedDefinition.get(n)(r)}):a.forEach(function(t){var a=e(r,t.streamEnvironment,t.functionEnvironment),i=Object(c.a)(a,2),o=i[0],u=i[1];t.functionEnvironment.set(n,o),t.updateContainedDefinition.set(n,u)})},Ye=t.containedDefinitions[Symbol.iterator]();!(Ke=(Je=Ye.next()).done);Ke=!0){var $e;Xe()}}catch(Qe){ze=!0,Ze=Qe}finally{try{Ke||null==Ye.return||Ye.return()}finally{if(ze)throw Ze}}i=t,a.forEach(function(e){e.requestUpdate()})}}]}(r,new C,te),f=Object(c.a)(s,2),d=f[0],m=f[1],p=Object(k.createNullaryVoidRootExecutionContext)(d);p.update(),n={context:p,updateCompiledDefinition:m,compiledDefinition:r}}return Object(l.a)({},t,{liveMain:n})}function $(e,t){return Y(e,(n=J(t),Object(l.a)({},n,{program:X(n.program,n.derivedLookups.streamIdToNode)})));var n}function Q(e,t){console.log("action",t.type);var n=Z(e,e.program,t);if(n){console.log("handled");var r=Object(c.a)(n,3),a=r[0],i=r[1],o=r[2];if(!f(a))throw new Error;return $(e,{program:a,selectionPath:i,editingSelected:o,nativeFunctions:e.nativeFunctions,derivedLookups:void 0,liveMain:void 0})}return console.log("not handled"),e}var ee=[["add",["_a","_b"],[],function(e,t){return e+t}],["multiply",["_a","_b"],[],function(e,t){return e*t}],["show value",["_v"],[],_],["animation time",[],[],T],["is mouse down",[],[],D],["change count",["_stream"],[],R],["map",["_array"],[["_func",{parameters:["value"],functionParameters:[]}]],function(e,t){return U(t,e)}],["if",["_pred","then","else"],[],function(e,t,n){return e?t:n}],["audio driver",[],[["_func",{parameters:["audio time","next frame","sample rate"],functionParameters:[]}]],L],["cosine",["_v"],[],Math.cos],["random",["repick"],[],F],["mouse click",[],[],M]],te=new C;te.set("id",function(e){return e}),te.set("Array_of",Array.of),ee.forEach(function(e){var t=Object(c.a)(e,4),n=t[0],r=t[3];te.set(n,r)});var ne=E(),re=$(void 0,{program:{type:"Program",mainDefinition:{type:"UserFunction",functionId:E(),identifier:null,signature:{parameters:[],functionParameters:[]},parameters:[],functionParameterFunctionIds:[],expressions:[{type:"Application",streamId:ne,identifier:{type:"Identifier",name:"md"},functionId:"is mouse down",arguments:[],functionArguments:[]},{type:"Application",streamId:E(),identifier:null,functionId:"show value",arguments:[{type:"Application",streamId:E(),identifier:null,functionId:"if",arguments:[{type:"StreamReference",streamId:E(),identifier:null,targetStreamId:ne},{type:"IntegerLiteral",streamId:E(),identifier:null,value:10},{type:"IntegerLiteral",streamId:E(),identifier:null,value:20}],functionArguments:[]}],functionArguments:[]}]}},selectionPath:["mainDefinition","expressions",0],editingSelected:!1,nativeFunctions:ee.map(function(e){var t=Object(c.a)(e,3),n=t[0];return{type:"NativeFunction",functionId:n,identifier:{type:"Identifier",name:n},signature:{parameters:t[1],functionParameters:t[2]}}}),derivedLookups:void 0,liveMain:void 0});n(36);function ae(e,t){for(var n=0,r=0,a=e.length,i=0,o=t.length,u=!1,c=!1,s=!0,l=null,f=null,d=null,m=0,p=[];i!==o;){var v=r!==a?e.charAt(r):null,h=t.charAt(i),y=null!==v?v.toLowerCase():null,E=h.toLowerCase(),b=h.toUpperCase(),g=v&&y===E,w=l&&f===E;if((g&&l||l&&v&&f===y)&&(n+=m,p.push(d),l=null,f=null,d=null,m=0),g||w){var x=0;if(0===r)n+=Math.max(-3*i,-9);u&&(x+=5),s&&(x+=10),c&&h===b&&E!==b&&(x+=10),g&&++r,x>=m&&(null!==l&&(n+=-1),f=(l=h).toLowerCase(),d=i,m=x),u=!0}else n+=-1,u=!1;c=h===E&&E!==b,s="_"===h||" "===h,++i}l&&(n+=m,p.push(d));for(var O="",I=0,S=0;S<p.length;++S){var j=p[S];O+=t.substr(I,j-I)+"<b>"+t.charAt(j)+"</b>",I=j+1}return[r===a,n,O+=t.substr(I,t.length-I)]}function ie(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,u=t[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var s=o.value,l=Object(c.a)(s,2),f=l[0],d=l[1],m=ae(e,f),p=Object(c.a)(m,3),v=p[0],h=p[1],y=p[2];v&&n.push({score:h,formattedStr:y,name:f,data:d})}}catch(E){a=!0,i=E}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}return""!==e&&n.sort(function(e,t){return t.score-e.score}),n}var oe=/^[-+]?(?:\d*\.?\d+|\d+\.?\d*)(?:[eE][-+]?\d+)?$/;function ue(e,t){var n=[];""===e&&n.push({type:"undefined"});var r=W(t),a=r.namedStreams,i=r.namedFunctions,o=ie(e,a),u=!0,c=!1,s=void 0;try{for(var l,f=o[Symbol.iterator]();!(u=(l=f.next()).done);u=!0){var d=l.value;n.push({type:"streamref",node:d.data})}}catch(g){c=!0,s=g}finally{try{u||null==f.return||f.return()}finally{if(c)throw s}}var m=ie(e,i),p=!0,v=!1,h=void 0;try{for(var y,E=m[Symbol.iterator]();!(p=(y=E.next()).done);p=!0){var b=y.value;n.push({type:"function",node:b.data})}}catch(g){v=!0,h=g}finally{try{p||null==E.return||E.return()}finally{if(v)throw h}}return oe.test(e)&&n.push({type:"number",value:Number(e)}),0===n.length&&n.push({type:"undefined"}),n}function ce(e){var t=e.choice;switch(t.type){case"undefined":return a.a.createElement("em",null,"undefined");case"number":return a.a.createElement("span",null,t.value);case"streamref":return a.a.createElement("span",null,a.a.createElement("em",null,"S")," ",t.node.identifier.name," ",a.a.createElement("small",null,"(id ",t.node.streamId,")"));case"function":return a.a.createElement("span",null,a.a.createElement("em",null,"F")," ",t.node.identifier.name,"(",[].concat([t.node.signature.parameters.map(function(e){return e.startsWith("_")?"\u25a1":e}),t.node.signature.functionParameters.map(function(e){var t=Object(c.a)(e,1)[0];return"F "+(t.startsWith("_")?"\u25a1":t)})]).join(", "),")");default:throw new Error}}function se(e){var t=e.node,n=e.mainState,i=e.dispatch,o=Object(r.useRef)();Object(r.useEffect)(function(){o.current&&o.current.scrollIntoView({block:"nearest",inline:"nearest"})});var u=Object(r.useState)(function(){switch(t.type){case"UndefinedExpression":return"";case"IntegerLiteral":return t.value.toString();case"StreamReference":var e=n.derivedLookups.streamIdToNode.get(t.targetStreamId);return e.identifier?e.identifier.name:"";case"Application":var r=n.derivedLookups.functionIdToNode.get(t.functionId);return r.identifier?r.identifier.name:"";default:throw new Error}}),s=Object(c.a)(u,2),f=s[0],d=s[1],m=function(e){var n,r=e.choices[e.index];switch(r.type){case"undefined":n={type:"UndefinedExpression"};break;case"number":n={type:"IntegerLiteral",value:r.value};break;case"streamref":n={type:"StreamReference",targetStreamId:r.node.streamId};break;case"function":n={type:"Application",functionId:r.node.functionId,arguments:r.node.signature.parameters.map(function(e){return{type:"UndefinedExpression",streamId:E(),identifier:null}}),functionArguments:r.node.signature.functionParameters.map(function(e){var t=Object(c.a)(e,2)[1];return{type:"UserFunction",functionId:E(),identifier:null,signature:t,parameters:t.parameters.map(function(e){return{type:"Parameter",streamId:E(),identifier:{type:"Identifier",name:e}}}),functionParameterFunctionIds:t.functionParameters.map(function(e){var t=Object(c.a)(e,2);t[0],t[1];return E()}),expressions:[{type:"UndefinedExpression",streamId:E(),identifier:null}]}})};break;default:throw new Error}n.streamId=t.streamId,n.identifier=t.identifier,i({type:"UPDATE_NODE",newNode:n})},p=function(e){var t={choices:ue(e,n),index:0};return m(t),t},v=function(e){g(function(t){var n=Object(l.a)({},t,{index:(t.index+e+t.choices.length)%t.choices.length});return m(n),n})},h=Object(r.useState)(function(){return p(f)}),y=Object(c.a)(h,2),b=y[0],g=y[1];return a.a.createElement("div",null,a.a.createElement("input",{className:"Editor-text-edit-input",value:f,onChange:function(e){var t=e.target.value;"["===t?(i({type:"END_EXPRESSION_EDIT"}),i({type:"CREATE_ARRAY"})):(d(t),g(p(t)))},onKeyDown:function(e){switch(e.key){case"ArrowUp":e.preventDefault(),v(-1);break;case"ArrowDown":e.preventDefault(),v(1)}},autoFocus:!0}),a.a.createElement("ul",{className:"ExpressionChooser-dropdown"},b.choices.map(function(e,t){return a.a.createElement("li",{key:t,className:t===b.index?"ExpressionChooser-dropdown-selected":"",ref:t===b.index?o:void 0},a.a.createElement(ce,{choice:e}))})))}n(37);function le(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e?t+" SimpleTheme-selected":t}var fe=function(e){var t=e.expressionGrouping,n=e.applicationArguments;return{Program:function(e){var t=e.expressions;return a.a.createElement("div",{className:"SimpleTheme-program"},t)},Application:function(e){var t=e.functionName,r=e.streamArgs,i=e.functionArgs,o="right"===n||"right-centered"===n?"SimpleTheme-application-flex":"",u="SimpleTheme-application-function-name"+("right-centered"===n?" SimpleTheme-application-function-name-centered":"");return a.a.createElement("div",{className:o},a.a.createElement("div",{className:u},t),a.a.createElement("div",{className:"SimpleTheme-application-arguments"},r.map(function(e){var t=e.key,n=e.name,r=e.expression;return a.a.createElement("div",{className:"SimpleTheme-application-argument",key:t},n?a.a.createElement("span",{className:"SimpleTheme-application-argument-name"},n,":"):null,a.a.createElement("span",{className:"SimpleTheme-application-argument-expression"},r))}),i.map(function(e){var t=e.key,n=(e.name,e.functionExpression);return a.a.createElement("div",{className:"SimpleTheme-application-argument",key:t},n)})))},UserFunction:function(e){var t=e.parameterNames,n=e.expressions,r=e.selected;return a.a.createElement("div",{className:le(r,"SimpleTheme-user-function")},a.a.createElement("div",null,"F ",t.join(", ")),a.a.createElement("div",{className:"SimpleTheme-user-function-expressions"},n))},DefinitionExpression:function(e){var t=e.expression;return a.a.createElement("div",{className:"SimpleTheme-definition-expression"},t)},Expression:function(e){var n=e.identifier,r=e.selected,i=e.inside;return a.a.createElement("div",{className:le(r,"SimpleTheme-expression")},function(){switch(t){case"line":return a.a.createElement("div",{className:"SimpleTheme-expression-line"});case"bracket":return a.a.createElement("div",{className:"SimpleTheme-expression-bracket"});default:return null}}(),a.a.createElement("div",null,n?a.a.createElement("div",{className:"SimpleTheme-expression-identifier"},n):null,a.a.createElement("div",{className:"SimpleTheme-expression-main"},i)))},Identifier:function(e){var t=e.selected,n=e.inside;return a.a.createElement("span",{className:le(t,"SimpleTheme-identifier")},n)},StreamReference:function(e){var t=e.name;return a.a.createElement("div",null,a.a.createElement("span",{className:"SimpleTheme-stream-reference"},t))},UndefinedExpression:function(){return a.a.createElement("div",{className:"SimpleTheme-undefined-expression"},"\xa0")},ArrayLiteral:function(e){var t=e.keyedItems;return a.a.createElement("div",null,a.a.createElement("div",null,"["),a.a.createElement("div",{className:"SimpleTheme-array-items"},t.map(function(e){var t=Object(c.a)(e,2),n=t[0],r=t[1];return a.a.createElement("div",{className:"SimpleTheme-array-item",key:n},r)})),a.a.createElement("div",null,"]"))}}},de=(n(38),{expressionGrouping:"line",applicationArguments:"below"}),me=fe(de);function pe(e){var t=e.keyLabels,n=e.selectedKey,r=e.onChange;return a.a.createElement("select",{value:n,onChange:function(e){r(e.target.value)}},t.map(function(e){var t=Object(c.a)(e,2),n=t[0],r=t[1];return a.a.createElement("option",{key:n,value:n},r)}))}function ve(e){var t=e.onChange,n=Object(r.useState)(de),i=Object(c.a)(n,2),o=i[0],u=i[1],s=function(e){u(e),t(fe(e))};return a.a.createElement("div",{className:"ThemePicker"},a.a.createElement("div",{className:"ThemePicker-option"},a.a.createElement("label",null,"Expression Grouping: ",a.a.createElement(pe,{keyLabels:[["none","None"],["line","Line"],["bracket","Bracket"]],selectedKey:o.expressionGrouping,onChange:function(e){return s(Object(l.a)({},o,{expressionGrouping:e}))}}))),a.a.createElement("div",{className:"ThemePicker-option"},a.a.createElement("label",null,"Application Arguments: ",a.a.createElement(pe,{keyLabels:[["below","Below"],["right","Right"],["right-centered","Right (centered)"]],selectedKey:o.applicationArguments,onChange:function(e){return s(Object(l.a)({},o,{applicationArguments:e}))}}))))}n(39);var he={MOVE_UP:"up",MOVE_DOWN:"down",MOVE_LEFT:"left",MOVE_RIGHT:"right",ZOOM_IN:"shift+right",ZOOM_OUT:"shift+left",TOGGLE_EDIT:"enter",EDIT_AFTER:["shift+enter",","],DELETE:"backspace",BEGIN_EXPRESSION_IDENTIFIER_EDIT:"="},ye=new Set(["=",","]),Ee=["Enter","Shift","=",","],be=Object(r.createContext)(),ge=Object(r.createContext)();function we(e){return e===Object(r.useContext)(ge)}var xe=Object(r.createContext)(),Oe=Object(r.createContext)();function Ie(e){var t=e.program,n=Object(r.useContext)(Oe).Program;return a.a.createElement(n,{expressions:a.a.createElement(Se,{expressions:t.mainDefinition.expressions})})}function Se(e){var t=e.expressions,n=Object(r.useContext)(Oe).DefinitionExpression;return a.a.createElement(a.a.Fragment,null,t.map(function(e){return a.a.createElement("div",{key:e.streamId},a.a.createElement(n,{expression:a.a.createElement(Ue,{expression:e})}))}))}function je(e){var t=e.initialName,n=e.onUpdateName,i=e.onEndEdit,o=Object(r.useState)(t||""),u=Object(c.a)(o,2),s=u[0],l=u[1];return a.a.createElement("input",{className:"Editor-text-edit-input",value:s,onChange:function(e){var t=e.target.value;l(t),n&&n(t)},onKeyDown:function(e){switch(e.key){case"Enter":e.stopPropagation(),i&&i()}},autoFocus:!0})}function ke(e){var t=e.expression.identifier,n=we(t),i=Object(r.useContext)(xe).editingSelected,o=Object(r.useContext)(be),u=Object(r.useContext)(Oe).Identifier;return a.a.createElement(u,{selected:n,inside:n&&i?a.a.createElement(je,{initialName:t.name,onUpdateName:function(e){o({type:"UPDATE_NODE",newNode:{type:"Identifier",name:e}})},onEndEdit:function(){o({type:"END_EXPRESSION_IDENTIFIER_EDIT"})}}):t.name})}function Ae(e){var t=e.integerLiteral;return a.a.createElement("div",null,t.value)}function Ce(e){var t=e.arrayLiteral,n=Object(r.useContext)(Oe).ArrayLiteral;return a.a.createElement(n,{keyedItems:t.items.map(function(e){return[e.streamId,a.a.createElement(Ue,{expression:e})]})})}function Ne(e){e.undefinedExpression;var t=Object(r.useContext)(Oe).UndefinedExpression;return a.a.createElement(t,null)}function _e(e){var t=e.streamReference,n=Object(r.useContext)(xe).derivedLookups.streamIdToNode.get(t.targetStreamId);if(!n)throw new Error;var i=Object(r.useContext)(Oe).StreamReference;return a.a.createElement(i,{name:n.identifier&&n.identifier.name?n.identifier.name:"<stream "+t.targetStreamId+">"})}function Te(e){var t=e.userFunction,n=we(t),i=Object(r.useContext)(Oe).UserFunction;return a.a.createElement(i,{parameterNames:t.parameters.map(function(e){return e.identifier.name}),expressions:a.a.createElement(Se,{expressions:t.expressions}),selected:n})}function De(e){var t=e.application,n=Object(r.useContext)(xe).derivedLookups.functionIdToNode.get(t.functionId);if(!n)throw new Error;if(n.signature.parameters.length!==t.arguments.length)throw new Error("params and args length mismatch");if(n.signature.functionParameters.length!==t.functionArguments.length)throw new Error("function params and args length mismatch");var i=n.identifier&&n.identifier.name?n.identifier.name:"<function "+t.functionId+">",o=n.signature.parameters.map(function(e,n){return{key:e,name:e.startsWith("_")?void 0:e,expression:a.a.createElement(Ue,{expression:t.arguments[n]})}}),u=n.signature.functionParameters.map(function(e,n){var r=Object(c.a)(e,2),i=r[0];r[1];return{key:i,name:"dunno",functionExpression:a.a.createElement(Te,{userFunction:t.functionArguments[n]})}}),s=Object(r.useContext)(Oe).Application;return a.a.createElement(s,{functionName:i,streamArgs:o,functionArgs:u})}function Re(e){var t=e.expression;switch(t.type){case"IntegerLiteral":return a.a.createElement(Ae,{integerLiteral:t});case"ArrayLiteral":return a.a.createElement(Ce,{arrayLiteral:t});case"UndefinedExpression":return a.a.createElement(Ne,{undefinedExpression:t});case"StreamReference":return a.a.createElement(_e,{streamReference:t});case"Application":return a.a.createElement(De,{application:t});default:throw new Error}}function Ue(e){var t=e.expression,n=we(t),i=Object(r.useContext)(xe),o=i.editingSelected,u=Object(r.useContext)(be),c=Object(r.useContext)(Oe).Expression;return a.a.createElement(c,{identifier:t.identifier?a.a.createElement(ke,{expression:t}):null,selected:n,inside:n&&o?a.a.createElement(se,{node:t,mainState:i,dispatch:u}):a.a.createElement(Re,{expression:t})})}function Le(e){var t=e.autoFocus,n=Object(r.useReducer)(Q,re),i=Object(c.a)(n,2),o=i[0],l=i[1],f=Object(r.useState)(me),d=Object(c.a)(f,2),m=d[0],p=d[1],v=Object(r.useRef)(),h=Object(r.useState)(t),y=Object(c.a)(h,1)[0];Object(r.useEffect)(function(){y&&v.current.focus()},[y]);var E=Object(r.useRef)(!1);Object(r.useEffect)(function(){E.current&&!o.editingSelected&&v.current.focus(),E.current=o.editingSelected});for(var b={},g=function(){var e=x[w];b[e]=function(t){t.preventDefault(),l({type:e})}},w=0,x=Object.keys(he);w<x.length;w++)g();return a.a.createElement(s.HotKeys,{keyMap:he,handlers:b},a.a.createElement(s.ObserveKeys,{only:Ee},a.a.createElement("div",{className:"Editor",onKeyDown:function(e){"input"===e.target.tagName.toLowerCase()||1!==Object(u.a)(e.key).length||e.altkey||e.ctrlKey||e.metaKey||ye.has(e.key)||l({type:"BEGIN_OVERWRITE_EDIT"})},tabIndex:"0",ref:v},a.a.createElement("div",{className:"Editor-theme-controls"},a.a.createElement(ve,{onChange:function(e){p(e)}})),a.a.createElement(be.Provider,{value:l},a.a.createElement(ge.Provider,{value:q(o.program,o.selectionPath)},a.a.createElement(xe.Provider,{value:o},a.a.createElement(Oe.Provider,{value:m},a.a.createElement(Ie,{program:o.program}))))))))}var Fe=function(){return a.a.createElement("div",{className:"App"},a.a.createElement(Le,{autoFocus:!0}),a.a.createElement("div",null,a.a.createElement("h2",null,"Notes"),a.a.createElement("ul",null,a.a.createElement("li",null,"If you don't see a green selection/cursor box, focus the editor."),a.a.createElement("li",null,"There's no mouse/touch support yet, only keyboard."),a.a.createElement("li",null,"Up/down arrows move selection up and down within lists (expressions, arguments, arrays)."),a.a.createElement("li",null,"Right/left arrows move selection in and out of nested structures."),a.a.createElement("li",null,"Enter on an expression (or expression sub-tree) will begin editing it. Pressing enter again will stop editing."),a.a.createElement("li",null,"Instead of pressing enter, you can just start typing letters/numbers and it will begin the edit (overwriting what it there)."),a.a.createElement("li",null,"Shift-enter (or comma) adds a new expression (or array item) below the current one."),a.a.createElement("li",null,"Pressing the = key on on an expression will move to editing its name/label."),a.a.createElement("li",null,"A red box indicates an undefined expression."),a.a.createElement("li",null,"Delete will delete expressions, array items, etc."),a.a.createElement("li",null,"Typing [ when editing an expression will create an array literal."))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(Fe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[16,1,2]]]);
//# sourceMappingURL=main.a8becfff.chunk.js.map