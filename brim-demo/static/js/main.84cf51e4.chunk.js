(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=null,a=function(){function e(e,t,n){void 0===n&&(n=null),this.streamFunc=e,this.onRequestUpdate=t,this.afterTerminate=n,this.hookRecordChain={data:null,cleanup:null,next:null},this.recordCursor=null,this.openRecord=null,this.updateCount=0}return e.prototype.update=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n;r={executionContext:this,previousFrame:r},this.recordCursor=this.hookRecordChain;try{if(n=this.streamFunc.apply(null,arguments),this.recordCursor.next)throw new Error("Did not reach all hook records in update")}finally{var a=r;if(!a)throw new Error("Cannot pop update frame because current is null");if(a.executionContext!==this)throw new Error("Popped frame from update stack but context did not match");r=a.previousFrame}return this.updateCount++,n},e.prototype.terminate=function(){for(var e=this.hookRecordChain.next;e;e=e.next)e.cleanup&&e.cleanup();this.afterTerminate&&this.afterTerminate()},e.prototype._beginHook=function(){if(this.openRecord)throw new Error("This is already an open hook when beginning another");if(!this.recordCursor)throw new Error;if(0===this.updateCount){if(this.recordCursor.next)throw new Error("Expecting to create new hook record in chain, but already present");this.recordCursor.next={data:null,cleanup:null,next:null}}if(!this.recordCursor.next)throw new Error("Expecting to find hook record in chain, but not present");return this.openRecord=this.recordCursor.next,this.recordCursor.next},e.prototype._endHook=function(){if(!this.recordCursor)throw new Error;if(this.openRecord!==this.recordCursor.next)throw new Error("Hook close does not match open");this.openRecord=null,this.recordCursor=this.recordCursor.next},e.prototype._requestUpdate=function(){this.onRequestUpdate()},e.prototype._setStreamFunc=function(e){this.streamFunc=e},e}();t.ExecutionContext=a;var i=null;function o(e){i?i.callbacks.add(e):e()}function u(){if(!r)throw new Error("Cannot get currently updating execution context because update stack is empty. Was a hook called outside of an execution context update?");return r.executionContext}function c(e){var t=u(),n=t._beginHook();if(!n.data){var r=e instanceof Function?e():e;n.data={current:r}}return t._endHook(),n.data}function s(){var e=u(),t=e._beginHook();return t.data||(t.data={requestUpdate:function(){e._requestUpdate()}}),e._endHook(),t.data.requestUpdate}function l(e){var t,n=u(),r=n._beginHook();if(!r.data){var a=[],i={queue:a,lastStream:null,unsubscribe:null,onValue:function(e){a.push(e)}};r.data=i,r.cleanup=function(){i.unsubscribe&&i.unsubscribe()}}var o=r.data;if(e!==o.lastStream){if(o.queue.length)throw new Error("useEventReceiver stream changed, but value is in queue");if(o.lastStream){if(!o.unsubscribe)throw new Error("should not be possible");o.unsubscribe(),o.lastStream=null,o.unsubscribe=null}o.lastStream=e,e&&(o.unsubscribe=e.subscribe(o.onValue))}else if(o.queue.length){if(o.queue.length>1)throw new Error("useEventReceiver found more than one enqueued value");t={value:o.queue.pop()}}return n._endHook(),t}t.beginBatch=function(){if(i)throw new Error("cannot begin batch when one is already active");i={callbacks:new Set}},t.endBatch=function(){if(!i)throw new Error("cannot end batch when none is active");i.callbacks.forEach(function(e){e()}),i=null},t.enqueueBatchedUpdate=o,t.createNullaryVoidRootExecutionContext=function(e){var t=new a(e,function(){o(function(){t.update()})});return t},t.useVar=c,t.useRequestUpdate=s,t.useInitialize=function(e){var t=u(),n=t._beginHook();n.data||(n.cleanup=e()||null,n.data={}),t._endHook()},t.useEventEmitter=function(){var e=u(),t=e._beginHook();if(!t.data){var n=new Set,r={subscribe:function(e){return n.add(e),function(){n.delete(e)}}};t.data={stream:r,emit:function(e){n.forEach(function(t){t(e)})}}}return e._endHook(),[t.data.stream,t.data.emit]},t.useEventReceiver=l,t.useDynamic=function(e,t){var n=u(),r=n._beginHook();if(!r.data){var i=t||function(){n._requestUpdate()},o={activeContexts:new Set,createContext:function(){var e=new a(o.streamFunc,i,function(){o.activeContexts.delete(e)});return o.activeContexts.add(e),e},streamFunc:function(){throw new Error("should be unreachable")}};r.data=o,r.cleanup=function(){o.activeContexts.forEach(function(e){return e.terminate()})}}return r.data.streamFunc=e,r.data.activeContexts.forEach(function(t){t._setStreamFunc(e)}),n._endHook(),r.data.createContext},t.useReducer=function(e,t,n){var r=c(n),a=l(e);return a&&(r.current=t(r.current,a.value)),r.current},t.useReducers=function(e,t){var n=c(t),r=c(e.length);if(e.length!==r.current)throw new Error("The number of streams/reducers supplied to useMultiReducer cannot change");for(var a=0,i=0,o=e;i<o.length;i++){var u=o[i],s=u[0],f=u[1],d=l(s);if(d){if(a>0)throw new Error("useMultiReducer got multiple events, cannot merge");n.current=f(n.current,d.value),a++}}return n.current},t.useCallbackReducer=function(e,t){var n=s(),r=c(t),a=c(function(){return function(t){r.current=e(r.current,t),n()}});return[r.current,a.current]},t.useCallbackReducers=function(e,t){var n=s(),r=c(t),a=e.map(function(e){return function(t){r.current=e(r.current,t),n()}});return[r.current,a]},t.useMachine=function(e,t){var n,r=u(),i=r._beginHook(),o=function(t){i.data.activeContext&&i.data.activeContext.terminate();var n=t[0],o=t[1],u=new a(e[n],function(){r._requestUpdate()});i.data.activeState=n,i.data.activeContext=u,i.data.activeArgument=o};if(!i.data){var c={activeContext:null};i.data=c,o(t),i.cleanup=function(){if(!c.activeContext)throw new Error("should have been initialized");c.activeContext.terminate()}}for(;;){i.data.activeContext._setStreamFunc(e[i.data.activeState]);var s=i.data.activeContext.update(i.data.activeArgument),l=s[0],f=s[1];if(n=l,!f)break;o(f)}return r._endHook(),n}},,,,,,,,,,,,function(e,t,n){e.exports=n(40)},,,,,,function(e,t,n){},function(e,t,n){},,,,function(e,t,n){"use strict";n.r(t),n.d(t,"showString",function(){return h}),n.d(t,"animationFrameEvts",function(){return E}),n.d(t,"animationTime",function(){return g}),n.d(t,"countEvents",function(){return b}),n.d(t,"mouseClickEvts",function(){return x}),n.d(t,"mouseDown",function(){return O}),n.d(t,"mousePosition",function(){return I}),n.d(t,"random",function(){return S}),n.d(t,"audioDriver",function(){return j}),n.d(t,"sampleUpon",function(){return N}),n.d(t,"everySecond",function(){return T}),n.d(t,"loadAudioAsArray",function(){return C}),n.d(t,"integral",function(){return k}),n.d(t,"expFollow",function(){return A}),n.d(t,"redCircle",function(){return _}),n.d(t,"followAtSpeed2d",function(){return D}),n.d(t,"eventAfter",function(){return R}),n.d(t,"received",function(){return P}),n.d(t,"streamMap",function(){return U}),n.d(t,"changeCount",function(){return M});n(5);var r=n(1),a=n(4),i=a.useVar,o=a.useRequestUpdate,u=a.useInitialize,c=a.useEventEmitter,s=a.useEventReceiver,l=a.useDynamic,f=a.useReducer,d=a.useReducers,m=n(28),p=m.renderDOMAppendedToBody,v=m.h;function h(e){var t=v("div",{style:{border:"1px solid red",color:"black",fontSize:"24px",padding:"5px",marginTop:"20px"}},"showString: "+(void 0===e?"(undefined)":e.toString()));p(t)}function E(){var e=o(),t=i(),n=c(),a=Object(r.a)(n,2),s=a[0],l=a[1];return u(function(){return t.current=requestAnimationFrame(function n(r){l(.001*r),e(),t.current=requestAnimationFrame(n)}),function(){cancelAnimationFrame(t.current)}}),s}function y(e,t){return f(e,function(e,t){return t},t)}function g(){return y(E(),function(){return.001*performance.now()})}function b(e){return f(e,function(e){return e+1},0)}function w(e,t,n){var a=o(),i=c(),s=Object(r.a)(i,2),l=s[0],f=s[1];return u(function(){var e=function(e){f(e),a()};return document.addEventListener(t,e,n),function(){document.removeEventListener(t,e,n)}}),l}function x(){return w(document,"mousedown")}function O(){var e=w(document,"mousedown"),t=w(document,"mouseup");return d([[t,function(){return!1}],[e,function(){return!0}]],!1)}function I(){return y(function(e){var t=s(e),n=c(),a=Object(r.a)(n,2),i=a[0],o=a[1];return t&&o(t.value),i}(w(document,"mousemove")),{x:0,y:0})}function S(e){return f(e,function(){return Math.random()},function(){return Math.random()})}function j(e){var t=l(e),n=i(),a=i(0),o=i(),s=c(),f=Object(r.a)(s,2),d=f[0],m=f[1];u(function(){n.current=t();var e=new(window.AudioContext||window.webkitAudioContext),r=e.createScriptProcessor(1024,0,1);return r.onaudioprocess=function(e){for(var t=e.outputBuffer.getChannelData(0),r=0;r<t.length;r++){m();var i=n.current.update(a.current/o.current,d,o.current);!i||Number.isNaN(i)?i=0:i>1?i=1:i<-1&&(i=-1),t[r]=i,a.current++}},r.connect(e.destination),o.current=e.sampleRate,function(){r.disconnect(),e.close()}}),n.current.update(a.current/o.current,d,o.current)}function N(e,t,n){return f(t,function(){return e},n)}function T(){var e=o(),t=c(),n=Object(r.a)(t,2),a=n[0],i=n[1];return u(function(){var t=setInterval(function(){i(),e()},1e3);return function(){clearInterval(t)}}),a}function C(e){var t=o(),n=i([0]);return u(function(){var r=new(window.AudioContext||window.webkitAudioContext),a=!1,i=new XMLHttpRequest;return i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){var e=i.response;r.decodeAudioData(e,function(e){a||(n.current=e.getChannelData(0),t())})},i.send(),function(){i.abort(),a=!0}}),n.current}function k(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=i(n),a=i(t),o=e(r.current,a.current);return r.current+=(t-a.current)*o,a.current=t,r.current}function A(e,t,n,r){return k(function(n){return t*(e-n)},n,r)}function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,n=e||{x:0,y:0};t<0&&(t=0);var r=.5*t,a=v("div",{style:{position:"absolute",borderRadius:"50%",background:"red",pointerEvents:"none",userSelect:"none",left:n.x-r+"px",top:n.y-r+"px",width:t+"px",height:t+"px"}});p(a)}function D(e,t,n,r){var a=i(r),o=i(n),u=n-o.current,c=e.x-a.current.x,s=e.y-a.current.y,l=Math.sqrt(c*c+s*s);return a.current=t*u>=l?e:{x:a.current.x+u*t*c/l,y:a.current.y+u*t*s/l},o.current=n,a.current}function R(e,t){var n=c(),a=Object(r.a)(n,2),o=a[0],s=a[1],l=i(t);return l.current=t,u(function(){var t=setTimeout(function(){s(l.current)},1e3*e);return function(){clearTimeout(t)}}),o}function P(e){return f(e,function(e,t){return!0},!1)}function U(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=l(e),r=i([]);t.length>r.current.length;)r.current.push(n());for(;t.length<r.current.length;){r.current.pop().terminate()}return r.current.map(function(e,n){return e.update(t[n])})}function M(e){var t,n,r=i(0),a=i(e);return t=e,n=a.current,Number.isNaN(t)&&Number.isNaN(n)||t===n||r.current++,a.current=e,r.current}},function(e,t,n){"use strict";n.r(t),n.d(t,"h",function(){return i}),n.d(t,"renderDOMIntoElement",function(){return u}),n.d(t,"renderDOMIntoSelector",function(){return c}),n.d(t,"renderDOMAppendedToBody",function(){return s});var r=n(4),a=n(41).init([n(29).default,n(30).default,n(31).default,n(32).default]),i=n(33).default;function o(e){return{sel:e.sel,data:e.data,children:e.children&&e.children.map(o),text:e.text,key:e.key,elm:e.elm}}function u(e,t){var n=Object(r.useVar)(t),i=Object(r.useVar)(),u=o(e);if(Object(r.useInitialize)(function(){return function(){n.current.innerHTML=""}}),i.current)a(i.current,u);else{var c=document.createElement("div");n.current.appendChild(c),a(c,u)}i.current=u}function c(e,t){u(e,Object(r.useVar)(function(){return document.querySelector(t)}).current)}function s(e){var t=Object(r.useVar)();Object(r.useInitialize)(function(){var e=document.createElement("div");return document.body.appendChild(e),t.current=e,function(){document.body.removeChild(e)}}),u(e,t.current)}},,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(11),o=n.n(i),u=(n(22),n(23),n(5)),c=n(1),s=n(9),l=n(2);function f(e){return"Identifier"===e.type}function d(e){return"ArrayLiteral"===e.type}function m(e){return"Application"===e.type}function p(e){return"Parameter"===e.type}function v(e){return function(e){return"UndefinedExpression"===e.type}(e)||function(e){return"IntegerLiteral"===e.type}(e)||d(e)||function(e){return"StreamReference"===e.type}(e)||m(e)||p(e)}function h(e){return"UserFunction"===e.type}function E(e){return function(e){return"NativeFunction"===e.type}(e)||h(e)}var y=function(){return Math.random().toString(16).substring(2,10)},g=function(){return y()+y()},b=n(7),w=n(14),x=n(8),O=n(12),I=n(15),S=function(e){function t(){return Object(b.a)(this,t),Object(w.a)(this,Object(x.a)(t).apply(this,arguments))}return Object(O.a)(t,e),t}(Object(I.a)(Error));function j(e,t,n,r,a){if(!r.has(e.streamId)){if(n.has(e.streamId))throw new S("graph cycle");switch(e.type){case"Parameter":break;case"UndefinedExpression":a.literalStreamValues.push([e.streamId,void 0]);break;case"IntegerLiteral":a.literalStreamValues.push([e.streamId,e.value]);break;case"ArrayLiteral":n.add(e.streamId);var i=!0,o=!1,u=void 0;try{for(var c,s=e.items[Symbol.iterator]();!(i=(c=s.next()).done);i=!0){j(c.value,t,n,r,a)}}catch(O){o=!0,u=O}finally{try{i||null==s.return||s.return()}finally{if(o)throw u}}n.delete(e.streamId),a.applications.push([e.streamId,"Array_of",e.items.map(function(e){return e.streamId}),[]]);break;case"StreamReference":var l=t.derivedLookups.streamIdToNode.get(e.targetStreamId);if(!l)throw Error();n.add(e.streamId),j(l,t,n,r,a),n.delete(e.streamId),a.applications.push([e.streamId,"id",[e.targetStreamId],[]]);break;case"Application":var f=t.derivedLookups.functionIdToNode.get(e.functionId);if(!f)throw Error();n.add(e.streamId);var d=!0,m=!1,p=void 0;try{for(var v,h=e.arguments[Symbol.iterator]();!(d=(v=h.next()).done);d=!0){j(v.value,t,n,r,a)}}catch(O){m=!0,p=O}finally{try{d||null==h.return||h.return()}finally{if(m)throw p}}n.delete(e.streamId);var E=!0,y=!1,g=void 0;try{for(var b,w=e.functionArguments[Symbol.iterator]();!(E=(b=w.next()).done);E=!0){var x=b.value;a.containedDefinitions.push([x.functionId,N(x,t)])}}catch(O){y=!0,g=O}finally{try{E||null==w.return||w.return()}finally{if(y)throw g}}a.applications.push([e.streamId,f.functionId,e.arguments.map(function(e){return e.streamId}),e.functionArguments.map(function(e){return e.functionId})]);break;default:throw new Error}r.add(e.streamId)}}function N(e,t){var n=new Set,r=new Set,a={parameterStreams:e.parameters.map(function(e){return e.streamId}),literalStreamValues:[],applications:[],containedDefinitions:[],yieldStream:null},i=!0,o=!1,u=void 0;try{for(var c,s=e.expressions[Symbol.iterator]();!(i=(c=s.next()).done);i=!0){var l=c.value;j(l,t,n,r,a),a.yieldStream=l.streamId}}catch(f){o=!0,u=f}finally{try{i||null==s.return||s.return()}finally{if(o)throw u}}return a}var T=n(4),C=n(13);var k=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;Object(b.a)(this,e),this.obj=void 0,this.obj=Object.create(t?t.obj:null)}return Object(C.a)(e,[{key:"get",value:function(e){return this.obj[e]}},{key:"set",value:function(e,t){this.obj[e]=t}},{key:"delete",value:function(e){delete this.obj[e]}}]),e}();var A=n(27),_=A.showString,D=A.animationTime,R=A.mouseDown,P=A.changeCount,U=A.streamMap,M=A.audioDriver,L=A.random,F=A.mouseClickEvts,V={Expression:["UndefinedExpression","IntegerLiteral","ArrayLiteral","StreamReference","Application","Parameter"],Any:["Program","Identifier","UndefinedExpression","IntegerLiteral","ArrayLiteral","StreamReference","Application","NativeFunction","UserFunction"]};function q(e,t){var n=e,r=!0,a=!1,i=void 0;try{for(var o,u=t[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){n=n[o.value]}}catch(c){a=!0,i=c}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}return n}function H(e,t,n){var r=t,a=0,i=!0,o=!1,u=void 0;try{for(var c,s=n[Symbol.iterator]();!(i=(c=s.next()).done);i=!0){var l=c.value;if(e===r)return[n.slice(0,a),n.slice(a)];r=r[l],a++}}catch(f){o=!0,u=f}finally{try{i||null==s.return||s.return()}finally{if(o)throw u}}if(e===r)return[n.slice(0,a),n.slice(a)];throw new Error("node was not in path")}function G(e,t){if(e.length>t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function B(e,t,n){var r=function e(t,n,r,a){if(r.alongPath&&!G(n,r.alongPath))return[!1,t];var i=!1,o=t;if((v(o)||E(o))&&o.identifier){var u=e(o.identifier,n.concat(["identifier"]),r,a),s=Object(c.a)(u,2),f=s[0],d=s[1];f&&(i=!0),d!==o.identifier&&(o=Object(l.a)({},o,{identifier:d}))}switch(o.type){case"Program":var m=e(o.mainDefinition,n.concat(["mainDefinition"]),r,a),p=Object(c.a)(m,2),h=p[0],y=p[1];h&&(i=!0),y!==o.mainDefinition&&(o=Object(l.a)({},o,{mainDefinition:y}));break;case"UserFunction":var g=[],b=[],w=!1;o.parameters.forEach(function(t,o){if(i)g.push(t);else{var u=e(t,n.concat(["parameters",o]),r,a),s=Object(c.a)(u,2),l=s[0],f=s[1];l&&(i=!0),g.push(f),f!==t&&(w=!0)}}),o.expressions.forEach(function(t,o){if(i)b.push(t);else{var u=e(t,n.concat(["expressions",o]),r,a),s=Object(c.a)(u,2),l=s[0],f=s[1];l&&(i=!0),b.push(f),f!==t&&(w=!0)}}),w&&(o=Object(l.a)({},o,{parameters:g,expressions:b}));break;case"Application":var x=[],O=[],I=!1;o.arguments.forEach(function(t,o){if(i)x.push(t);else{var u=e(t,n.concat(["arguments",o]),r,a),s=Object(c.a)(u,2),l=s[0],f=s[1];l&&(i=!0),x.push(f),f!==t&&(I=!0)}}),o.functionArguments.forEach(function(t,o){if(i||r.onlyLocal)O.push(t);else{var u=e(t,n.concat(["functionArguments",o]),r,a),s=Object(c.a)(u,2),l=s[0],f=s[1];l&&(i=!0),O.push(f),f!==t&&(I=!0)}}),I&&(o=Object(l.a)({},o,{arguments:x,functionArguments:O}));break;case"ArrayLiteral":var S=[],j=!1;o.items.forEach(function(t,o){if(i)S.push(t);else{var u=e(t,n.concat(["items",o]),r,a),s=Object(c.a)(u,2),l=s[0],f=s[1];l&&(i=!0),S.push(f),f!==t&&(j=!0)}}),j&&(o=Object(l.a)({},o,{items:S}));break;case"Identifier":case"IntegerLiteral":case"StreamReference":case"UndefinedExpression":case"Parameter":break;default:throw new Error}return i?[i,o]:a(o,n)}(e,[],t,n);return Object(c.a)(r,2)[1]}function W(e,t,n){B(e,{onlyLocal:!0},function(e,r){return v(e)&&e.identifier&&t.push([e.identifier.name,e]),h(e)&&e.identifier&&n.push([e.identifier.name,e]),[!1,e]})}function K(e){var t=[],n=[],r=!0,a=!1,i=void 0;try{for(var o,u=e.nativeFunctions[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var c=o.value;c.identifier&&n.push([c.identifier.name,c])}}catch(s){a=!0,i=s}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}return function(e,t,n,r){var a=e,i=!0,o=!1,u=void 0;try{for(var c,l=t[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var f=c.value;"UserFunction"===a.type&&W(a,n,r),a=a[f]}}catch(s){o=!0,u=s}finally{try{i||null==l.return||l.return()}finally{if(o)throw u}}}(e.program,e.selectionPath,t,n),{namedStreams:t,namedFunctions:n}}var z=function(e,t){return JSON.stringify(e)===JSON.stringify(t)};function Z(e,t){var n=e.node,r=e.subpath,a=e.editingSelected;if(!a)throw new Error;if(!f(n)){if(0!==r.length){if(!v(n)||!z(r,["identifier"]))throw new Error;if(!n.identifier)throw new Error;var i,o=(i=t?n.identifier.name.trim():a.originalNode.name)?{type:"Identifier",name:i}:null;return[Object(l.a)({},n,{identifier:o}),[],null]}var u=t?a.tentativeNode:a.originalNode,s=r,d=null;if(t){var m=J(u);if(m){var p=Object(c.a)(m,2),h=p[0],E=p[1];h!==u&&(s=E,d={originalNode:h,tentativeNode:h})}}return[u,s,d]}}function J(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=!1;return B(e,{},function(e,a){return n&&G(n,a)&&(r=!0),"UndefinedExpression"!==e.type||!r&&n?[!1,e]:(t=[e,a],[!0,e])}),t}var X=[["UserFunction",["MOVE_UP","MOVE_DOWN"],function(e){var t=e.node,n=e.subpath,r=e.action;if(!h(t))throw new Error;if(2===n.length&&"expressions"===n[0])return[t,["expressions",function(){var e=n[1];if("number"!==typeof e)throw new Error;var a=e+("MOVE_UP"===r.type?-1:1);return a=Math.max(a,0),a=Math.min(a,t.expressions.length-1)}()],null]}],["UserFunction",["DELETE"],function(e){var t=e.node,n=e.subpath;if(!h(t))throw new Error;if(2===n.length&&"expressions"===n[0]){var r=n[1];if("number"!==typeof r)throw new Error;return function(e,t){if("number"!==typeof t)throw new Error;var n=Object(l.a)({},e,{expressions:[].concat(Object(u.a)(e.expressions.slice(0,t)),Object(u.a)(e.expressions.slice(t+1)))});if(n.expressions.length){var r=t-1;return r=Math.max(r,0),[n,["expressions",r=Math.min(r,e.expressions.length-1)],null]}var a={type:"UndefinedExpression",streamId:g(),identifier:null};return n.expressions.push(a),[n,["expressions",0],{originalNode:a,tentativeNode:a}]}(t,r)}}],["UserFunction",["ZOOM_IN","MOVE_RIGHT"],function(e){var t=e.node,n=e.subpath;if(!h(t))throw new Error;if(0===n.length)return[t,["expressions",0],null]}],["Any",["TOGGLE_EDIT"],function(e){var t=e.node,n=e.subpath;if(e.editingSelected)return Z(e,!0);if(0!==n.length)throw new Error;switch(t.type){case"IntegerLiteral":case"UndefinedExpression":case"StreamReference":case"Application":return[t,n,{originalNode:t,tentativeNode:t}];case"ArrayLiteral":break;default:throw new Error}}],["Any",["ABORT_EDIT"],function(e){if(e.editingSelected)return Z(e,!1)}],["Any",["CONFIRM_EDIT"],function(e){if(e.editingSelected)return Z(e,!0)}],["Expression",["BEGIN_IDENTIFIER_EDIT"],function(e){var t=e.node,n=e.subpath;if(!v(t))throw new Error;if(z(n,[])){var r=t.identifier||{type:"Identifier",name:""};return[Object(l.a)({},t,{identifier:r}),["identifier"],{originalNode:r,tentativeNode:r}]}}],["Expression",["BEGIN_OVERWRITE_EDIT"],function(e){var t=e.node,n=e.subpath;if(!v(t))throw new Error;return[t,n,{originalNode:t,tentativeNode:{type:"UndefinedExpression",streamId:t.streamId,identifier:t.identifier}}]}],["Any",["UPDATE_EDITING_TENTATIVE_NODE"],function(e){var t=e.node,n=e.subpath,r=e.action,a=e.editingSelected;if(!r.newNode)throw new Error;if(!a)throw new Error;if(0===n.length){var i;if(f(t))i=r.newNode;else{if(!v(t))throw new Error;i=t}return[i,n,Object(l.a)({},a,{tentativeNode:r.newNode})]}}],["UserFunction",["EDIT_AFTER"],function(e){var t=e.node,n=e.subpath;if(!h(t))throw new Error;if(n.length>=2&&"expressions"===n[0]){var r=n[1];if("number"!==typeof r)throw new Error;var a={type:"UndefinedExpression",streamId:g(),identifier:null};return[Object(l.a)({},t,{expressions:[].concat(Object(u.a)(t.expressions.slice(0,r+1)),[a],Object(u.a)(t.expressions.slice(r+1)))}),["expressions",r+1],{originalNode:a,tentativeNode:a}]}}],["ArrayLiteral",["ZOOM_OUT","MOVE_LEFT"],function(e){var t=e.node,n=e.subpath;if(2===n.length){if("items"!==n[0]||"number"!==typeof n[1])throw Error();return[t,[],null]}}],["ArrayLiteral",["ZOOM_IN","MOVE_RIGHT"],function(e){var t=e.node,n=e.subpath;if(!d(t))throw new Error;if(0===n.length){if(0===t.items.length){var r={type:"UndefinedExpression",streamId:g(),identifier:null};return[Object(l.a)({},t,{items:[r]}),["items",0],{originalNode:r,tentativeNode:r}]}return[t,["items",0],null]}}],["ArrayLiteral",["MOVE_UP","MOVE_DOWN"],function(e){var t=e.node,n=e.subpath,r=e.action;if(!d(t))throw new Error;if(2===n.length&&"items"===n[0]){var a=n[1];if("number"!==typeof a)throw new Error;var i=a+("MOVE_UP"===r.type?-1:1);return i<0||i>=t.items.length?[t,[],null]:[t,["items",i],null]}}],["ArrayLiteral",["EDIT_AFTER"],function(e){var t=e.node,n=e.subpath;if(!d(t))throw new Error;if(2===n.length&&"items"===n[0]){var r=n[1];if("number"!==typeof r)throw new Error;var a={type:"UndefinedExpression",streamId:g(),identifier:null};return[Object(l.a)({},t,{items:[].concat(Object(u.a)(t.items.slice(0,r+1)),[a],Object(u.a)(t.items.slice(r+1)))}),["items",r+1],{originalNode:a,tentativeNode:a}]}}],["ArrayLiteral",["DELETE"],function(e){var t=e.node,n=e.subpath;if(!d(t))throw new Error;if(2===n.length){if(0===t.items.length)throw new Error;var r=n[1];if("number"!==typeof r)throw new Error;var a=Object(l.a)({},t,{items:[].concat(Object(u.a)(t.items.slice(0,r)),Object(u.a)(t.items.slice(r+1)))});if(a.items.length>0){var i=r-1;return i=Math.max(i,0),[a,["items",i=Math.min(i,t.items.length-1)],null]}return[a,[],null]}}],["Expression",["CREATE_ARRAY"],function(e){var t=e.node,n=e.subpath;if(!v(t))throw new Error;if(0===n.length){var r={type:"UndefinedExpression",streamId:g(),identifier:null};return[{type:"ArrayLiteral",streamId:t.streamId,identifier:t.identifier,items:[r]},["items",0],{originalNode:r,tentativeNode:r}]}}],["Application",["ZOOM_OUT","MOVE_LEFT"],function(e){var t=e.node,n=e.subpath;if(!m(t))throw new Error;if(2===n.length){if("arguments"===n[0]&&"number"===typeof n[1])return[t,[],null];if("functionArguments"===n[0]&&"number"===typeof n[1])return[t,[],null];throw new Error}if(n.length>=3&&"functionArguments"===n[0]&&"number"===typeof n[1])return[t,n.slice(0,2),null]}],["Application",["ZOOM_IN","MOVE_RIGHT"],function(e){var t=e.node,n=e.subpath;if(!m(t))throw new Error;if(0===n.length){if(t.arguments.length>0)return[t,["arguments",0],null];if(t.functionArguments.length>0)return[t,["functionArguments",0],null]}}],["Application",["MOVE_UP","MOVE_DOWN"],function(e){var t=e.node,n=e.subpath,r=e.action;if(!m(t))throw new Error;if(2===n.length&&"arguments"===n[0]){var a=n[1];if("number"!==typeof a)throw new Error;var i=a+("MOVE_UP"===r.type?-1:1);return i>=t.arguments.length&&t.functionArguments.length?[t,["functionArguments",0],null]:i<0||i>=t.arguments.length?[t,[],null]:[t,["arguments",i],null]}if(2===n.length&&"functionArguments"===n[0]){var o=n[1];if("number"!==typeof o)throw new Error;var u=o+("MOVE_UP"===r.type?-1:1);return u<0&&t.arguments.length?[t,["arguments",t.arguments.length-1],null]:u<0||u>=t.arguments.length?[t,[],null]:[t,["functionArguments",u],null]}}],["Application",["DELETE"],function(e){var t=e.node,n=e.subpath;e.action;if(!m(t))throw new Error;if(2===n.length&&"arguments"===n[0]){var r=n[1];if("number"!==typeof r)throw new Error;var a=t.arguments.slice();return a[r]={type:"UndefinedExpression",streamId:t.arguments[r].streamId,identifier:t.arguments[r].identifier},[Object(l.a)({},t,{arguments:a}),["arguments",r],null]}}]];function Y(e,t,n,r){var a=!1,i=t,o=n,u=B(e,{alongPath:t},function(u,s){for(var l=0,f=X;l<f.length;l++){var d=f[l],m=Object(c.a)(d,3),p=m[0],v=m[1],h=m[2];if((V[p]?V[p]:[p]).includes(u.type)&&v.includes(r.type)){var E=H(u,e,t),y=Object(c.a)(E,2),g=y[0],b=h({node:u,subpath:y[1],editingSelected:n,action:r});if(b){a=!0;var w=Object(c.a)(b,3),x=w[0],O=w[1],I=w[2];return i=g.concat(O),o=I,[!0,x]}}}return[!1,u]});if("Program"!==u.type)throw new Error;if(!a&&(u!==e||i!==t||o!==n))throw new Error;return[u,i,o]}function $(e){var t=new Map,n=new Map,r=!0,a=!1,i=void 0;try{for(var o,u=e.nativeFunctions[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var c=o.value;n.set(c.functionId,c)}}catch(s){a=!0,i=s}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}return B(e.program,{},function(e){if(v(e)||p(e)){if(t.has(e.streamId))throw new Error("stream ids must be unique");t.set(e.streamId,e)}if(h(e)){if(n.has(e.functionId))throw new Error("funciton ids must be unique");n.set(e.functionId,e)}return[!1,e]}),Object(l.a)({},e,{derivedLookups:{streamIdToNode:t,functionIdToNode:n,nodeToPath:null}})}function Q(e,t){var n,r={parameterStreams:[],literalStreamValues:[],applications:[],containedDefinitions:[],yieldStream:null};try{r=N(t.program.mainDefinition,t)}catch(v){if(!(v instanceof S))throw v;console.log("COMPILATION ERROR",v.message)}if(e){var a=e.liveMain,i=a.context,o=a.updateCompiledDefinition;Object(T.beginBatch)(),o(r),Object(T.endBatch)(),n={context:i,updateCompiledDefinition:o,compiledDefinition:r}}else{var s=function e(t,n,r){var a=new Set,i=t;return[function(){var t=Object(T.useRequestUpdate)(),o=Object(T.useVar)(function(){var a=new k(n),o=new k(r),u=!0,s=!1,l=void 0;try{for(var f,d=i.literalStreamValues[Symbol.iterator]();!(u=(f=d.next()).done);u=!0){var m=f.value,p=Object(c.a)(m,2),v=p[0],h=p[1];a.set(v,h)}}catch(G){s=!0,l=G}finally{try{u||null==d.return||d.return()}finally{if(s)throw l}}var E=new Map,y=!0,g=!1,b=void 0;try{for(var w,x=i.applications[Symbol.iterator]();!(y=(w=x.next()).done);y=!0){var O=w.value,I=Object(c.a)(O,2),S=I[0],j=I[1],N=o.get(j);if(!N)throw Error();E.set(S,new T.ExecutionContext(N,t))}}catch(G){g=!0,b=G}finally{try{y||null==x.return||x.return()}finally{if(g)throw b}}var C=new Map,A=!0,_=!1,D=void 0;try{for(var R,P=i.containedDefinitions[Symbol.iterator]();!(A=(R=P.next()).done);A=!0){var U=R.value,M=Object(c.a)(U,2),L=M[0],F=e(M[1],a,o),V=Object(c.a)(F,2),q=V[0],H=V[1];o.set(L,q),C.set(L,H)}}catch(G){_=!0,D=G}finally{try{A||null==P.return||P.return()}finally{if(_)throw D}}return{streamEnvironment:a,functionEnvironment:o,applicationContext:E,updateContainedDefinition:C,requestUpdate:t}});Object(T.useInitialize)(function(){return a.add(o.current),function(){o.current.applicationContext.forEach(function(e){e.terminate()}),a.delete(o.current)}});var s=o.current,l=s.streamEnvironment,f=s.functionEnvironment,d=s.applicationContext;if(arguments.length!==i.parameterStreams.length)throw new Error("wrong number of arguments to live function, got "+arguments.length+" expected "+i.parameterStreams.length);var m=0,p=!0,h=!1,E=void 0;try{for(var y,g=i.parameterStreams[Symbol.iterator]();!(p=(y=g.next()).done);p=!0){var b=y.value;l.set(b,arguments[m]),m++}}catch(U){h=!0,E=U}finally{try{p||null==g.return||g.return()}finally{if(h)throw E}}var w=!0,x=!1,O=void 0;try{for(var I,S=i.applications[Symbol.iterator]();!(w=(I=S.next()).done);w=!0){var j=I.value,N=Object(c.a)(j,4),C=N[0],A=N[2],_=N[3],D=[].concat(Object(u.a)(A.map(function(e){return l.get(e)})),Object(u.a)(_.map(function(e){return f.get(e)}))),R=d.get(C);if(!R)throw new Error;var P=void 0;try{P=R.update.apply(R,Object(u.a)(D))}catch(v){console.log("application error")}l.set(C,P)}}catch(U){x=!0,O=U}finally{try{w||null==S.return||S.return()}finally{if(x)throw O}}return i.yieldStream?l.get(i.yieldStream):void 0},function(t){if(JSON.stringify(t)!==JSON.stringify(i)){var n=new Map,r=new Map,o=!0,u=!1,s=void 0;try{for(var l,f=i.literalStreamValues[Symbol.iterator]();!(o=(l=f.next()).done);o=!0){var d=l.value,m=Object(c.a)(d,2),p=m[0],v=m[1];n.set(p,v)}}catch(Qe){u=!0,s=Qe}finally{try{o||null==f.return||f.return()}finally{if(u)throw s}}var h=!0,E=!1,y=void 0;try{for(var g,b=t.literalStreamValues[Symbol.iterator]();!(h=(g=b.next()).done);h=!0){var w=g.value,x=Object(c.a)(w,2),O=x[0],I=x[1];r.set(O,I)}}catch(Qe){E=!0,y=Qe}finally{try{h||null==b.return||b.return()}finally{if(E)throw y}}var S=!0,j=!1,N=void 0;try{for(var C,k=function(){var e=C.value,t=Object(c.a)(e,1)[0];r.has(t)||a.forEach(function(e){e.streamEnvironment.delete(t)})},A=i.literalStreamValues[Symbol.iterator]();!(S=(C=A.next()).done);S=!0)k()}catch(Qe){j=!0,N=Qe}finally{try{S||null==A.return||A.return()}finally{if(j)throw N}}var _=!0,D=!1,R=void 0;try{for(var P,U=function(){var e=P.value,t=(L=Object(c.a)(e,2))[0],r=L[1];n.has(t)&&n.get(t)===r||a.forEach(function(e){e.streamEnvironment.set(t,r)})},M=t.literalStreamValues[Symbol.iterator]();!(_=(P=M.next()).done);_=!0){var L;U()}}catch(Qe){D=!0,R=Qe}finally{try{_||null==M.return||M.return()}finally{if(D)throw R}}var F=new Map,V=new Map,q=!0,H=!1,G=void 0;try{for(var B,W=i.applications[Symbol.iterator]();!(q=(B=W.next()).done);q=!0){var K=B.value,z=Object(c.a)(K,3),Z=z[0],J=z[1],X=z[2];F.set(Z,[J,X])}}catch(Qe){H=!0,G=Qe}finally{try{q||null==W.return||W.return()}finally{if(H)throw G}}var Y=!0,$=!1,Q=void 0;try{for(var ee,te=t.applications[Symbol.iterator]();!(Y=(ee=te.next()).done);Y=!0){var ne=ee.value,re=Object(c.a)(ne,3),ae=re[0],ie=re[1],oe=re[2];V.set(ae,[ie,oe])}}catch(Qe){$=!0,Q=Qe}finally{try{Y||null==te.return||te.return()}finally{if($)throw Q}}var ue=!0,ce=!1,se=void 0;try{for(var le,fe=function(){var e=le.value,t=Object(c.a)(e,2)[0];V.has(t)||a.forEach(function(e){e.applicationContext.get(t).terminate()})},de=i.applications[Symbol.iterator]();!(ue=(le=de.next()).done);ue=!0)fe()}catch(Qe){ce=!0,se=Qe}finally{try{ue||null==de.return||de.return()}finally{if(ce)throw se}}var me=!0,pe=!1,ve=void 0;try{for(var he,Ee=function(){var e=he.value,t=(ge=Object(c.a)(e,3))[0],n=ge[1],r=ge[2],i=!1,o=F.get(t);if(o){var u=Object(c.a)(o,2),s=u[0],l=u[1];n===s&&function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(r,l)||(a.forEach(function(e){e.applicationContext.get(t).terminate()}),i=!0)}else i=!0;i&&a.forEach(function(e){var r=e.functionEnvironment.get(n);if(!r)throw Error();e.applicationContext.set(t,new T.ExecutionContext(r,e.requestUpdate))})},ye=t.applications[Symbol.iterator]();!(me=(he=ye.next()).done);me=!0){var ge;Ee()}}catch(Qe){pe=!0,ve=Qe}finally{try{me||null==ye.return||ye.return()}finally{if(pe)throw ve}}var be=new Map,we=new Map,xe=!0,Oe=!1,Ie=void 0;try{for(var Se,je=i.containedDefinitions[Symbol.iterator]();!(xe=(Se=je.next()).done);xe=!0){var Ne=Se.value,Te=Object(c.a)(Ne,2),Ce=Te[0],ke=Te[1];be.set(Ce,ke)}}catch(Qe){Oe=!0,Ie=Qe}finally{try{xe||null==je.return||je.return()}finally{if(Oe)throw Ie}}var Ae=!0,_e=!1,De=void 0;try{for(var Re,Pe=t.containedDefinitions[Symbol.iterator]();!(Ae=(Re=Pe.next()).done);Ae=!0){var Ue=Re.value,Me=Object(c.a)(Ue,2),Le=Me[0],Fe=Me[1];we.set(Le,Fe)}}catch(Qe){_e=!0,De=Qe}finally{try{Ae||null==Pe.return||Pe.return()}finally{if(_e)throw De}}var Ve=!0,qe=!1,He=void 0;try{for(var Ge,Be=function(){var e=Ge.value,t=Object(c.a)(e,1)[0];we.has(t)||a.forEach(function(e){e.functionEnvironment.delete(t),e.updateContainedDefinition.delete(t)})},We=i.containedDefinitions[Symbol.iterator]();!(Ve=(Ge=We.next()).done);Ve=!0)Be()}catch(Qe){qe=!0,He=Qe}finally{try{Ve||null==We.return||We.return()}finally{if(qe)throw He}}var Ke=!0,ze=!1,Ze=void 0;try{for(var Je,Xe=function(){var t=Je.value,n=($e=Object(c.a)(t,2))[0],r=$e[1];be.has(n)?a.forEach(function(e){e.updateContainedDefinition.get(n)(r)}):a.forEach(function(t){var a=e(r,t.streamEnvironment,t.functionEnvironment),i=Object(c.a)(a,2),o=i[0],u=i[1];t.functionEnvironment.set(n,o),t.updateContainedDefinition.set(n,u)})},Ye=t.containedDefinitions[Symbol.iterator]();!(Ke=(Je=Ye.next()).done);Ke=!0){var $e;Xe()}}catch(Qe){ze=!0,Ze=Qe}finally{try{Ke||null==Ye.return||Ye.return()}finally{if(ze)throw Ze}}i=t,a.forEach(function(e){e.requestUpdate()})}}]}(r,new k,re),f=Object(c.a)(s,2),d=f[0],m=f[1],p=Object(T.createNullaryVoidRootExecutionContext)(d);p.update(),n={context:p,updateCompiledDefinition:m,compiledDefinition:r}}return Object(l.a)({},t,{liveMain:n})}function ee(e,t){var n=function(e){var t=B(e.program,{},function(t){return"StreamReference"===t.type?[!1,e.derivedLookups.streamIdToNode.has(t.targetStreamId)?t:{type:"UndefinedExpression",streamId:g(),identifier:t.identifier}]:[!1,t]});return t===e.program?e:Object(l.a)({},e,{program:t})}($(t));return Q(e,function(e){var t=new Map;return B(e.program,{},function(e,n){return t.set(e,n),[!1,e]}),Object(l.a)({},e,{derivedLookups:Object(l.a)({},e.derivedLookups,{nodeToPath:t})})}($(n)))}function te(e,t){var n=e.program,r=e.selectionPath,a=e.editingSelected;if(["EDIT_NEXT_UNDEFINED","EDIT_AFTER","BEGIN_IDENTIFIER_EDIT"].includes(t.type)){var i=Y(n,r,a,{type:"CONFIRM_EDIT"}),o=Object(c.a)(i,3);n=o[0],r=o[1],a=o[2]}if("SET_PATH"===t.type){var u=q(n,r=t.newPath);a="Identifier"===u.type?{originalNode:u,tentativeNode:u}:null}else if("EDIT_NEXT_UNDEFINED"===t.type){var s=J(n,r);if(s){var l=Object(c.a)(s,2),f=l[0];r=l[1],a={originalNode:f,tentativeNode:f}}else a=null}else{var d=Y(n,r,a,t),m=Object(c.a)(d,3);n=m[0],r=m[1],a=m[2]}return n!==e.program||r!==e.selectionPath||a!==e.editingSelected?(n!==e.program&&console.log("program changed identity"),ee(e,{program:n,selectionPath:r,editingSelected:a,nativeFunctions:e.nativeFunctions,derivedLookups:{streamIdToNode:null,functionIdToNode:null,nodeToPath:null},liveMain:null})):e}var ne=[["add",["_a","_b"],[],function(e,t){return e+t}],["multiply",["_a","_b"],[],function(e,t){return e*t}],["show value",["_v"],[],_],["animation time",[],[],D],["is mouse down",[],[],R],["change count",["_stream"],[],P],["map",["_array"],[["_func",{parameters:["value"],functionParameters:[]}]],function(e,t){return U(t,e)}],["if",["cond","then","else"],[],function(e,t,n){return e?t:n}],["audio driver",[],[["_func",{parameters:["audio time","next frame","sample rate"],functionParameters:[]}]],M],["cosine",["_v"],[],Math.cos],["random",["repick"],[],L],["mouse click",[],[],F]],re=new k;re.set("id",function(e){return e}),re.set("Array_of",Array.of),ne.forEach(function(e){var t=Object(c.a)(e,4),n=t[0],r=t[3];re.set(n,r)});var ae=g(),ie=ee(void 0,{program:{type:"Program",mainDefinition:{type:"UserFunction",functionId:g(),identifier:null,signature:{parameters:[],functionParameters:[]},parameters:[],functionParameterFunctionIds:[],expressions:[{type:"Application",streamId:ae,identifier:{type:"Identifier",name:"md"},functionId:"is mouse down",arguments:[],functionArguments:[]},{type:"Application",streamId:g(),identifier:null,functionId:"show value",arguments:[{type:"Application",streamId:g(),identifier:null,functionId:"if",arguments:[{type:"StreamReference",streamId:g(),identifier:null,targetStreamId:ae},{type:"IntegerLiteral",streamId:g(),identifier:null,value:10},{type:"IntegerLiteral",streamId:g(),identifier:null,value:20}],functionArguments:[]}],functionArguments:[]}]}},selectionPath:["mainDefinition","expressions",0],editingSelected:null,nativeFunctions:ne.map(function(e){var t=Object(c.a)(e,3),n=t[0];return{type:"NativeFunction",functionId:n,identifier:{type:"Identifier",name:n},signature:{parameters:t[1],functionParameters:t[2]}}}),derivedLookups:{streamIdToNode:null,functionIdToNode:null,nodeToPath:null},liveMain:null});n(36);function oe(e,t){for(var n=0,r=0,a=e.length,i=0,o=t.length,u=!1,c=!1,s=!0,l=null,f=null,d=null,m=0,p=[];i!==o;){var v=r!==a?e.charAt(r):null,h=t.charAt(i),E=null!==v?v.toLowerCase():null,y=h.toLowerCase(),g=h.toUpperCase(),b=v&&E===y,w=l&&f===y;if((b&&l||l&&v&&f===E)&&(n+=m,p.push(d),l=null,f=null,d=null,m=0),b||w){var x=0;if(0===r)n+=Math.max(-3*i,-9);u&&(x+=5),s&&(x+=10),c&&h===g&&y!==g&&(x+=10),b&&++r,x>=m&&(null!==l&&(n+=-1),f=(l=h).toLowerCase(),d=i,m=x),u=!0}else n+=-1,u=!1;c=h===y&&y!==g,s="_"===h||" "===h,++i}l&&(n+=m,p.push(d));for(var O="",I=0,S=0;S<p.length;++S){var j=p[S];O+=t.substr(I,j-I)+"<b>"+t.charAt(j)+"</b>",I=j+1}return[r===a,n,O+=t.substr(I,t.length-I)]}function ue(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,u=t[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var s=o.value,l=Object(c.a)(s,2),f=l[0],d=l[1],m=oe(e,f),p=Object(c.a)(m,3),v=p[0],h=p[1],E=p[2];v&&n.push({score:h,formattedStr:E,name:f,data:d})}}catch(y){a=!0,i=y}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}return""!==e&&n.sort(function(e,t){return t.score-e.score}),n}var ce=/^[-+]?(?:\d*\.?\d+|\d+\.?\d*)(?:[eE][-+]?\d+)?$/;function se(e,t){var n=[];""===e&&n.push({type:"undefined"});var r=K(t),a=r.namedStreams,i=r.namedFunctions,o=ue(e,a),u=!0,c=!1,s=void 0;try{for(var l,f=o[Symbol.iterator]();!(u=(l=f.next()).done);u=!0){var d=l.value;n.push({type:"streamref",node:d.data})}}catch(b){c=!0,s=b}finally{try{u||null==f.return||f.return()}finally{if(c)throw s}}var m=ue(e,i),p=!0,v=!1,h=void 0;try{for(var E,y=m[Symbol.iterator]();!(p=(E=y.next()).done);p=!0){var g=E.value;n.push({type:"function",node:g.data})}}catch(b){v=!0,h=b}finally{try{p||null==y.return||y.return()}finally{if(v)throw h}}return ce.test(e)&&n.push({type:"number",value:Number(e)}),0===n.length&&n.push({type:"undefined"}),n}function le(e){var t=e.choice;switch(t.type){case"undefined":return a.a.createElement("em",null,"undefined");case"number":return a.a.createElement("span",null,t.value);case"streamref":return a.a.createElement("span",null,a.a.createElement("em",null,"S")," ",t.node.identifier.name," ",a.a.createElement("small",null,"(id ",t.node.streamId,")"));case"function":return a.a.createElement("span",null,a.a.createElement("em",null,"F")," ",t.node.identifier.name,"(",[].concat([t.node.signature.parameters.map(function(e){return e.startsWith("_")?"\u25a1":e}),t.node.signature.functionParameters.map(function(e){var t=Object(c.a)(e,1)[0];return"F "+(t.startsWith("_")?"\u25a1":t)})]).join(", "),")");default:throw new Error}}function fe(e){e.node;var t=e.mainState,n=e.dispatch,i=Object(r.useRef)();Object(r.useEffect)(function(){i.current&&i.current.scrollIntoView({block:"nearest",inline:"nearest"})});var o=Object(r.useState)(function(){var e=t.editingSelected.tentativeNode;switch(e.type){case"UndefinedExpression":return"";case"IntegerLiteral":return e.value.toString();case"StreamReference":case"Application":return"";default:throw new Error}}),u=Object(c.a)(o,2),s=u[0],f=u[1],d=function(e){var r,a=e.choices[e.index];switch(a.type){case"undefined":r={type:"UndefinedExpression"};break;case"number":r={type:"IntegerLiteral",value:a.value};break;case"streamref":r={type:"StreamReference",targetStreamId:a.node.streamId};break;case"function":r={type:"Application",functionId:a.node.functionId,arguments:a.node.signature.parameters.map(function(e){return{type:"UndefinedExpression",streamId:g(),identifier:null}}),functionArguments:a.node.signature.functionParameters.map(function(e){var t=Object(c.a)(e,2)[1];return{type:"UserFunction",functionId:g(),identifier:null,signature:t,parameters:t.parameters.map(function(e){return{type:"Parameter",streamId:g(),identifier:{type:"Identifier",name:e}}}),functionParameterFunctionIds:t.functionParameters.map(function(e){var t=Object(c.a)(e,2);t[0],t[1];return g()}),expressions:[{type:"UndefinedExpression",streamId:g(),identifier:null}]}})};break;default:throw new Error}r.streamId=t.editingSelected.tentativeNode.streamId,r.identifier=t.editingSelected.tentativeNode.identifier,n({type:"UPDATE_EDITING_TENTATIVE_NODE",newNode:r})},m=function(e){var n={choices:se(e,t),index:0};return d(n),n},p=function(e){y(function(t){var n=Object(l.a)({},t,{index:(t.index+e+t.choices.length)%t.choices.length});return d(n),n})},v=Object(r.useState)(function(){return m(s)}),h=Object(c.a)(v,2),E=h[0],y=h[1];return a.a.createElement("div",null,a.a.createElement("input",{className:"Editor-text-edit-input",value:s,onChange:function(e){var t=e.target.value;"["===t?(n({type:"END_EXPRESSION_EDIT"}),n({type:"CREATE_ARRAY"})):(f(t),y(m(t)))},onKeyDown:function(e){switch(e.key){case"ArrowUp":e.preventDefault(),p(-1);break;case"ArrowDown":e.preventDefault(),p(1)}},autoFocus:!0}),a.a.createElement("ul",{className:"ExpressionChooser-dropdown"},E.choices.map(function(e,t){return a.a.createElement("li",{key:t,className:t===E.index?"ExpressionChooser-dropdown-selected":"",ref:t===E.index?i:void 0},a.a.createElement(le,{choice:e}))})))}n(37);function de(e){var t=e.selected,n=e.onSelect,i=e.onEdit,o=e.children,u=e.extraClassName,s=Object(r.useState)(!1),l=Object(c.a)(s,2),f=l[0],d=l[1],m=u||"";m+=" SimpleTheme-selectable",t?m+=" SimpleTheme-selected":f&&(m+=" SimpleTheme-hovered");return a.a.createElement("div",{className:m,onClick:function(e){n&&"INPUT"!==e.target.tagName&&(e.stopPropagation(),n())},onDoubleClick:function(e){i&&"INPUT"!==e.target.tagName&&(e.stopPropagation(),i())},onMouseOver:function(e){d(!0),e.stopPropagation()},onMouseOut:function(e){d(!1)}},o)}var me=function(e){var t=e.expressionGrouping,n=e.applicationArguments;return{Program:function(e){var t=e.expressions;return a.a.createElement("div",{className:"SimpleTheme-program"},t)},Application:function(e){var t=e.functionName,r=e.streamArgs,i=e.functionArgs,o="right"===n||"right-centered"===n?"SimpleTheme-application-flex":"",u="SimpleTheme-application-function-name"+("right-centered"===n?" SimpleTheme-application-function-name-centered":"");return a.a.createElement("div",{className:o},a.a.createElement("div",{className:u},t),a.a.createElement("div",{className:"SimpleTheme-application-arguments"},r.map(function(e){var t=e.key,n=e.name,r=e.expression;return a.a.createElement("div",{className:"SimpleTheme-application-argument",key:t},n?a.a.createElement("span",{className:"SimpleTheme-application-argument-name"},n,":"):null,a.a.createElement("span",{className:"SimpleTheme-application-argument-expression"},r))}),i.map(function(e){var t=e.key,n=(e.name,e.functionExpression);return a.a.createElement("div",{className:"SimpleTheme-application-argument",key:t},n)})))},UserFunction:function(e){var t=e.parameterNames,n=e.expressions,r=e.selected,i=e.onSelect;return a.a.createElement(de,{selected:r,onSelect:i,extraClassName:"SimpleTheme-user-function"},a.a.createElement("div",null,"F ",t.join(", ")),a.a.createElement("div",{className:"SimpleTheme-user-function-expressions"},n))},DefinitionExpression:function(e){var t=e.expression;return a.a.createElement("div",{className:"SimpleTheme-definition-expression"},t)},Expression:function(e){var n=e.identifier,r=e.selected,i=e.onSelect,o=e.onEdit,u=e.inside,c="SimpleTheme-expression";switch(t){case"background":c+=" SimpleTheme-expression-background";break;case"shadow":c+=" SimpleTheme-expression-shadow"}return a.a.createElement(de,{selected:r,onSelect:i,onEdit:o,extraClassName:c},function(){switch(t){case"line":return a.a.createElement("div",{className:"SimpleTheme-expression-line"});case"bracket":return a.a.createElement("div",{className:"SimpleTheme-expression-bracket"});default:return null}}(),a.a.createElement("div",null,n?a.a.createElement("div",{className:"SimpleTheme-expression-identifier"},n):null,a.a.createElement("div",{className:"SimpleTheme-expression-main"},u)))},Identifier:function(e){var t=e.selected,n=e.onSelect,r=e.inside;return a.a.createElement(de,{selected:t,onSelect:n,extraClassName:"SimpleTheme-identifier"},r)},StreamReference:function(e){var t=e.name;return a.a.createElement("div",null,a.a.createElement("span",{className:"SimpleTheme-stream-reference"},t))},UndefinedExpression:function(){return a.a.createElement("div",{className:"SimpleTheme-undefined-expression"},"\xa0")},ArrayLiteral:function(e){var t=e.keyedItems;return a.a.createElement("div",null,a.a.createElement("div",null,"["),a.a.createElement("div",{className:"SimpleTheme-array-items"},t.map(function(e){var t=Object(c.a)(e,2),n=t[0],r=t[1];return a.a.createElement("div",{className:"SimpleTheme-array-item",key:n},r)})),a.a.createElement("div",null,"]"))}}},pe=(n(38),{expressionGrouping:"line",applicationArguments:"below"}),ve=me(pe);function he(e){var t=e.keyLabels,n=e.selectedKey,r=e.onChange;return a.a.createElement("select",{value:n,onChange:function(e){r(e.target.value)}},t.map(function(e){var t=Object(c.a)(e,2),n=t[0],r=t[1];return a.a.createElement("option",{key:n,value:n},r)}))}function Ee(e){var t=e.onChange,n=Object(r.useState)(pe),i=Object(c.a)(n,2),o=i[0],u=i[1],s=function(e){u(e),t(me(e))};return a.a.createElement("div",{className:"ThemePicker"},a.a.createElement("div",{className:"ThemePicker-option"},a.a.createElement("label",null,"Expression Grouping: ",a.a.createElement(he,{keyLabels:[["none","None"],["line","Line"],["bracket","Bracket"],["background","Background"],["shadow","Shadow"]],selectedKey:o.expressionGrouping,onChange:function(e){return s(Object(l.a)({},o,{expressionGrouping:e}))}}))),a.a.createElement("div",{className:"ThemePicker-option"},a.a.createElement("label",null,"Application Arguments: ",a.a.createElement(he,{keyLabels:[["below","Below"],["right","Right"],["right-centered","Right (centered)"]],selectedKey:o.applicationArguments,onChange:function(e){return s(Object(l.a)({},o,{applicationArguments:e}))}}))))}n(39);var ye={MOVE_UP:"up",MOVE_DOWN:"down",MOVE_LEFT:"left",MOVE_RIGHT:"right",ZOOM_IN:"shift+right",ZOOM_OUT:"shift+left",TOGGLE_EDIT:"enter",ABORT_EDIT:"escape",EDIT_AFTER:["shift+enter",","],DELETE:"backspace",BEGIN_IDENTIFIER_EDIT:"=",EDIT_NEXT_UNDEFINED:"tab"},ge=new Set(["=",","]),be=["Enter","Shift","Escape","Tab","=",","],we=Object(r.createContext)(),xe=Object(r.createContext)(),Oe=Object(r.createContext)();function Ie(e){return e===Object(r.useContext)(Oe)}function Se(e){var t=Object(r.useContext)(xe),n=Object(r.useContext)(we);return function(){var r=n.derivedLookups.nodeToPath.get(e);r&&t({type:"SET_PATH",newPath:r})}}var je=Object(r.createContext)();function Ne(e){var t=e.program,n=Object(r.useContext)(je).Program;return a.a.createElement(n,{expressions:a.a.createElement(Te,{expressions:t.mainDefinition.expressions})})}function Te(e){var t=e.expressions,n=Object(r.useContext)(je).DefinitionExpression;return a.a.createElement(a.a.Fragment,null,t.map(function(e){return a.a.createElement("div",{key:e.streamId},a.a.createElement(n,{expression:a.a.createElement(Le,{expression:e})}))}))}function Ce(e){var t=e.initialName,n=e.onUpdateName,i=(e.onEndEdit,Object(r.useState)(t||"")),o=Object(c.a)(i,2),u=o[0],s=o[1];return a.a.createElement("input",{className:"Editor-text-edit-input",value:u,onChange:function(e){var t=e.target.value;s(t),n&&n(t)},autoFocus:!0})}function ke(e){var t=e.identifier,n=Ie(t),i=Se(t),o=Object(r.useContext)(we).editingSelected,u=Object(r.useContext)(xe),c=Object(r.useContext)(je).Identifier;return a.a.createElement(c,{selected:n,onSelect:i,inside:n&&o?a.a.createElement(Ce,{initialName:t.name,onUpdateName:function(e){u({type:"UPDATE_EDITING_TENTATIVE_NODE",newNode:{type:"Identifier",name:e}})}}):t.name})}function Ae(e){var t=e.integerLiteral;return a.a.createElement("div",null,t.value)}function _e(e){var t=e.arrayLiteral,n=Object(r.useContext)(je).ArrayLiteral;return a.a.createElement(n,{keyedItems:t.items.map(function(e){return[e.streamId,a.a.createElement(Le,{expression:e})]})})}function De(e){e.undefinedExpression;var t=Object(r.useContext)(je).UndefinedExpression;return a.a.createElement(t,null)}function Re(e){var t=e.streamReference,n=Object(r.useContext)(we).derivedLookups.streamIdToNode.get(t.targetStreamId);if(!n)throw new Error;var i=Object(r.useContext)(je).StreamReference;return a.a.createElement(i,{name:n.identifier&&n.identifier.name?n.identifier.name:"<stream "+t.targetStreamId+">"})}function Pe(e){var t=e.userFunction,n=Ie(t),i=Se(t),o=Object(r.useContext)(je).UserFunction;return a.a.createElement(o,{parameterNames:t.parameters.map(function(e){return e.identifier.name}),expressions:a.a.createElement(Te,{expressions:t.expressions}),selected:n,onSelect:i})}function Ue(e){var t=e.application,n=Object(r.useContext)(we).derivedLookups.functionIdToNode.get(t.functionId);if(!n)throw new Error;if(n.signature.parameters.length!==t.arguments.length)throw new Error("params and args length mismatch");if(n.signature.functionParameters.length!==t.functionArguments.length)throw new Error("function params and args length mismatch");var i=n.identifier&&n.identifier.name?n.identifier.name:"<function "+t.functionId+">",o=n.signature.parameters.map(function(e,n){return{key:e,name:e.startsWith("_")?void 0:e,expression:a.a.createElement(Le,{expression:t.arguments[n]})}}),u=n.signature.functionParameters.map(function(e,n){var r=Object(c.a)(e,2),i=r[0];r[1];return{key:i,name:"dunno",functionExpression:a.a.createElement(Pe,{userFunction:t.functionArguments[n]})}}),s=Object(r.useContext)(je).Application;return a.a.createElement(s,{functionName:i,streamArgs:o,functionArgs:u})}function Me(e){var t=e.expression;switch(t.type){case"IntegerLiteral":return a.a.createElement(Ae,{integerLiteral:t});case"ArrayLiteral":return a.a.createElement(_e,{arrayLiteral:t});case"UndefinedExpression":return a.a.createElement(De,{undefinedExpression:t});case"StreamReference":return a.a.createElement(Re,{streamReference:t});case"Application":return a.a.createElement(Ue,{application:t});default:throw new Error}}function Le(e){var t=e.expression,n=Ie(t),i=Se(t),o=function(e){var t=Object(r.useContext)(xe),n=Object(r.useContext)(we);return function(){var r=n.derivedLookups.nodeToPath.get(e);r&&(t({type:"SET_PATH",newPath:r}),t({type:"TOGGLE_EDIT"}))}}(t),u=Object(r.useContext)(we),c=u.editingSelected,s=Object(r.useContext)(xe),l=Object(r.useContext)(je).Expression;return a.a.createElement(l,{identifier:t.identifier?a.a.createElement(ke,{identifier:t.identifier}):null,selected:n,onSelect:i,onEdit:o,inside:n&&c?a.a.createElement(fe,{node:t,mainState:u,dispatch:s}):a.a.createElement(Me,{expression:t})})}function Fe(e){var t=e.autoFocus,n=Object(r.useReducer)(te,ie),i=Object(c.a)(n,2),o=i[0],l=i[1],f=Object(r.useState)(ve),d=Object(c.a)(f,2),m=d[0],p=d[1],v=Object(r.useRef)(),h=Object(r.useState)(t),E=Object(c.a)(h,1)[0];Object(r.useEffect)(function(){E&&v.current.focus()},[E]);var y=Object(r.useRef)(!1);Object(r.useEffect)(function(){y.current&&!o.editingSelected&&v.current.focus(),y.current=o.editingSelected});for(var g={},b=function(){var e=x[w];g[e]=function(t){t.preventDefault(),l({type:e})}},w=0,x=Object.keys(ye);w<x.length;w++)b();return a.a.createElement(s.HotKeys,{keyMap:ye,handlers:g},a.a.createElement(s.ObserveKeys,{only:be},a.a.createElement("div",{className:"Editor",onKeyDown:function(e){"input"===e.target.tagName.toLowerCase()||1!==Object(u.a)(e.key).length||e.altkey||e.ctrlKey||e.metaKey||ge.has(e.key)||l({type:"BEGIN_OVERWRITE_EDIT"})},tabIndex:"0",ref:v},a.a.createElement("div",{className:"Editor-theme-controls"},a.a.createElement(Ee,{onChange:function(e){p(e)}})),a.a.createElement(xe.Provider,{value:l},a.a.createElement(Oe.Provider,{value:q(o.program,o.selectionPath)},a.a.createElement(we.Provider,{value:o},a.a.createElement(je.Provider,{value:m},a.a.createElement(Ne,{program:o.program}))))))))}var Ve=function(){return a.a.createElement("div",{className:"App"},a.a.createElement(Fe,{autoFocus:!0}),a.a.createElement("div",null,a.a.createElement("h2",null,"Notes"),a.a.createElement("ul",null,a.a.createElement("li",null,"If you don't see a green selection/cursor box, focus the editor."),a.a.createElement("li",null,"The mouse can be used to select parts of the tree, but otherwise editing is keyboard-driven."),a.a.createElement("li",null,"Up/down arrows move selection up and down within lists (expressions, arguments, arrays)."),a.a.createElement("li",null,"Right/left arrows move selection in and out of nested structures."),a.a.createElement("li",null,"Enter on an expression (or expression sub-tree) will begin editing it. Pressing enter again will stop editing."),a.a.createElement("li",null,"Instead of pressing enter, you can just start typing letters/numbers and it will begin the edit (overwriting what it there)."),a.a.createElement("li",null,"Escape aborts the current edit."),a.a.createElement("li",null,"Shift-enter (or comma) adds a new expression (or array item) below the current one."),a.a.createElement("li",null,"Pressing the = key on on an expression will move to editing its name/label."),a.a.createElement("li",null,"A red box indicates an undefined expression."),a.a.createElement("li",null,"Tab edits the next undefined expression."),a.a.createElement("li",null,"Delete will delete expressions, array items, etc."),a.a.createElement("li",null,"Typing [ when editing an expression will create an array literal."))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(Ve,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[16,1,2]]]);
//# sourceMappingURL=main.84cf51e4.chunk.js.map